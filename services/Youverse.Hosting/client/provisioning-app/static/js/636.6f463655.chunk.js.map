{"version":3,"file":"static/js/636.6f463655.chunk.js","mappings":"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","sources":["templates/ProvisionTest/ProvisionTest.js","templates/ProvisionTest/ScreenStatus.ts"],"sourcesContent":["import React, {Component} from 'react';\nimport axios from 'axios';\nimport {ScreenStatus} from './ScreenStatus';\n\nconst defaultState = {\n    domainValue: 'tao.nahs',\n    domainSuffix: '',\n    screenStatus: ScreenStatus.EnterDomain,\n    reservation: null,\n    registrationId: null,\n    statusText: '',\n    managedDomains: [],\n    firstRunToken: null\n};\n\nlet pollingCounter = 0;\n\nexport default class ProvisionTest extends Component {\n    root = '//' + window.location.host + '/api/registration/v1';\n\n    componentDidMount() {\n        this.getManagedDomains();\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = defaultState;\n\n        //should have used autobind\n        this.handleDomainValueChange = this.handleDomainValueChange.bind(this);\n        this.handleSuffixChange = this.handleSuffixChange.bind(this);\n        this.handleReserve = this.handleReserve.bind(this);\n        this.startRegistration = this.startRegistration.bind(this);\n        this.handleReset = this.handleReset.bind(this);\n        this.handleAxiosError = this.handleAxiosError.bind(this);\n\n        this.startPolling = this.startPolling.bind(this);\n        this.stopPolling = this.stopPolling.bind(this);\n        this.finalizeRegistration = this.finalizeRegistration.bind(this);\n    }\n\n    handleReset() {\n        this.setState(defaultState);\n    }\n\n    handleDomainValueChange(event) {\n        let prefix = event.target.value.trimEnd();\n        this.setState({domainValue: prefix});\n    }\n\n    handleSuffixChange(event) {\n        console.log('suffix', event.target.value);\n\n        this.setState({domainSuffix: event.target.value});\n    }\n\n    getDomain() {\n        return this.state.domainValue + '.' + this.state.domainSuffix;\n    }\n\n    async handleReserve(event) {\n        let domain = this.getDomain();\n\n        let isAvailableUrl = this.root + '/registration/availability/' + domain;\n        let response = await axios.get(isAvailableUrl).catch(this.handleAxiosError);\n\n        this.setState({\n            statusText: 'Checking Availability...',\n        });\n\n        if (response.data === false) {\n            this.setState({\n                statusText: 'Not available ლ(ಠ益ಠლ)',\n            });\n\n            this.forceUpdate();\n            return;\n        }\n\n        let data = {\n            domainName: domain,\n            //\"previousReservationId\": \"\"  //must be a valid guid or not included in the payload\n        };\n\n        this.setState({\n            statusText: 'submitting reservation...',\n            screenStatus: ScreenStatus.Reserving,\n        });\n\n        axios\n            .post(this.root + '/registration/reservations', data)\n            .then((response) => {\n                console.log('reservation', response.data);\n                this.setState({\n                    reservation: response.data,\n                    statusText: 'Reservation Successful',\n                    screenStatus: ScreenStatus.ReadyToRegister,\n                });\n            })\n            .catch(this.handleAxiosError);\n    }\n\n    startRegistration() {\n        this.setState({\n            statusText: 'Starting Registration...',\n            screenStatus: ScreenStatus.RegistrationInProgress,\n        });\n\n        let url = this.root + '/registration/register';\n        let data = {\n            reservationId: this.state.reservation.id\n        };\n\n        axios\n            .post(url, data)\n            .then((response) => {\n                this.setState({\n                    statusText: 'Polling for certificate creation ever two seconds',\n                    screenStatus: ScreenStatus.PollingForCertificate,\n                    firstRunToken: response.data,\n                });\n\n                this.startPolling();\n            })\n            .catch(this.handleAxiosError);\n    }\n\n    startPolling() {\n        this.timer = setInterval(() => this.poll(), 2000);\n    }\n\n    poll() {\n        pollingCounter++;\n        this.setState({\n            statusText: 'Polling Registration...' + pollingCounter,\n        });\n\n        let url = this.root + '/registration/status?firstRunToken=' + this.state.firstRunToken;\n\n        axios\n            .get(url)\n            .then((response) => {\n                let regStatus = response.data;\n\n                // public enum RegistrationStatus\n                // {\n                //     Unknown = 0,\n                //     AwaitingCertificate = 100,\n                //     ReadyForPassword = 200\n                // }\n\n                const Unknown = 0;\n                const AwaitingCertificate = 100;\n                const ReadyForPassword = 200;\n\n                if (regStatus === \"readyForPassword\") {\n                    this.stopPolling();\n                    this.finalizeRegistration();\n                    return;\n                }\n\n                if (regStatus !== \"awaitingCertificate\") {\n                    this.stopPolling();\n                    this.setState({\n                        statusText: 'Unknown status returned',\n                        screenStatus: ScreenStatus.RegistrationFailed,\n                    });\n                }\n            })\n            .catch(this.handleAxiosError);\n    }\n\n    stopPolling() {\n        clearInterval(this.timer);\n        this.timer = null;\n    }\n\n    finalizeRegistration() {\n        this.setState({\n            statusText: 'Ready to set your password',\n            screenStatus: ScreenStatus.ReadyForPassword,\n        });\n    }\n\n    getManagedDomains() {\n        let url = this.root + '/registration/domains';\n\n        axios\n            .get(url)\n            .then((response) => {\n                this.setState({\n                    domainSuffix: response.data[0],\n                    managedDomains: response.data,\n                });\n            })\n            .catch(this.handleAxiosError);\n    }\n\n\n    handleAxiosError(error) {\n        if (error.response) {\n            // The request was made and the server responded with a status code\n            // that falls out of the range of 2xx\n            console.log(error.response.data);\n            console.log(error.response.status);\n            console.log(error.response.headers);\n            this.setState({\n                statusText:\n                    'Unhandled Error occured.  Response Status: [' +\n                    error.response.status +\n                    '].  See the console for more.',\n                screenStatus: ScreenStatus.UnhandledError,\n            });\n        } else if (error.request) {\n            // The request was made but no response was received\n            // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n            // http.ClientRequest in node.js\n            console.log(error.request);\n\n            this.setState({\n                statusText:\n                    'Failed: Request sent but no response received.  (this can happen when server exception occurs before the CORS header can be sent back). See the console.',\n                screenStatus: ScreenStatus.UnhandledError,\n            });\n        } else {\n            this.setState({\n                statusText:\n                    \"Something happened before sending the request.  Validate how you're setting up the request.\",\n                screenStatus: ScreenStatus.UnhandledError,\n            });\n            // Something happened in setting up the request that triggered an Error\n            console.log('Error', error.message);\n        }\n    }\n\n    render() {\n        return (\n            <div\n                style={{height: '100%', minHeight: '100%'}}\n                className=\" flex-column align-items-center justify-content-around text-center align-middle\"\n            >\n                <div className=\"pt-5\">\n                    <h1 className=\"display-6\">Test Provisioning ()</h1>\n                    <hr/>\n\n                    <h4>{this.getDomain()}</h4>\n\n                    {this.state.screenStatus === ScreenStatus.EnterDomain && (\n                        <form>\n                            <label>\n                                Domain Prefix&nbsp;{' '}\n                                <input\n                                    type=\"text\"\n                                    value={this.state.domainValue}\n                                    size={20}\n                                    onChange={this.handleDomainValueChange}\n                                />{' '}\n                            </label>\n                            <label>\n                                <select onChange={this.handleSuffixChange}>\n                                    {this.state.managedDomains.map((d) => (\n                                        <option key={d} value={d}>\n                                            {d}\n                                        </option>\n                                    ))}\n                                </select>{' '}\n                            </label>\n                            <input type=\"button\" onClick={this.handleReserve} value=\"Go\"/>\n                        </form>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.Reserving && (\n                        <div style={{flexDirection: 'column'}}>Reserving domain</div>\n                    )}\n\n\n                    {this.state.screenStatus === ScreenStatus.ReadyToRegister && (\n                        <div style={{flexDirection: 'column'}}>\n                            <input type=\"button\" onClick={this.startRegistration} value=\"Register\"/>\n                        </div>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.RegistrationInProgress && (\n                        <div style={{flexDirection: 'column'}}>\n                            <h3>Registration in progress</h3>\n                            <h6>{this.state.statusText}</h6>\n                            <div style={{padding: 4}}>ᕙ(⇀‸↼‶)ᕗ</div>\n                        </div>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.PollingForCertificate && (\n                        <div style={{flexDirection: 'column'}}>\n                            <h3>Registration in progress</h3>\n                            <h6>{this.state.statusText}</h6>\n                            <div style={{padding: 4}}>(-_-)</div>\n                        </div>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.ReadyForPassword && (\n                        <div style={{flexDirection: 'column'}}>\n                            <h3>Password is next...</h3>\n                            <h6>{this.state.statusText}</h6>\n                            <div style={{padding: 4}}> ᕦ(ò_óˇ)ᕤ</div>\n                            <h2>Your new identity: {this.getDomain()}</h2>\n\n                            <a href={`https://${this.getDomain()}/owner/firstrun?frt=${this.state.firstRunToken}`}>\n                                Click here to continue to {this.getDomain()} and set your password\n                            </a>\n                        </div>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.RegistrationFailed && (\n                        <div style={{flexDirection: 'column'}}>\n                            <h3>Registration Failed =(</h3>\n                            <h6>{this.state.statusText}</h6>\n                            <div style={{padding: 4}}> ¯\\_(⊙︿⊙)_/¯</div>\n                            <input type=\"button\" onClick={this.handleReset} value=\"Try again\"/>\n                        </div>\n                    )}\n\n                    {this.state.screenStatus === ScreenStatus.UnhandledError && (\n                        <div style={{flexDirection: 'column'}}>\n                            <h3>Unhandled Error - See server log</h3>\n                            <h6>{this.state.statusText}</h6>\n\n                            <div style={{padding: 4}}> ¯\\_(⊙︿⊙)_/¯</div>\n                            <input type=\"button\" onClick={this.handleReset} value=\"Try again\"/>\n                        </div>\n                    )}\n                </div>\n            </div>\n        );\n    }\n}\n","export enum ScreenStatus {\n  SelectManagedOrCustomDomain,\n  EnterDomain,\n  Reserving,\n  ReadyToRegister,\n  RegistrationInProgress,\n  PollingForCertificate,\n  ReadyForPassword,\n  RegistrationFailed,\n  UnhandledError,\n  DnsConfig,\n}\n"],"names":["defaultState","domainValue","domainSuffix","screenStatus","ScreenStatus","reservation","registrationId","statusText","managedDomains","firstRunToken","pollingCounter","ProvisionTest","props","root","window","location","host","state","handleDomainValueChange","bind","handleSuffixChange","handleReserve","startRegistration","handleReset","handleAxiosError","startPolling","stopPolling","finalizeRegistration","this","getManagedDomains","setState","event","prefix","target","value","trimEnd","console","log","domain","getDomain","isAvailableUrl","axios","catch","response","data","forceUpdate","domainName","then","url","reservationId","id","timer","setInterval","poll","regStatus","clearInterval","error","status","headers","request","message","style","height","minHeight","className","type","size","onChange","map","d","onClick","flexDirection","padding","href","Component"],"sourceRoot":""}