{"version":3,"file":"static/js/990.ee62019c.chunk.js","mappings":"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","sources":["components/ui/Buttons/SaveStatus.tsx","components/ui/Layout/PageMeta/PageMeta.tsx","hooks/apps/useApps.ts","provider/app/AppManagementProvider.ts","templates/Apps/Apps/Apps.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { t } from '../../../helpers/i18n/dictionary';\nimport Alert from '../Alerts/Alert/Alert';\n\nconst seconds = 60000;\nconst minutes = 600000;\n\nconst SaveStatus = ({\n  className,\n  state,\n  error,\n}: {\n  className: string;\n  state: 'error' | 'idle' | 'loading' | 'success';\n  error?: unknown;\n}) => {\n  const [lastSave, setLastSave] = useState<Date>(null);\n  const [now, setNow] = useState<Date>(new Date());\n\n  useEffect(() => {\n    if (state === 'success') {\n      setLastSave(new Date());\n    }\n  }, [state]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setNow(new Date());\n    }, 30000);\n\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [now]);\n\n  if (state === 'loading') {\n    return <p className={`${className} text-sm`}>Saving...</p>;\n  }\n\n  if (state === 'error') {\n    return (\n      <Alert type=\"critical\" className={className}>\n        {error instanceof Error ? error.message : t('Something went wrong')}\n      </Alert>\n    );\n  }\n\n  if (!lastSave) {\n    return null;\n  }\n\n  const diff = now.getTime() - lastSave.getTime();\n  const text = lastSave\n    ? diff <= seconds\n      ? 'a few seconds ago'\n      : diff <= minutes\n      ? 'a few minutes ago'\n      : lastSave.toLocaleString()\n    : '';\n\n  return text ? <p className={`${className} text-sm`}>Last saved {text}</p> : null;\n};\n\nexport default SaveStatus;\n","import { FC, ReactNode } from 'react';\nimport { Helmet } from 'react-helmet-async';\nimport { Link } from 'react-router-dom';\nimport SaveStatus from '../../Buttons/SaveStatus';\n\nconst PageMeta = ({\n  title,\n  actions,\n  saveStatus,\n  breadCrumbs,\n  icon,\n}: {\n  title?: ReactNode | string;\n  actions?: ReactNode;\n  saveStatus?: 'error' | 'idle' | 'loading' | 'success';\n  breadCrumbs?: { title: string; href?: string }[];\n  icon?: FC;\n}) => {\n  return (\n    <section\n      className=\"-mx-5 -mt-4 mb-10 border-b-2 border-gray-100 bg-slate-50 py-4 pr-5 pl-10 dark:border-gray-700 dark:bg-slate-800 sm:-mx-10\n    sm:-mt-8 sm:py-8 sm:px-10\"\n    >\n      <div className=\"flex flex-col sm:flex-row\">\n        <div className=\"flex-col\">\n          {breadCrumbs && (\n            <ul className=\"mb-2 hidden flex-row sm:flex\">\n              {breadCrumbs.map((crumb, index) => {\n                return (\n                  <li key={index} className=\"mr-2\">\n                    {crumb.href ? (\n                      <Link to={crumb.href} className=\"\">\n                        {crumb.title}\n                        <span className=\"ml-2\">{'>'}</span>\n                      </Link>\n                    ) : (\n                      <span className=\"text-slate-500\">{crumb.title}</span>\n                    )}\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n          {title && (\n            <>\n              <h1 className=\"mb-5 flex flex-row text-4xl dark:text-white\">\n                {icon && icon({ className: 'h-8 w-8 my-auto mr-4' })} {title}\n              </h1>\n              <Helmet>\n                <title>\n                  {(typeof title !== 'object' && `${title}`) ||\n                    window.location.pathname.split('/').pop()}{' '}\n                  | Owner console\n                </title>\n              </Helmet>\n            </>\n          )}\n        </div>\n        <div className=\"ml-auto\">\n          <div className=\"-m-2 flex flex-col flex-wrap justify-end sm:flex-row sm:items-center\">\n            {actions}\n          </div>\n          {saveStatus && <SaveStatus className=\"mt-1\" state={saveStatus} />}\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default PageMeta;\n","import { useQuery } from '@tanstack/react-query';\nimport AppManagementProvider from '../../provider/app/AppManagementProvider';\nimport useAuth from '../auth/useAuth';\n\nconst useApps = () => {\n  const { getSharedSecret } = useAuth();\n\n  const appManagementProvider = AppManagementProvider.getInstance(getSharedSecret());\n\n  const fetchRegistered = async () => {\n    const apps = await appManagementProvider.GetAppRegistrations();\n    return apps?.sort((a, b) => (a.isRevoked ? 1 : 0) - (b.isRevoked ? 1 : 0));\n  };\n\n  return {\n    fetchRegistered: useQuery(['registeredApps'], () => fetchRegistered(), {\n      refetchOnWindowFocus: false,\n    }),\n  };\n};\n\nexport default useApps;\n","import {\n  AppClientRegistrationRequest,\n  AppClientRegistrationResponse,\n  AppRegistrationRequest,\n  RedactedAppRegistration,\n  GetAppRequest,\n} from './AppManagementProviderTypes';\nimport { OwnerProviderBase } from '../OwnerProviderBase';\n\nexport default class AppManagementProvider extends OwnerProviderBase {\n  private static instance: AppManagementProvider;\n  constructor(sharedSecret: Uint8Array | undefined) {\n    super(sharedSecret);\n  }\n\n  //adds the specified client to the list of allowed clients for a given app; returns a CAT\n  async RegisterAppClient(\n    request: AppClientRegistrationRequest\n  ): Promise<AppClientRegistrationResponse> {\n    const client = this.createAxiosClient();\n    const response = await client.post<AppClientRegistrationResponse>(\n      'appmanagement/register/client',\n      request\n    );\n    return response.data;\n  }\n\n  async RegisterChatAppClient_temp(\n    request: AppClientRegistrationRequest\n  ): Promise<AppClientRegistrationResponse> {\n    const client = this.createAxiosClient();\n    const response = await client.post<AppClientRegistrationResponse>(\n      'appmanagement/register/chatclient_temp',\n      request\n    );\n    console.log('RegisterChatAppClient_temp returning response');\n    console.log(response);\n\n    return response.data;\n  }\n\n  async RegisterApp(request: AppRegistrationRequest): Promise<RedactedAppRegistration> {\n    const client = this.createAxiosClient();\n    const response = await client.post<RedactedAppRegistration>(\n      'appmanagement/register/app',\n      request\n    );\n\n    console.log('RegisterApp returning response');\n    console.log(response);\n\n    return response.data;\n  }\n\n  async GetAppRegistration(request: GetAppRequest): Promise<RedactedAppRegistration> {\n    const client = this.createAxiosClient();\n    const response = await client.post<RedactedAppRegistration>('appmanagement/app', request);\n    return response.data;\n  }\n\n  async GetAppRegistrations(): Promise<RedactedAppRegistration[]> {\n    const client = this.createAxiosClient();\n    const response = await client.get<RedactedAppRegistration[]>('appmanagement/list');\n    return response.data;\n  }\n\n  async RevokeApp(request: GetAppRequest): Promise<void> {\n    const client = this.createAxiosClient();\n    await client.post('appmanagement/revoke', request);\n  }\n\n  async AllowApp(request: GetAppRequest): Promise<void> {\n    const client = this.createAxiosClient();\n    const response = await client.post('appmanagement/allow', request);\n    console.log(response);\n  }\n\n  public static getInstance(sharedSecret): AppManagementProvider {\n    if (!AppManagementProvider.instance) {\n      AppManagementProvider.instance = new AppManagementProvider(sharedSecret);\n    }\n\n    return AppManagementProvider.instance;\n  }\n}\n","import { Link } from 'react-router-dom';\nimport { t } from '../../../helpers/i18n/dictionary';\nimport useApps from '../../../hooks/apps/useApps';\nimport { RedactedAppRegistration } from '../../../provider/app/AppManagementProviderTypes';\nimport Grid from '../../../components/ui/Icons/Grid/Grid';\nimport PageMeta from '../../../components/ui/Layout/PageMeta/PageMeta';\nimport LoadingParagraph from '../../../components/ui/Loaders/LoadingParagraph/LoadingParagraph';\n\nconst Apps = () => {\n  const { data: registeredApps, isLoading: loadingRegisteredApps } = useApps().fetchRegistered;\n\n  return (\n    <>\n      <section>\n        <PageMeta icon={Grid} title={'Apps'} />\n      </section>\n      {loadingRegisteredApps ? (\n        <>\n          <LoadingParagraph className=\"m-4 h-10\" />\n          <LoadingParagraph className=\"m-4 h-10\" />\n          <LoadingParagraph className=\"m-4 h-10\" />\n        </>\n      ) : (\n        <>\n          {registeredApps?.length ? (\n            <div className=\"-my-4\">\n              {registeredApps.map((app) => (\n                <AppCard appRegistration={app} key={app.appId} className=\"py-4\" />\n              ))}\n            </div>\n          ) : (\n            <>{t('No apps currently registered')}</>\n          )}\n        </>\n      )}\n    </>\n  );\n};\n\nconst AppCard = ({\n  appRegistration,\n  className,\n}: {\n  appRegistration: RedactedAppRegistration;\n  className: string;\n}) => {\n  return (\n    <div className={`${className} ${appRegistration.isRevoked ? 'opacity-50' : ''}`}>\n      <Link\n        to={`/owner/apps/${encodeURIComponent(appRegistration.appId)}`}\n        className=\"block h-full rounded-md border-[1px] border-gray-200 border-opacity-60 bg-white transition-colors hover:bg-slate-100 dark:border-gray-800 dark:bg-gray-800 dark:hover:bg-slate-700\"\n      >\n        <h2 className=\"bg-slate-100 p-4 text-xl dark:bg-slate-700 dark:text-slate-200\">\n          {appRegistration.isRevoked ? `${t('Revoked')} ` : ''}\n          {appRegistration.name}\n        </h2>\n        <div className=\"p-4\">\n          <p className=\"text-xs\">\n            Created on: {new Date(appRegistration.created).toLocaleDateString()}\n          </p>\n        </div>\n      </Link>\n    </div>\n  );\n};\n\nexport default Apps;\n"],"names":["className","state","error","useState","lastSave","setLastSave","Date","now","setNow","useEffect","timer","setTimeout","clearTimeout","type","Error","message","t","diff","getTime","text","toLocaleString","title","actions","saveStatus","breadCrumbs","icon","map","crumb","index","href","to","window","location","pathname","split","pop","getSharedSecret","useAuth","appManagementProvider","AppManagementProvider","fetchRegistered","GetAppRegistrations","apps","sort","a","b","isRevoked","useQuery","refetchOnWindowFocus","sharedSecret","request","client","this","createAxiosClient","post","response","data","console","log","get","instance","OwnerProviderBase","AppCard","appRegistration","encodeURIComponent","appId","name","created","toLocaleDateString","useApps","registeredApps","loadingRegisteredApps","isLoading","Grid","length","app"],"sourceRoot":""}