"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[458],{8683:function(e,t,r){var n=r(4165),a=r(5861),i=r(9439),s=r(5274),o=r(2791),c=r(4164),l=r(4990),u=r(8347),d=r(3412),p=r(9747),f=r(2042),v=r(2851),m=r(8930),x=r(184);t.Z=function(e){var t=e.title,r=e.confirmText,h=e.isOpen,y=e.targetDrive,g=e.onCancel,Z=(0,d.Z)("modal-container"),b=(0,u.Z)().importUnencrypted,w=b.mutateAsync,j=b.status,k=b.error,N=(0,o.useState)(),C=(0,i.Z)(N,2),D=C[0],I=C[1],A=(0,o.useState)(),S=(0,i.Z)(A,2),M=S[0],R=S[1],O=(0,o.useState)(),P=(0,i.Z)(O,2),T=P[0],L=P[1];if(!h)return null;var F=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=2;break}return e.abrupt("return");case 2:return e.t0=L,e.next=5,w({drive:y,formatDrive:t,data:M});case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=(0,x.jsx)(m.Z,{title:t,onClose:g,size:"2xlarge",children:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(f.Z,{error:k}),D&&(0,x.jsx)(p.Z,{type:"critical",className:"mb-8",children:D}),(0,x.jsx)("input",{onChange:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.target.files[0])){e.next=14;break}return e.next=4,r.arrayBuffer();case 4:if(a=e.sent,i=s.j4.byteArrayToString(new Uint8Array(a)),o=JSON.parse(i),(0,u.V)(o)){e.next=12;break}return I((0,l.t)("The file provided is not in the right JSON format")),e.abrupt("return");case 12:I(void 0);case 13:R(o);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),type:"file",accept:"application/json",className:"w-full rounded border border-gray-300 bg-white py-1 px-3 text-base leading-8 text-gray-700 outline-none transition-colors duration-200 ease-in-out focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"}),M&&(0,x.jsxs)("div",{className:"my-8",children:[y?(M.metadata.drive.targetDriveInfo.alias!==y.alias||M.metadata.drive.targetDriveInfo.type!==y.type)&&(0,x.jsxs)("p",{className:"pb-2 text-orange-600",children:[(0,l.t)("Warning"),": ",(0,l.t)("the export originates from a different drive")]}):(0,x.jsxs)("p",{className:"pb-2",children:[(0,l.t)("A new drive will be created:")," ",M.metadata.drive.name]}),(0,x.jsxs)("p",{className:"mb-6 text-xl",children:[(0,l.t)("Found the following")," ",M.files.length," ",(0,l.t)("files"),"."," ",(0,x.jsxs)("small",{className:"block text-sm",children:[(0,l.t)("Exported on"),":"," ",new Date(M.metadata.date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})]})]}),(0,x.jsx)("ul",{className:"-my-1 max-h-[25vh] overflow-auto",children:M.files.map((function(e){var t;return(0,x.jsxs)("li",{className:"my-1 flex flex-row rounded-lg border border-slate-200 px-2 py-1 dark:border-slate-700 ".concat(T&&(!0===(null===T||void 0===T||null===(t=T.find((function(t){return t.fileId===e.fileId})))||void 0===t?void 0:t.status)?"bg-green-200 dark:bg-green-900":"bg-red-200 dark:bg-red-900")),children:[e.fileId," ",(0,x.jsx)("span",{className:"ml-auto",children:e.fileMetadata.contentType})]},e.fileId)}))}),y?(0,x.jsx)("small",{className:"mt-6 block text-sm",children:(0,l.t)("Data on the drive will be overwritten when importing")}):null]}),(0,x.jsxs)("div",{className:"-m-2 flex flex-row-reverse pt-10 ",children:[(0,x.jsx)(v.Z,{className:"m-2",onClick:function(){return F()},state:j,children:null!==r&&void 0!==r?r:(0,l.t)("Import")}),(0,x.jsx)(v.Z,{className:"m-2",onClick:function(){return F(!0)},state:j,type:"secondary",children:(0,l.t)("Clean drive & import")}),(0,x.jsx)(v.Z,{className:"m-2",type:"secondary",onClick:g,children:(0,l.t)("Close")})]})]})});return(0,c.createPortal)(U,Z)}},2284:function(e,t,r){var n=r(9439),a=r(2791),i=r(1261),s=r(4311),o=r(8602),c=r(184),l=function(e){var t=e.className,r=e.isChecked,n=e.children,a=e.onChange;return(0,c.jsxs)("li",{className:"flex min-w-[8rem] cursor-pointer select-none flex-row py-1 px-4 hover:bg-slate-100 dark:hover:bg-slate-700 ".concat(t),onClick:a,children:[(0,c.jsx)(s.Z,{className:"my-auto mr-3 h-4 w-4 flex-shrink-0  ".concat(r?"text-slate-700 dark:text-slate-200":"text-transparent")})," ",(0,c.jsx)("span",{className:"mr-auto block h-full py-1",children:n})]})};t.Z=function(e){var t=e.className,r=e.permissionLevels,s=e.onChange,u=e.defaultValue,d=(0,a.useState)(!1),p=(0,n.Z)(d,2),f=p[0],v=p[1],m=(0,a.useState)(u),x=(0,n.Z)(m,2),h=x[0],y=x[1],g=(0,a.useRef)(null);(0,i.Z)(g,(function(){return v(!1)}));var Z=r.reduce((function(e,t){return t.value>e.value&&t.value<=u?t:e}),r[0]),b=function(e){y(e),s(e)};return(0,c.jsx)("div",{className:null!==t&&void 0!==t?t:"",children:(0,c.jsxs)("div",{className:"relative cursor-pointer rounded-md bg-slate-100 dark:bg-slate-800",onClick:function(){return v(!f)},ref:g,children:[(0,c.jsxs)("div",{className:"flex min-w-[6rem] flex-row py-1 px-2",children:[(0,c.jsx)("span",{className:"my-auto mr-2 select-none",children:Z.name})," ",(0,c.jsx)(o.Z,{className:"my-auto ml-auto h-2 w-2 rotate-90"})]}),(0,c.jsx)("ul",{className:"absolute top-[100%] right-0 overflow-hidden bg-white dark:bg-slate-800 ".concat(f?"z-10 max-h-[30rem] border border-slate-100 py-3 shadow-2xl dark:border-slate-700":"max-h-0"),children:r.map((function(e){return(0,c.jsx)(l,{isChecked:0===e.value?h===e.value:h>=e.value,onChange:function(){return h!==e.value?b(e.value):b(0)},children:e.name},e.value)}))})]})})}},2405:function(e,t,r){var n=r(3504),a=r(4990),i=r(9205),s=r(184);t.Z=function(e){var t=e.appDef,r=e.permissionLevel,o=e.className;return t?(0,s.jsx)("div",{className:"".concat(null!==o&&void 0!==o?o:""," ").concat(t.isRevoked&&"opacity-50"),children:(0,s.jsx)(n.rU,{to:"/owner/apps/".concat(t.appId),children:(0,s.jsxs)("h2",{className:"mb-2 flex flex-row text-xl",children:[(0,s.jsx)(i.Z,{className:"my-auto mr-2 h-4 w-4"})," ",(0,s.jsxs)("span",{className:"my-auto",children:[t.isRevoked&&"".concat((0,a.t)("Revoked"),": "),t.name]}),r&&(0,s.jsxs)("span",{className:"my-auto",children:[": ",r]})]})})}):(0,s.jsx)(s.Fragment,{})}},8808:function(e,t,r){var n=r(3504),a=r(4990),i=r(4075),s=r(706),o=r(9205),c=r(4411),l=r(184);t.Z=function(e){var t=e.circleDef,r=e.permissionDetails,u=e.className,d=e.isChecked,p=e.onClick,f=e.hideMembers,v=(0,i.Z)({circleId:!f&&(null===t||void 0===t?void 0:t.id)}).fetchMembers,m=v.data,x=v.isLoading;if(!t)return(0,l.jsx)(l.Fragment,{});var h=function(e){var r=e.children,a=e.className;return p?(0,l.jsx)("a",{onClick:function(){return p&&p()},className:null!==a&&void 0!==a?a:"",children:r}):(0,l.jsx)(n.rU,{to:"/owner/circles/".concat(encodeURIComponent(t.id)),className:"hover:text-slate-700 hover:underline dark:hover:text-slate-400 ".concat(null!==a&&void 0!==a?a:""),children:r})},y=d?"border-indigo-500 dark:border-indigo-800":!1===d?"border-slate-100 dark:border-slate-800":"";return(0,l.jsxs)(h,{className:"flex flex-row ".concat(null!==u&&void 0!==u?u:""," ").concat(t.disabled&&"opacity-50"," ").concat(p&&"cursor-pointer"," ").concat(y),children:[(0,l.jsx)(o.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,l.jsxs)("div",{className:"mr-2 flex flex-col",children:[(0,l.jsxs)("p",{className:"my-auto leading-none",children:[t.disabled&&(0,a.t)("Disabled:")," ",null===t||void 0===t?void 0:t.name,r&&": ".concat(r)]}),f?null:x?(0,l.jsx)(c.Z,{className:"mt-1 h-4 w-full"}):(0,l.jsx)("small",{className:"block",children:m?"".concat(m.length," ").concat(1===m.length?(0,a.t)("member"):(0,a.t)("members")):null})]}),!p&&(0,l.jsx)(s.Z,{className:"my-auto ml-2 h-5 w-5"})]})}},8602:function(e,t,r){var n=r(184);t.Z=function(e){var t=e.className;return(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",fill:"currentColor",className:t,children:(0,n.jsx)("path",{d:"M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"})})}},1434:function(e,t,r){var n=r(2791),a=r(184),i=n.forwardRef((function(e,t){var r=e.title,n=e.actions,i=e.className,s=e.children,o=e.isOpaqueBg,c=void 0!==o&&o,l=e.isBorderLess,u=void 0!==l&&l;return(0,a.jsxs)("section",{ref:t,className:"my-5 rounded-md ".concat(c?u?"":"rounded-lg border-[1px] border-gray-200 border-opacity-80 px-5 dark:border-gray-700":"bg-slate-50 px-5 dark:bg-slate-800"," dark:text-slate-300 ").concat(null!==i&&void 0!==i?i:""),children:[r||n?(0,a.jsxs)("div",{className:"relative flex flex-row items-center border-b-[1px] border-gray-200 border-opacity-80 py-5 transition-all duration-300 dark:border-gray-700",children:[(0,a.jsx)("h3",{className:"text-2xl dark:text-white",children:r}),(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsx)("div",{className:"-m-2 flex flex-col flex-wrap justify-end sm:flex-row sm:items-center",children:n})})]}):null,(0,a.jsx)("div",{className:"py-5 ",children:s})]})}));t.Z=i},144:function(e,t,r){var n=r(4165),a=r(5861),i=r(7408),s=r(4180),o=r(8609);t.Z=function(){var e=(0,o.ZP)().getSharedSecret,t=s.Z.getInstance(e()),r=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.GetAppRegistrations();case 2:return r=e.sent,e.abrupt("return",null===r||void 0===r?void 0:r.sort((function(e,t){return(e.isRevoked?1:0)-(t.isRevoked?1:0)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetchRegistered:(0,i.useQuery)(["registeredApps"],(function(){return r()}),{refetchOnWindowFocus:!1})}}},4395:function(e,t,r){var n=r(4165),a=r(5861),i=r(7408),s=r(3766),o=r(8609);t.Z=function(){var e=(0,o.ZP)().getSharedSecret,t=s.k.getInstance(e()),r=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getCircles();case 2:return r=e.sent,e.abrupt("return",null===r||void 0===r?void 0:r.sort((function(e,t){return(e.disabled?1:0)-(t.disabled?1:0)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetch:(0,i.useQuery)(["circles"],(function(){return r()}),{refetchOnWindowFocus:!1})}}},5809:function(e,t,r){var n=r(4165),a=r(5861),i=r(7408),s=r(5274),o=r(8609);t.Z=function(e){var t=e.targetDrive,r=(0,o.ZP)().getSharedSecret,c=new s.AO({api:s.Ii.Owner,sharedSecret:r()}),l=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.driveProvider.GetDrives({pageNumber:1,pageSize:100});case 2:return e.next=4,e.sent.results;case 4:return r=e.sent,e.abrupt("return",r.find((function(e){return e.targetDriveInfo.alias===t.alias&&e.targetDriveInfo.type===t.type})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{fetch:(0,i.useQuery)(["drive","".concat(t.alias,"_").concat(t.type)],(function(){return l(t)}),{refetchOnWindowFocus:!1})}}},8347:function(e,t,r){r.d(t,{V:function(){return d}});var n=r(1413),a=r(3433),i=r(4165),s=r(5861),o=r(7408),c=r(5274),l=r(8609),u=function(e){return new Promise((function(t){return setTimeout(t,e)}))},d=function(e){return"object"===typeof e&&"metadata"in e&&"files"in e&&(!(!("files"in e)||!Array.isArray(e.files)||null===e.files||0===e.files.length)&&!e.files.some((function(e){return!("payload"in e)||!("fileId"in e)||!("fileMetadata"in e)||!("contentType"in e.fileMetadata)||!("string"===typeof e.payload||"object"===typeof e.payload)})))};t.Z=function(){var e=(0,l.ZP)().getSharedSecret,t=new c.AO({api:c.Ii.Owner,sharedSecret:e()}),r=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){var n,o,c,l,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.driveProvider.QueryBatch({targetDrive:r},{maxRecords:10,includeMetadataHeader:true,cursorState:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=[],c=void 0,l=0;case 4:if(!(l<10)){e.next=15;break}return e.next=7,n(c);case 7:if(u=e.sent,o.push.apply(o,(0,a.Z)(u.searchResults)),c=u.cursorState,!(u.searchResults.length<10)){e.next=12;break}return e.abrupt("break",15);case 12:l++,e.next=4;break;case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(a){var o,l,d,p,f,v,m,x,h,y;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.targetDriveInfo,e.next=3,r(o);case 3:if(l=e.sent,d=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/json"!==r.fileMetadata.contentType){e.next=6;break}return e.next=3,t.driveProvider.GetPayload(o,r.fileId,r.fileMetadata,r.sharedSecretEncryptedKeyHeader,true);case 3:return e.abrupt("return",e.sent);case 6:if(!r.fileMetadata.payloadIsEncrypted){e.next=12;break}return e.next=9,t.driveProvider.DecryptKeyHeader(r.sharedSecretEncryptedKeyHeader);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=void 0;case 13:return n=e.t0,e.next=16,t.driveProvider.GetPayloadBytes(o,r.fileId,n);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.fileId,e.t1={contentType:t.fileMetadata.contentType,senderDotYouId:t.fileMetadata.senderDotYouId,payloadIsEncrypted:t.fileMetadata.payloadIsEncrypted,accessControlList:t.serverMetadata.accessControlList,appData:(0,n.Z)((0,n.Z)({},t.fileMetadata.appData),{},{jsonContent:void 0,previewThumbnail:void 0,additionalThumbnails:void 0,contentIsComplete:void 0})},e.next=4,d(t);case 4:return e.t2=e.sent,e.abrupt("return",{fileId:e.t0,fileMetadata:e.t1,payload:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!localStorage.getItem("export-timeout")){e.next=24;break}v=parseInt(localStorage.getItem("export-timeout")),console.log("exporting with",v),f=[],m=0;case 11:if(!(m<l.length)){e.next=22;break}return e.next=14,u(v);case 14:return e.t0=f,e.next=17,p(l[m]);case 17:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 19:m++,e.next=11;break;case 22:e.next=27;break;case 24:return e.next=26,Promise.all(l.map(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 26:f=e.sent;case 27:return x={metadata:{drive:(0,n.Z)({},a),date:(new Date).toString()},files:f},h=c.j4.JsonStringify64(x),y=window.URL.createObjectURL(new Blob([h],{type:"application/json;charset=utf-8"})),e.abrupt("return",y);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(n);case 2:return a=e.sent,e.next=5,Promise.all(a.map(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.driveProvider.DeleteFile(n,r.fileId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){var a,o,l,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.drive,o=r.formatDrive,l=r.data,d(l)){e.next=3;break}return e.abrupt("return",[{fileId:"root",status:!1}]);case 3:if(u=a){e.next=10;break}return e.next=7,t.driveProvider.EnsureDrive(l.metadata.drive.targetDriveInfo,l.metadata.drive.name,l.metadata.drive.metadata,l.metadata.drive.allowAnonymousReads);case 7:u=l.metadata.drive.targetDriveInfo,e.next=13;break;case 10:if(!o){e.next=13;break}return e.next=13,f(u);case 13:return e.next=15,Promise.all(l.files.map(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){var a,s,l,d,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!["image/png","image/jpeg","image/tiff","image/webp","image/svg+xml"].includes(r.fileMetadata.contentType)){e.next=6;break}return e.next=4,t.mediaProvider.uploadImage(u,r.fileMetadata.appData.tags,r.fileMetadata.accessControlList,c.j4.base64ToUint8Array(r.payload.toString()),o?void 0:r.fileId,r.fileMetadata.contentType);case 4:e.next=13;break;case 6:return a={transferIv:t.driveProvider.Random16(),storageOptions:{overwriteFileId:o?void 0:r.fileId,drive:u},transitOptions:null},s="application/json"===r.fileMetadata.contentType&&c.j4.JsonStringify64(r.payload),l=s?c.j4.stringToUint8Array(s):c.j4.base64ToUint8Array(r.payload.toString()),d=l.length<3e3,p={contentType:r.fileMetadata.contentType,senderDotYouId:r.fileMetadata.senderDotYouId,payloadIsEncrypted:r.fileMetadata.payloadIsEncrypted,accessControlList:r.fileMetadata.accessControlList,appData:(0,n.Z)((0,n.Z)({},r.fileMetadata.appData),{},{contentIsComplete:d,jsonContent:d?s:null})},e.next=13,t.driveProvider.Upload(a,p,l,void 0,r.fileMetadata.payloadIsEncrypted);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{fileId:r.fileId,status:!1});case 19:return e.abrupt("return",{fileId:r.fileId,status:!0});case 20:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()));case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{exportUnencrypted:(0,o.useMutation)(p),importUnencrypted:(0,o.useMutation)(v)}}},4180:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(4165),a=r(5861),i=r(5671),s=r(3144),o=r(9340),c=r(1129),l=function(e){(0,o.Z)(r,e);var t=(0,c.Z)(r);function r(e){return(0,i.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"RegisterAppClient",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/client",t);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"RegisterChatAppClient_temp",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/chatclient_temp",t);case 3:return a=e.sent,console.log("RegisterChatAppClient_temp returning response"),console.log(a),e.abrupt("return",a.data);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"RegisterApp",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/app",t);case 3:return a=e.sent,console.log("RegisterApp returning response"),console.log(a),e.abrupt("return",a.data);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"GetAppRegistration",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/app",t);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"GetAppRegistrations",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createAxiosClient(),e.next=3,t.get("appmanagement/list");case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"RevokeApp",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/revoke",t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"AllowApp",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/allow",t);case 3:a=e.sent,console.log(a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(e){return r.instance||(r.instance=new r(e)),r.instance}}]),r}(r(2008).$);l.instance=void 0},2562:function(e,t,r){r.d(t,{Ac:function(){return a},WW:function(){return i},c$:function(){return s}});var n=r(4990),a=[{name:(0,n.t)("None"),value:0},{name:(0,n.t)("Reader"),value:1},{name:(0,n.t)("Editor"),value:3}],i=[{name:(0,n.t)("None"),value:0},{name:(0,n.t)("Read Connections"),value:10},{name:(0,n.t)("Read Circle Members"),value:50}],s=[{name:(0,n.t)("None"),value:0},{name:(0,n.t)("Read Connections"),value:10},{name:(0,n.t)("Manage Connection Requests"),value:30},{name:(0,n.t)("Read Circle Members"),value:50}]},6458:function(e,t,r){r.r(t),r.d(t,{default:function(){return W}});var n=r(4165),a=r(5861),i=r(9439),s=r(2791),o=r(6871),c=r(4990),l=r(5809),u=r(2851),d=r(1413),p=r(3433),f=r(4164),v=r(4075),m=r(4395),x=r(3412),h=r(2562),y=r(2042),g=r(2284),Z=r(8808),b=r(8930),w=r(184),j=function(e){var t=e.title,r=e.confirmText,o=e.isOpen,l=e.driveDefinition,j=e.onConfirm,k=e.onCancel,N=(0,x.Z)("modal-container"),C=l.targetDriveInfo,D=(0,s.useState)("idle"),I=(0,i.Z)(D,2),A=I[0],S=I[1],M=(0,m.Z)().fetch.data,R=(0,v.Z)({}).createOrUpdate,O=R.mutateAsync,P=R.error,T=(0,s.useState)([]),L=(0,i.Z)(T,2),F=L[0],U=L[1];if(!o)return null;var E=(0,w.jsx)(b.Z,{title:t,onClose:k,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(y.Z,{error:P}),(0,w.jsxs)("form",{onSubmit:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),S("loading"),e.prev=2,e.next=5,Promise.all(F.map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),S("error");case 10:return S("success"),j(),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),children:[null!==M&&void 0!==M&&M.length?(0,w.jsx)("div",{className:"-my-4",children:M.map((function(e){var t,r=null===F||void 0===F?void 0:F.find((function(t){return t.id===e.id})),n=null===(t=(null!==r&&void 0!==r?r:e).driveGrants)||void 0===t?void 0:t.find((function(e){return e.permissionedDrive.drive.alias===C.alias&&e.permissionedDrive.drive.type===C.type})),a=(null===n||void 0===n?void 0:n.permissionedDrive.permission)>0;return(0,w.jsxs)("div",{className:"my-4 flex w-full select-none flex-row rounded-lg border p-4 dark:border-slate-800 ".concat(a&&"bg-slate-50 dark:bg-slate-700"),children:[(0,w.jsx)(Z.Z,{circleDef:e,onClick:function(){},isChecked:a},e.id),(0,w.jsx)(g.Z,{className:"ml-auto",permissionLevels:h.Ac,defaultValue:null===n||void 0===n?void 0:n.permissionedDrive.permission,onChange:function(t){U([].concat((0,p.Z)(F.filter((function(t){return t.id!==e.id}))),[(0,d.Z)((0,d.Z)({},e),{},{driveGrants:[].concat((0,p.Z)(e.driveGrants.filter((function(e){return e.permissionedDrive.drive.alias!==C.alias&&e.permissionedDrive.drive.type!==C.type}))),[{permissionedDrive:{drive:(0,d.Z)({},C),permission:t}}])})]))}})]},e.id)}))}):null,(0,w.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,w.jsx)(u.Z,{className:"m-2",icon:"send",state:A,children:r||(0,c.t)("Save")}),(0,w.jsx)(u.Z,{className:"m-2",type:"secondary",onClick:k,children:(0,c.t)("Cancel")})]})]})]})});return(0,f.createPortal)(E,N)},k=r(144),N=r(2405),C=r(1434),D=r(7385),I=function(e){var t=e.driveDefinition,r=(0,m.Z)().fetch.data,n=(0,k.Z)().fetchRegistered.data,a=t.targetDriveInfo,i=null===r||void 0===r?void 0:r.filter((function(e){var t;return null===(t=e.driveGrants)||void 0===t?void 0:t.some((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}))})),s=null===n||void 0===n?void 0:n.filter((function(e){return e.grant.driveGrants.some((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}))}));return(0,w.jsxs)(w.Fragment,{children:[null!==i&&void 0!==i&&i.length?(0,w.jsx)(C.Z,{title:(0,c.t)("Circles with access:"),isOpaqueBg:!0,children:(0,w.jsx)("ul",{className:"-my-4",children:i.map((function(e){var t,r=e.driveGrants.find((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}));return(0,w.jsx)(Z.Z,{circleDef:e,permissionDetails:(0,D.hz)(null===r||void 0===r||null===(t=r.permissionedDrive)||void 0===t?void 0:t.permission,h.Ac).name,className:"my-4"},e.id)}))})}):null,null!==s&&void 0!==s&&s.length?(0,w.jsx)(C.Z,{title:(0,c.t)("Apps with access:"),isOpaqueBg:!0,children:(0,w.jsx)("ul",{className:"-my-4",children:s.map((function(e){var t=e.grant.driveGrants.find((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}));return(0,w.jsx)(N.Z,{className:"my-4",appDef:e,permissionLevel:(0,D.hz)(null===t||void 0===t?void 0:t.permissionedDrive.permission,h.Ac).name},e.appId)}))})}):null]})},A=r(7927),S=r(9080),M=r(7797),R=r(8347),O=r(706),P=r(4311),T=r(3352),L=r(6802),F=r(3354),U=r(4602),E=r(5536),G=r(3473),B=r(8231),z=function(e){var t=e.children,r=e.className,n=e.icon,a=e.type,i=e.state,s=e.title,o=e.size,c=e.onClick,l=e.download,u=e.href,p=function(e){return"loading"===i?(0,w.jsx)(L.Z,(0,d.Z)({},e)):"success"===i?(0,w.jsx)(P.Z,(0,d.Z)({},e)):"error"===i?(0,w.jsx)(T.Z,(0,d.Z)({},e)):"save"===n?(0,w.jsx)(E.Z,(0,d.Z)({},e)):"send"===n?(0,w.jsx)(O.Z,(0,d.Z)({},e)):"plus"===n?(0,w.jsx)(U.Z,(0,d.Z)({},e)):"trash"===n?(0,w.jsx)(B.Z,(0,d.Z)({},e)):"edit"===n?(0,w.jsx)(F.Z,(0,d.Z)({},e)):"up"===n?(0,w.jsx)(O.Z,(0,d.Z)((0,d.Z)({},e),{},{className:"-rotate-90 ".concat(e.className)})):"down"===n?(0,w.jsx)(O.Z,(0,d.Z)((0,d.Z)({},e),{},{className:"rotate-90 ".concat(e.className)})):"shield"===n?(0,w.jsx)(G.Z,(0,d.Z)((0,d.Z)({},e),{},{fill:"currentColor"})):(0,w.jsx)(w.Fragment,{})},f="error"===i?"bg-red-500 hover:bg-red-600 text-white":"secondary"===a?"bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-800 dark:text-white":"remove"===a?"bg-red-200 hover:bg-red-400 dark:bg-red-700 hover:dark:bg-red-800 dark:text-white":"mute"===a?"":"bg-green-500 hover:bg-green-600 text-white",v=t&&"mute"!==a?"min-w-[6rem] ".concat(null!==r&&void 0!==r&&r.indexOf("w-full")?"":"w-full sm:w-auto"):"",m="large"===o?"px-5 py-3":"small"===o?"px-3 py-1 text-sm":"px-3 py-2",x="loading"===i?"animate-pulse":"";return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("a",{className:"relative flex flex-row rounded-md text-left ".concat(v," ").concat(m," ").concat(f," ").concat(x," ").concat(r),download:l,href:u,title:s,onClick:c,children:[t&&(0,w.jsx)("span",{className:"mr-1",children:t}),(0,w.jsx)(p,{className:"my-auto ml-auto h-4 w-4"})]})})},_=r(8683),W=function(){var e,t=(0,o.UO)().driveKey.split("_"),r=(0,l.Z)({targetDrive:{alias:t[0],type:t[1]}}).fetch,d=r.data,p=r.isLoading,f=(0,R.Z)().exportUnencrypted,v=f.mutateAsync,m=f.status,x=(0,s.useState)(),h=(0,i.Z)(x,2),y=h[0],g=h[1],Z=(0,s.useState)(!1),b=(0,i.Z)(Z,2),k=b[0],N=b[1],D=(0,s.useState)(!1),O=(0,i.Z)(D,2),P=O[0],T=O[1];return p?(0,w.jsx)(M.Z,{}):d?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(S.Z,{icon:A.Z,title:"".concat(d.name),actions:(0,w.jsxs)(w.Fragment,{children:[y?(0,w.jsx)(z,{className:"m-2 animate-pulse",href:y,download:"".concat(d.name,".json"),onClick:function(){return g(void 0)},type:"primary",children:(0,c.t)("Click to Download")}):(0,w.jsx)(u.Z,{onClick:(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=g,e.next=3,v(d);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)}))),className:"m-2",state:m,type:"secondary",children:(0,c.t)("Export")}),(0,w.jsxs)(u.Z,{onClick:(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N(!0));case 1:case"end":return e.stop()}}),e)}))),className:"m-2",type:"secondary",children:[(0,c.t)("Import files"),"..."]}),(0,w.jsx)(u.Z,{onClick:function(){return T(!0)},className:"m-2",children:(0,c.t)("Edit Access")})]}),breadCrumbs:[{href:"/owner/drives",title:"My Drives"},{title:null!==(e=d.name)&&void 0!==e?e:""}]}),(0,w.jsxs)(C.Z,{title:(0,c.t)("Metadata"),isOpaqueBg:!0,children:[(0,w.jsx)("p",{children:d.metadata}),(0,w.jsxs)("ul",{children:[d.allowAnonymousReads?(0,w.jsx)("li",{children:"Allow Anonymous Reads"}):null,d.ownerOnly?(0,w.jsx)("li",{children:"Owner only"}):null,(0,w.jsxs)("li",{children:["Alias: ",d.targetDriveInfo.alias]}),(0,w.jsxs)("li",{children:["Type: ",d.targetDriveInfo.type]})]})]}),(0,w.jsx)(I,{driveDefinition:d}),(0,w.jsx)(_.Z,{title:"".concat((0,c.t)("Import to")," ").concat(d.name),isOpen:k,onConfirm:function(){return N(!1)},onCancel:function(){return N(!1)},targetDrive:d.targetDriveInfo}),(0,w.jsx)(j,{driveDefinition:d,isOpen:P,onCancel:function(){T(!1)},onConfirm:function(){T(!1)},title:"".concat((0,c.t)("Edit access on")," ").concat(d.name)})]}):(0,w.jsx)(w.Fragment,{children:"No matching drive found"})}}}]);
//# sourceMappingURL=458.2837c826.chunk.js.map