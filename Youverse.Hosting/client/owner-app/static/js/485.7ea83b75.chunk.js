"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[485],{9835:function(e,n,t){var r=t(3504),o=t(184);n.Z=function(e){var n=e.name,t=e.href,s=e.className,a=e.children,i=e.onClick,c=function(e){var n=e.children;return t?(0,o.jsx)(r.rU,{to:t,children:n}):(0,o.jsx)(o.Fragment,{children:n})};return(0,o.jsx)("div",{className:s,children:(0,o.jsx)(c,{children:(0,o.jsxs)("div",{className:"h-full rounded-md border-[1px] border-gray-200 border-opacity-60 bg-white transition-colors dark:border-gray-800 dark:bg-gray-800",onClick:i,children:[(0,o.jsx)("div",{className:"aspect-square",children:(0,o.jsx)("img",{src:"https://placehold.co/200",className:"h-full w-full"})}),(0,o.jsxs)("div",{className:"p-2",children:[(0,o.jsx)("h2",{className:"font-thiner mb-6 dark:text-white",children:n}),a]})]})})})}},6916:function(e,n,t){var r=t(1413),o=t(184);n.Z=function(e){var n;return(0,o.jsx)("input",(0,r.Z)((0,r.Z)({},e),{},{type:null!==(n=e.type)&&void 0!==n?n:"input",className:"w-full rounded border border-gray-300 bg-white py-1 px-3 text-base leading-8 text-gray-700 outline-none transition-colors duration-200 ease-in-out focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 ".concat(e.className)}))}},2465:function(e,n,t){var r=t(1413),o=t(184);n.Z=function(e){return(0,o.jsx)("textarea",(0,r.Z)((0,r.Z)({},e),{},{className:"w-full rounded border border-gray-300 bg-white py-1 px-3 text-base leading-8 text-gray-700 outline-none transition-colors duration-200 ease-in-out focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 ".concat(e.className)}))}},4661:function(e,n,t){var r=t(885),o=t(2791),s=t(4665),a=t(184);n.Z=function(e){var n=e.isOpenByDefault,t=void 0===n||n,i=e.title,c=e.className,u=e.children,l=e.isOpaqueBg,d=void 0!==l&&l,f=e.isBorderLess,m=void 0!==f&&f,p=(0,o.useState)(t),h=(0,r.Z)(p,2),g=h[0],x=h[1],v=(0,o.useRef)(null),w=(0,o.useRef)(0);return(0,o.useEffect)((function(){t&&v.current&&(w.current=v.current.clientHeight)}),[g]),(0,a.jsxs)("section",{className:"my-5 rounded-md ".concat(d?m?"":"rounded-lg border-[1px] border-gray-200 border-opacity-80 px-5 dark:border-gray-700":"bg-slate-50 px-5 dark:bg-slate-800 dark:text-slate-300"," ").concat(c),children:[(0,a.jsxs)("div",{className:"relative cursor-pointer border-b-[1px] border-slate-200 py-5 transition-all duration-300 ".concat(g?"border-opacity-100":"border-opacity-0"),onClick:function(){return x(!g)},children:[(0,a.jsx)("h3",{className:"text-2xl dark:text-white",children:i}),(0,a.jsx)("button",{className:"absolute top-0 right-0 bottom-0",children:(0,a.jsx)(s.Z,{className:"h-4 w-4 transition-transform duration-300 ".concat(g?"rotate-90":"-rotate-90")})})]}),(0,a.jsx)("div",{className:"overflow-hidden transition-all duration-300 ",style:{maxHeight:"".concat(g?w.current?w.current:2e3:0,"px")},ref:v,children:(0,a.jsx)("div",{className:"py-5 ",children:u})})]})}},952:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var r=t(4165),o=t(5861),s=t(885),a=t(6117),i=t(5144),c=t(7186),u=t(3004),l=t(4257),d=t(9072),f=t(7903),m=t(9835),p=t(184),h=function(e){var n,t=e.senderDotYouId,r=e.children,o=e.className,s=(0,f.Z)({}),a=s.acceptRequest,i=a.mutate,c=a.status,u=s.ignoreRequest,l=u.mutate,h=u.status;return(0,p.jsxs)(m.Z,{className:o,name:t,href:null!==(n=t&&"/owner/connections/".concat(t))&&void 0!==n?n:void 0,children:[r,(0,p.jsx)(d.Z,{type:"primary",className:"mb-2 w-full",onClick:function(e){return e.preventDefault(),i({senderDotYouId:t}),!1},state:c,children:"Confirm"}),(0,p.jsx)(d.Z,{type:"secondary",className:"mb-2 w-full",onClick:function(e){return e.preventDefault(),l({senderDotYouId:t}),!1},state:h,children:"Ignore"})]})},g=function(e){var n,t=e.recipientDotYouId,r=e.className,o=(0,f.Z)({}).revokeConnectionRequest,s=o.mutate,a=o.status;return(0,p.jsx)(m.Z,{className:r,name:t,href:null!==(n=t&&"/owner/connections/".concat(t))&&void 0!==n?n:void 0,children:(0,p.jsx)(d.Z,{type:"secondary",className:"mb-2 w-full",onClick:function(e){return e.preventDefault(),s({targetDotYouId:t}),!1},state:a,children:"Cancel"})})},x=function(e){var n,t=e.dotYouProfile,r=e.className,o=(0,f.Z)({}).disconnect,s=o.mutate,a=o.status;return(0,p.jsx)(m.Z,{className:r,name:t.givenName&&t.surName?"".concat(t.givenName," ").concat(t.surName):t.dotYouId,href:null!==(n=t.dotYouId&&"/owner/connections/".concat(t.dotYouId))&&void 0!==n?n:void 0,children:(0,p.jsx)(d.Z,{type:"secondary",className:"w-full",onClick:function(e){e.preventDefault(),s({connectionDotYouId:t.dotYouId})},state:a,children:"Remove"})})},v=t(4990),w=t(8491),b=t(4661),Z=t(2982),j=t(2791),y=t(4164),N=t(4395),k=t(3412),C=t(6419),I=t(6916),q=t(2465),S=t(6123),Y=function(e){var n=e.title,t=e.isOpen,r=e.onConfirm,o=e.onCancel,a=(0,k.Z)("modal-container"),i=(0,f.Z)({}).sendConnectionRequest,c=i.mutate,u=i.status,l=(0,N.Z)().fetch.data,m=(0,j.useState)("samwise.digital"),h=(0,s.Z)(m,2),g=h[0],x=h[1],w=(0,j.useState)(""),b=(0,s.Z)(w,2),Y=b[0],D=b[1],R=(0,j.useState)("Frodo"),O=(0,s.Z)(R,2),F=O[0],Q=O[1],B=(0,j.useState)([]),M=(0,s.Z)(B,2),P=M[0],L=M[1];if(!t)return null;var E=(0,p.jsx)(S.Z,{title:n,onClose:o,children:(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),c({message:Y,name:F,targetDotYouId:g,circleIds:P},{onSuccess:function(){setTimeout((function(){return r()}),2e3)}})},children:[(0,p.jsxs)("div",{className:"mb-5",children:[(0,p.jsx)("label",{htmlFor:"dotyouid",children:"Recipient (dot you id)"}),(0,p.jsx)(I.Z,{id:"dotyouid",name:"dotyouid",onChange:function(e){x(e.target.value)},defaultValue:g,required:!0})]}),(0,p.jsxs)("div",{className:"mb-5",children:[(0,p.jsx)("label",{htmlFor:"dotyouid",children:"From:"}),(0,p.jsx)(I.Z,{id:"dotyouid",name:"dotyouid",onChange:function(e){Q(e.target.value)},defaultValue:F,required:!0})]}),(0,p.jsxs)("div",{className:"mb-5",children:[(0,p.jsx)("label",{htmlFor:"message",children:(0,v.t)("Message")}),(0,p.jsx)(q.Z,{id:"message",name:"message",onChange:function(e){D(e.target.value)},required:!0})]}),l.length?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h2",{className:"mb-2 text-lg",children:"Add as member to:"}),l.map((function(e,n){var t;return(0,p.jsxs)("div",{className:"mb-2",children:[(0,p.jsx)(C.Z,{value:e.id,id:e.id,onChange:function(e){var n=(0,Z.Z)(P);e.target.checked?(n.push(e.target.value),L(n)):L(n.filter((function(n){return n!==e.target.value})))}}),(0,p.jsx)("label",{htmlFor:e.id,className:"ml-2 cursor-pointer",children:e.name})]},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,p.jsxs)("div",{className:"-mx-2 py-3 sm:flex sm:flex-row-reverse",children:[(0,p.jsx)(d.Z,{className:"mx-2",state:u,icon:"send",children:(0,v.t)("Send")}),(0,p.jsx)(d.Z,{className:"mx-2",type:"secondary",onClick:o,children:(0,v.t)("Cancel")})]})]})})});return(0,y.createPortal)(E,a)},D=t(959),R=function(){var e=(0,a.Z)().getSharedSecret,n=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(){var t,o,s,a,u,l,d,f,m,p;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=window.location.hostname.toLowerCase().endsWith(".digital"),s="frodo.digital"==window.location.hostname||"frodobaggins.me"==window.location.hostname,"samwise.digital"==window.location.hostname||"samwisegamgee.me"==window.location.hostname,a="",a=o?s?"samwise.digital":"frodo.digital":s?"samwisegamgee.me":"frodobaggins.me",console.log("intended recipient:",a),u=i.e.getInstance(e()),l=c.I.getInstance(e()),n.next=10,l.getConnectionInfo(a);case 10:if(d=n.sent,console.log("connection status",null!==(t=null===d||void 0===d?void 0:d.status)&&void 0!==t?t:"None"),null!=d&&"Connected"==d.status){n.next=40;break}return n.next=15,u.getPendingRequest(a);case 15:if(f=n.sent,console.log("has pending request",null!=f),!f){n.next=29;break}return console.log("accepting the pending request"),n.next=21,u.acceptConnectionRequest(a);case 21:return n.next=23,l.getConnectionInfo(a);case 23:if(p=n.sent,console.log("connection status",null!==(m=null===d||void 0===d?void 0:d.status)&&void 0!==m?m:"None"),null!=p){n.next=27;break}throw"Failed to connect to "+a;case 27:n.next=40;break;case 29:return n.next=31,u.getSentRequest(a);case 31:if(null!=n.sent){n.next=39;break}return console.log("sending a new request"),n.next=36,u.sendRequest(a,"Demo data setup","",[]);case 36:alert("Connection request was sent to ".concat(a,".  You must go to https://").concat(a," and approve their connection")),n.next=40;break;case 39:alert("There is a pending connection request to ".concat(a," from you.  You must go to https://").concat(a," and approve their connection"));case 40:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,p.jsx)("div",{className:"container mx-auto",children:(0,p.jsx)("div",{className:"flex flex-wrap",children:(0,p.jsx)("button",{onClick:n,className:"block w-1/3 rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none",children:"Send connection request"})})})},O=function(){var e=(0,l.Z)(),n=e.fetchPending,t=n.data,r=n.isLoading,o=e.fetchActive,a=o.data,i=o.isLoading,c=e.fetchSent,f=c.data,m=c.isLoading,Z=(0,j.useState)(!1),y=(0,s.Z)(Z,2),N=y[0],k=y[1];return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("section",{children:[(0,p.jsx)(u.Z,{icon:D.Z,title:"Connections",actions:(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(d.Z,{onClick:function(){return k(!0)},icon:"plus",children:(0,v.t)("Send request")})})}),!r&&null!==t&&void 0!==t&&t.length?(0,p.jsx)(w.Z,{isOpaqueBg:!0,isBorderLess:!0,title:(0,v.t)("Connection requests"),children:(0,p.jsx)("div",{className:"-m-1 flex flex-row flex-wrap",children:null===t||void 0===t?void 0:t.map((function(e){return(0,p.jsx)(h,{className:"w-1/2 p-1 sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/6",senderDotYouId:e.senderDotYouId,children:(0,p.jsxs)("div",{className:"-mt-3",children:[(0,p.jsxs)("p",{children:[(0,v.t)("From:")," ",e.name]}),(0,p.jsx)("p",{className:"mb-3 text-sm",children:e.message})]})},e.senderDotYouId)}))})}):null,!i&&null!==a&&void 0!==a&&a.length?(0,p.jsx)(w.Z,{isOpaqueBg:!0,isBorderLess:!0,title:(0,v.t)("Your Connections"),children:(0,p.jsx)("div",{className:"-m-1 flex flex-row flex-wrap",children:null===a||void 0===a?void 0:a.map((function(e){return(0,p.jsx)(x,{className:"w-1/2 p-1 sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/6",dotYouProfile:e},e.dotYouId)}))})}):null,!m&&null!==f&&void 0!==f&&f.length?(0,p.jsx)(b.Z,{isOpaqueBg:!0,isBorderLess:!0,isOpenByDefault:!0,title:(0,v.t)("Sent Connection Requests"),children:(0,p.jsx)("div",{className:"-m-1 flex flex-row flex-wrap",children:null===f||void 0===f?void 0:f.map((function(e){return(0,p.jsx)(g,{className:"w-1/2 p-1 sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/6",recipientDotYouId:e.recipient},e.recipient)}))})}):null,(0,p.jsx)(b.Z,{title:"POC:",isBorderLess:!0,isOpaqueBg:!0,isOpenByDefault:!1,children:(0,p.jsx)(R,{})})]}),(0,p.jsx)(Y,{title:(0,v.t)("Send connection request"),isOpen:N,onConfirm:function(){return k(!1)},onCancel:function(){return k(!1)}})]})}},7903:function(e,n,t){var r=t(4165),o=t(5861),s=t(7408),a=t(7186),i=t(5144),c=t(6117);n.Z=function(e){var n=e.dotYouId,t=(0,s.useQueryClient)(),u=(0,c.Z)().getSharedSecret,l=a.I.getInstance(u()),d=i.e.getInstance(u()),f=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t,o,s,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.dotYouId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l.getConnectionInfo(t);case 5:if(!(o=e.sent)||"None"===o.status){e.next=8;break}return e.abrupt("return",o);case 8:return e.next=10,d.getPendingRequest(t);case 10:if(!(s=e.sent)){e.next=13;break}return e.abrupt("return",s);case 13:return e.next=15,d.getSentRequest(t);case 15:return a=e.sent,e.abrupt("return",null!==a&&void 0!==a?a:o);case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.connectionDotYouId,e.next=3,l.disconnectFromContact(null!==o&&void 0!==o?o:n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t,o,s,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,o=n.message,s=n.name,a=n.circleIds,e.next=3,d.sendRequest(t,o,s,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),h=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,e.next=3,d.deleteSentRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),g=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.acceptConnectionRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.deletePendingRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,s.useQuery)(["connectionInfo",n],(function(){return f({dotYouId:n})}),{refetchOnMount:!0,refetchOnWindowFocus:!1}),disconnect:(0,s.useMutation)(m,{onSuccess:function(e,n){t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n])},onError:function(e){console.error(e)}}),sendConnectionRequest:(0,s.useMutation)(p,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),revokeConnectionRequest:(0,s.useMutation)(h,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),acceptRequest:(0,s.useMutation)(g,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}}),ignoreRequest:(0,s.useMutation)(x,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}})}}},4257:function(e,n,t){var r=t(4165),o=t(5861),s=t(7408),a=t(7186),i=t(5144),c=t(6117);n.Z=function(){var e=(0,c.Z)().getSharedSecret,n=i.e.getInstance(e()),t=a.I.getInstance(e()),u=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getPendingRequests({pageNumber:1,pageSize:10});case 2:return e.next=4,e.sent.results;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSentRequests({pageNumber:1,pageSize:10});case 2:return e.next=4,e.sent.results;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getConnections({pageNumber:1,pageSize:10});case 2:return e.next=4,e.sent.results;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetchPending:(0,s.useQuery)(["pendingConnections"],(function(){return u()}),{refetchOnMount:!1,refetchOnWindowFocus:!1}),fetchSent:(0,s.useQuery)(["sentRequests"],(function(){return l()}),{refetchOnMount:!1,refetchOnWindowFocus:!1}),fetchActive:(0,s.useQuery)(["activeConnections"],(function(){return d()}),{refetchOnMount:!1,refetchOnWindowFocus:!1})}}}}]);
//# sourceMappingURL=485.7ea83b75.chunk.js.map