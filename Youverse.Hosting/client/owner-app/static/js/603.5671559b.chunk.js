"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[603],{2284:function(e,n,r){var t=r(885),a=r(2791),i=r(1261),s=r(4648),c=r(245),o=r(184),u=function(e){var n=e.className,r=e.isChecked,t=e.children,a=e.onChange;return(0,o.jsxs)("li",{className:"flex min-w-[6rem] cursor-pointer select-none flex-row py-1 px-4 hover:bg-slate-100 dark:hover:bg-slate-700 ".concat(n),onClick:a,children:[(0,o.jsx)(s.Z,{className:"my-auto mr-3 h-4 w-4 flex-shrink-0  ".concat(r?"text-slate-700 dark:text-slate-200":"text-transparent")})," ",(0,o.jsx)("span",{className:"mr-auto block h-full py-1",children:t})]})};n.Z=function(e){var n=e.className,r=e.permissionLevels,s=e.onChange,l=e.defaultValue,d=(0,a.useState)(!1),p=(0,t.Z)(d,2),v=p[0],f=p[1],m=(0,a.useState)(l),h=(0,t.Z)(m,2),x=h[0],Z=h[1],g=(0,a.useRef)(null);(0,i.Z)(g,(function(){return f(!1)}));var y=r.reduce((function(e,n){return n.value>e.value&&n.value<=l?n:e}),r[0]),w=function(e){Z(e),s(e)};return(0,o.jsx)("div",{className:null!==n&&void 0!==n?n:"",children:(0,o.jsxs)("div",{className:"relative cursor-pointer rounded-md bg-slate-100 dark:bg-slate-800",onClick:function(){return f(!v)},ref:g,children:[(0,o.jsxs)("div",{className:"flex min-w-[6rem] flex-row py-1 px-2",children:[(0,o.jsx)("span",{className:"my-auto mr-2 select-none",children:y.name})," ",(0,o.jsx)(c.Z,{className:"my-auto ml-auto h-2 w-2 rotate-90"})]}),(0,o.jsx)("ul",{className:"absolute top-[100%] right-0 overflow-hidden bg-white dark:bg-slate-800 ".concat(v?"z-10 max-h-[30rem] border border-slate-100 py-3 shadow-2xl dark:border-slate-700":"max-h-0"),children:r.map((function(e){return(0,o.jsx)(u,{isChecked:0===e.value?x===e.value:x>=e.value,onChange:function(){return x!==e.value?w(e.value):w(0)},children:e.name},e.value)}))})]})})}},245:function(e,n,r){var t=r(184);n.Z=function(e){var n=e.className;return(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",fill:"currentColor",className:n,children:(0,t.jsx)("path",{d:"M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"})})}},8491:function(e,n,r){var t=r(184);n.Z=function(e){var n=e.title,r=e.className,a=e.children,i=e.isOpaqueBg,s=void 0!==i&&i,c=e.isBorderLess,o=void 0!==c&&c;return(0,t.jsxs)("section",{className:"my-5 rounded-md ".concat(s?o?"":"rounded-lg border-[1px] border-gray-200 border-opacity-80 px-5 dark:border-gray-700":"bg-slate-50 px-5 dark:bg-slate-800"," dark:text-slate-300 ").concat(null!==r&&void 0!==r?r:""),children:[n?(0,t.jsx)("div",{className:"relative border-b-[1px] border-gray-200 border-opacity-80 py-5 transition-all duration-300 dark:border-gray-700",children:(0,t.jsx)("h3",{className:"text-2xl dark:text-white",children:n})}):null,(0,t.jsx)("div",{className:"py-5 ",children:a})]})}},5163:function(e,n,r){r.r(n),r.d(n,{default:function(){return G}});var t=r(885),a=r(2791),i=r(6871),s=r(4990),c=r(1512),o=r(9072),u=r(1413),l=r(2982),d=r(4165),p=r(5861),v=r(4164),f=r(7480),m=r(4395),h=r(3412),x=r(2562),Z=r(2284),g=r(715),y=r(6123),w=r(184),j=function(e){var n=e.title,r=e.confirmText,i=e.isOpen,c=e.driveDefinition,j=e.onConfirm,k=e.onCancel,b=(0,h.Z)("modal-container"),C=c.targetDriveInfo,N=(0,a.useState)("idle"),A=(0,t.Z)(N,2),D=A[0],R=A[1],S=(0,m.Z)().fetch.data,O=(0,f.Z)({}).createOrUpdate.mutateAsync,F=(0,a.useState)([]),G=(0,t.Z)(F,2),L=G[0],I=G[1];if(!i)return null;var B=(0,w.jsx)(y.Z,{title:n,onClose:k,children:(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("form",{onSubmit:function(){var e=(0,p.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),R("loading"),e.prev=2,e.next=5,Promise.all(L.map(function(){var e=(0,p.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),R("error");case 10:return R("success"),j(),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(n){return e.apply(this,arguments)}}(),children:[null!==S&&void 0!==S&&S.length?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("h2",{className:"mb-2 flex flex-row text-xl",children:[(0,w.jsx)(g.Z,{className:"my-auto mr-2 h-4 w-4"})," ",(0,s.t)("Circles"),":"]}),S.map((function(e){var n,r=null===L||void 0===L?void 0:L.find((function(n){return n.id===e.id})),t=null===(n=(null!==r&&void 0!==r?r:e).driveGrants)||void 0===n?void 0:n.find((function(e){return e.permissionedDrive.drive.alias===C.alias&&e.permissionedDrive.drive.type===C.type}));return(0,w.jsxs)("div",{className:"mb-5 flex flex-row",children:[(0,w.jsx)("label",{htmlFor:"name",className:"my-auto mr-2",children:e.name}),(0,w.jsx)(Z.Z,{className:"ml-auto",permissionLevels:x.Ac,defaultValue:null===t||void 0===t?void 0:t.permissionedDrive.permission,onChange:function(n){I([].concat((0,l.Z)(L.filter((function(n){return n.id!==e.id}))),[(0,u.Z)((0,u.Z)({},e),{},{driveGrants:[].concat((0,l.Z)(e.driveGrants.filter((function(e){return e.permissionedDrive.drive.alias!==C.alias&&e.permissionedDrive.drive.type!==C.type}))),[{permissionedDrive:{drive:(0,u.Z)({},C),permission:n}}])})]))}})]},e.id)}))]}):null,(0,w.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,w.jsx)(o.Z,{className:"m-2",icon:"send",state:D,children:r||(0,s.t)("Save")}),(0,w.jsx)(o.Z,{className:"m-2",type:"secondary",onClick:k,children:(0,s.t)("Cancel")})]})]})})});return(0,v.createPortal)(B,b)},k=r(144),b=r(3504),C=function(e){var n=e.appDef,r=e.permissionLevel;return n?(0,w.jsx)("div",{className:"mb-4",children:(0,w.jsx)(b.rU,{to:"/owner/apps/".concat(n.appId),children:(0,w.jsxs)("h2",{className:"mb-2 flex flex-row text-xl",children:[(0,w.jsx)(g.Z,{className:"my-auto mr-2 h-4 w-4"})," ",(0,w.jsx)("span",{className:"my-auto",children:n.name}),r&&(0,w.jsxs)("span",{className:"my-auto",children:[": ",r]})]})})}):(0,w.jsx)(w.Fragment,{})},N=r(8808),A=r(8491),D=r(7266),R=function(e){var n=e.driveDefinition,r=(0,m.Z)().fetch.data,t=(0,k.Z)().fetchRegistered.data,a=n.targetDriveInfo,i=null===r||void 0===r?void 0:r.filter((function(e){var n;return null===(n=e.driveGrants)||void 0===n?void 0:n.some((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}))})),c=null===t||void 0===t?void 0:t.filter((function(e){return e.grant.driveGrants.some((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}))}));return(0,w.jsxs)(w.Fragment,{children:[null!==i&&void 0!==i&&i.length?(0,w.jsx)(A.Z,{title:(0,s.t)("Circles with access:"),isOpaqueBg:!0,children:(0,w.jsx)("ul",{children:i.map((function(e){var n,r=e.driveGrants.find((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}));return(0,w.jsx)(N.Z,{circleDef:e,permissionLevel:(0,D.hz)(null===r||void 0===r||null===(n=r.permissionedDrive)||void 0===n?void 0:n.permission,x.Ac).name},e.id)}))})}):null,null!==c&&void 0!==c&&c.length?(0,w.jsx)(A.Z,{title:(0,s.t)("Apps with access:"),isOpaqueBg:!0,children:(0,w.jsx)("ul",{children:c.map((function(e){var n=e.grant.driveGrants.find((function(e){return e.permissionedDrive.drive.alias===a.alias&&e.permissionedDrive.drive.type===a.type}));return(0,w.jsx)(C,{appDef:e,permissionLevel:(0,D.hz)(null===n||void 0===n?void 0:n.permissionedDrive.permission,x.Ac).name},e.appId)}))})}):null]})},S=r(894),O=r(3004),F=r(8739),G=function(){var e,n=(0,i.UO)().driveKey.split("_"),r=(0,c.Z)({targetDrive:{alias:n[0],type:n[1]}}).fetch,u=r.data,l=r.isLoading,d=(0,a.useState)(!1),p=(0,t.Z)(d,2),v=p[0],f=p[1];return l?(0,w.jsx)(F.Z,{}):u?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(O.Z,{icon:S.Z,title:"".concat(u.name),actions:(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(o.Z,{onClick:function(){return f(!0)},className:"m-2",children:"Edit Access"})}),breadCrumbs:[{href:"/owner/drives",title:"My Drives"},{title:null!==(e=u.name)&&void 0!==e?e:""}]}),(0,w.jsxs)(A.Z,{title:(0,s.t)("Metadata"),isOpaqueBg:!0,children:[(0,w.jsx)("p",{children:u.metadata}),(0,w.jsxs)("ul",{children:[u.allowAnonymousReads?(0,w.jsx)("li",{children:"Allow Anonymous Reads"}):null,u.isReadonly?(0,w.jsx)("li",{children:"Read Only"}):null]})]}),(0,w.jsx)(R,{driveDefinition:u}),(0,w.jsx)(j,{driveDefinition:u,isOpen:v,onCancel:function(){f(!1)},onConfirm:function(){f(!1)},title:"".concat((0,s.t)("Edit access on")," ").concat(u.name)})]}):(0,w.jsx)(w.Fragment,{children:"No matching drive found"})}},144:function(e,n,r){var t=r(4165),a=r(5861),i=r(7408),s=r(4180),c=r(6117);n.Z=function(){var e=(0,c.Z)().getSharedSecret,n=s.Z.getInstance(e()),r=function(){var e=(0,a.Z)((0,t.Z)().mark((function e(){var r;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.GetAppRegistrations();case 2:return r=e.sent,e.abrupt("return",null===r||void 0===r?void 0:r.sort((function(e,n){return(e.isRevoked?1:0)-(n.isRevoked?1:0)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetchRegistered:(0,i.useQuery)(["registeredApps"],(function(){return r()}),{refetchOnWindowFocus:!1})}}},4395:function(e,n,r){var t=r(4165),a=r(5861),i=r(7408),s=r(3766),c=r(6117);n.Z=function(){var e=(0,c.Z)().getSharedSecret,n=s.k.getInstance(e()),r=function(){var e=(0,a.Z)((0,t.Z)().mark((function e(){return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getCircles();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetch:(0,i.useQuery)(["circles"],(function(){return r()}),{refetchOnWindowFocus:!1})}}},4180:function(e,n,r){r.d(n,{Z:function(){return u}});var t=r(4165),a=r(5861),i=r(5671),s=r(3144),c=r(9340),o=r(1129),u=function(e){(0,c.Z)(r,e);var n=(0,o.Z)(r);function r(e){return(0,i.Z)(this,r),n.call(this,e)}return(0,s.Z)(r,[{key:"RegisterAppClient",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/client",n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"RegisterChatAppClient_temp",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/chatclient_temp",n);case 3:return a=e.sent,console.log("RegisterChatAppClient_temp returning response"),console.log(a),e.abrupt("return",a.data);case 7:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"RegisterApp",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/register/app",n);case 3:return a=e.sent,console.log("RegisterApp returning response"),console.log(a),e.abrupt("return",a.data);case 7:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"GetAppRegistration",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/app",n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"GetAppRegistrations",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(){var n,r;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.createAxiosClient(),e.next=3,n.get("appmanagement/list");case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"RevokeApp",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/revoke",n);case 3:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"AllowApp",value:function(){var e=(0,a.Z)((0,t.Z)().mark((function e(n){var r,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createAxiosClient(),e.next=3,r.post("appmanagement/allow",n);case 3:a=e.sent,console.log(a);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(e){return r.instance||(r.instance=new r(e)),r.instance}}]),r}(r(2008).$);u.instance=void 0}}]);
//# sourceMappingURL=603.5671559b.chunk.js.map