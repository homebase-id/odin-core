{"version":3,"file":"static/js/654.a5005535.chunk.js","mappings":"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","sources":["provider/app/AppManagementProviderTypes.ts","components/Templates/RegisterChatClient/RegisterChatClient.tsx","provider/app/AppManagementProvider.ts","../node_modules/react-json-pretty/dist/JSONPretty.js","../node_modules/react-json-pretty/dist/monikai.js"],"sourcesContent":["import { DriveGrant } from '../connections/CircleDataTypes';\nimport { PermissionedDrive } from '../../../../transit-lib';\n\nexport interface AppClientRegistrationRequest {\n  appId: string;\n  clientFriendlyName: string;\n  clientPublicKey64: string;\n}\n\nexport interface AppClientRegistrationResponse {\n  /** Version number for how the data field is encrypted */\n  encryptionVersion: number;\n\n  /** RSA encrypted response.  When encryption version == 1, the  first 16 bytes is token id, second 16 bytes is AccessTokenHalfKey, and last 16 bytes is SharedSecret */\n  data: string;\n\n  /** A Guid representing the Id of the access registration */\n  token: string;\n}\n\nexport interface GetAppRequest {\n  /** @format uuid */\n  appId: string;\n}\n\nexport interface AppRegistrationRequest {\n  /** @format uuid */\n  appId: string;\n  name: string | null;\n  permissionSet?: PermissionSet;\n\n  /** The list of drives of which this app should receive access */\n  drives?: DriveGrantRequest[] | null;\n}\n\nexport interface DriveGrantRequest {\n  permissionedDrive: PermissionedDrive;\n  driveMeta?: {\n    name: string;\n    description: string;\n  };\n  //  permission: DrivePermission;\n}\n\nexport interface TargetDrive {\n  alias: string;\n  type: string;\n}\n\nexport interface RedactedAppRegistration {\n  appId: string;\n  name: string;\n  created: number;\n  isRevoked: boolean;\n  grant: RedactedExchangeGrant;\n}\n\nexport interface RedactedExchangeGrant {\n  isRevoked: boolean;\n  permissionSet: PermissionSet;\n  driveGrants: DriveGrant[];\n}\n\n// export interface RedactedDriveGrant {\n//   TargetDrive: TargetDrive;\n//   Permission: DrivePermission;\n// }\n\nexport enum DrivePermission {\n  None = 0,\n  Read = 1 << 0,\n  Write = 1 << 2,\n}\n\nexport interface PermissionSet {\n  keys: number[];\n}\n\nexport enum PermissionFlags {\n  None = 0,\n\n  ReadConnections = 10,\n\n  ReadConnectionRequests = 30,\n\n  ReadCircleMembers = 50,\n}\n","import useAuth from '../../../hooks/auth/useAuth';\nimport {\n  AppClientRegistrationRequest,\n  AppRegistrationRequest,\n  RedactedAppRegistration,\n  DriveGrantRequest,\n  DrivePermission,\n  PermissionFlags,\n  PermissionSet,\n} from '../../../provider/app/AppManagementProviderTypes';\nimport {useEffect, useState} from 'react';\nimport {useSearchParams} from 'react-router-dom';\nimport AppManagementProvider from '../../../provider/app/AppManagementProvider';\nimport {ApiType, DataUtil, DriveProvider} from '@youfoundation/transit-lib';\nimport JSONPretty from 'react-json-pretty';\nimport JSONPrettyMon from 'react-json-pretty/dist/monikai';\n\n// https://frodo.digital/owner/registerchat?fn=todds%20android&rs=odinchat\n\nconst RegisterAppClient = () => {\n  const {getSharedSecret} = useAuth();\n  const [searchParams] = useSearchParams();\n  const [isLoaded, setIsLoaded] = useState<boolean>();\n  const [finalUrl, setFinalUrl] = useState<string | null>();\n  const [appRegistrationRequest, setAppRegistrationRequest] =\n    useState<AppRegistrationRequest | null>(null);\n  const [clientRegistrationRequest, setClientRegistrationRequest] =\n    useState<AppClientRegistrationRequest | null>(null);\n  const [appRegistration, setAppRegistration] = useState<RedactedAppRegistration | null>(null);\n  const [returnScheme, setReturnScheme] = useState<string>();\n\n  const tempProvider = new AppManagementProvider(getSharedSecret());\n  const driveProvider = new DriveProvider({api: ApiType.Owner, sharedSecret: getSharedSecret()});\n\n  const chatAppId = 'EEE777ace3382940';\n  const chatAppName = 'Chatrbox';\n\n  const chatDriveGrantRequest: DriveGrantRequest = {\n    permissionedDrive: {\n      drive: {\n        alias: DataUtil.toByteArrayId('AAA333ace3382940'),\n        type: DataUtil.toByteArrayId('BBB444ace3382940'),\n      },\n      permission: DrivePermission.Read | DrivePermission.Write\n    }\n  };\n\n  const chatPermissionSet: PermissionSet = {\n    keys: [PermissionFlags.ReadConnectionRequests, PermissionFlags.ReadConnections],\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      const appRegRequest: AppRegistrationRequest = {\n        appId: DataUtil.toByteArrayId(chatAppId),\n        name: chatAppName,\n        permissionSet: chatPermissionSet, //TODO - read from parameter\n        drives: [chatDriveGrantRequest], //TODO - this should be parameter a list of drives for which this app requests access (along with permissions)\n      };\n\n      const clientRegRequest: AppClientRegistrationRequest = {\n        appId: appRegRequest.appId,\n        clientPublicKey64: searchParams.get('pk'),\n        clientFriendlyName: searchParams.get('fn'),\n      };\n\n      const appReg = await tempProvider.GetAppRegistration({\n        appId: appRegRequest.appId,\n      });\n\n      setAppRegistration(appReg);\n      setAppRegistrationRequest(appRegRequest);\n      setClientRegistrationRequest(clientRegRequest);\n      setReturnScheme(searchParams.get('rs'));\n      setIsLoaded(true);\n    };\n\n    init();\n  }, [searchParams]);\n\n  const registerApp = async () => {\n    await driveProvider.EnsureDrive(\n      chatDriveGrantRequest.permissionedDrive.drive,\n      'Chat Drive',\n      'Chatr drive',\n      false\n    );\n    await tempProvider.RegisterApp(appRegistrationRequest);\n    await registerClient();\n  };\n\n  const registerClient = async () => {\n    const clientRegistrationResponse = await tempProvider.RegisterChatAppClient_temp(\n      clientRegistrationRequest\n    );\n    const encodedData = encodeURI(clientRegistrationResponse.data);\n\n    const bytes = DataUtil.base64ToUint8Array(encodedData);\n    console.log('bytes', bytes);\n    const url = `${returnScheme}?d=${encodedData}&v=${clientRegistrationResponse.encryptionVersion}`;\n    // window.location.href = url;\n    setFinalUrl(url);\n  };\n\n  if (!isLoaded) {\n    return <div>Loading...</div>;\n  }\n\n  if (finalUrl) {\n    return (\n      <div className=\"container mx-auto\">\n        You have approved the app...\n        <br/>\n        <br/>\n        <a href={finalUrl}>Click to continue...</a>\n        <br/>\n      </div>\n    );\n  }\n\n  return (\n    <section className=\"mt-20\">\n      <div className=\"container mx-auto\">\n        <div className=\"-m-5 flex flex-wrap\">\n          {isLoaded && appRegistration == null && (\n            <div className=\"row\">\n              <div className=\"px-5\">\n                App with id {appRegistrationRequest.appId} is not registered.\n                <br/>\n                Clicking OK will approve the app for use and register this client\n              </div>\n              <div className=\"px-5\">\n                <a\n                  onClick={registerApp}\n                  className=\"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none\"\n                >\n                  Register Now\n                </a>\n              </div>\n            </div>\n          )}\n\n          {isLoaded && appRegistration != null && (\n            <div className=\"row\">\n              <div className=\"px-5\">\n                <div className=\"pb-2\">The App '{appRegistration?.name}' is registered</div>\n                <JSONPretty\n                  id=\"json-pretty\"\n                  theme={JSONPrettyMon}\n                  data={DataUtil.JsonStringify64(appRegistration)}\n                ></JSONPretty>\n              </div>\n              <div className=\"px-5\">\n                <a\n                  onClick={registerClient}\n                  className=\"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none\"\n                >\n                  Register this Client\n                </a>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default RegisterAppClient;\n","import {\n  AppClientRegistrationRequest,\n  AppClientRegistrationResponse,\n  AppRegistrationRequest,\n  RedactedAppRegistration,\n  GetAppRequest,\n} from './AppManagementProviderTypes';\nimport { OwnerProviderBase } from '../OwnerProviderBase';\n\nexport default class AppManagementProvider extends OwnerProviderBase {\n  private static instance: AppManagementProvider;\n  constructor(sharedSecret: Uint8Array | undefined) {\n    super(sharedSecret);\n  }\n\n  //adds the specified client to the list of allowed clients for a given app; returns a CAT\n  async RegisterAppClient(\n    request: AppClientRegistrationRequest\n  ): Promise<AppClientRegistrationResponse> {\n    const client = this.createAxiosClient();\n    const response = await client.post<AppClientRegistrationResponse>(\n      'appmanagement/register/client',\n      request\n    );\n    return response.data;\n  }\n\n  async RegisterChatAppClient_temp(\n    request: AppClientRegistrationRequest\n  ): Promise<AppClientRegistrationResponse> {\n    const client = this.createAxiosClient();\n    const response = await client.post<AppClientRegistrationResponse>(\n      'appmanagement/register/chatclient_temp',\n      request\n    );\n    console.log('RegisterChatAppClient_temp returning response');\n    console.log(response);\n\n    return response.data;\n  }\n\n  async RegisterApp(request: AppRegistrationRequest): Promise<RedactedAppRegistration> {\n    const client = this.createAxiosClient();\n    const response = await client.post<RedactedAppRegistration>(\n      'appmanagement/register/app',\n      request\n    );\n\n    console.log('RegisterApp returning response');\n    console.log(response);\n\n    return response.data;\n  }\n\n  async GetAppRegistration(request: GetAppRequest): Promise<RedactedAppRegistration> {\n    const client = this.createAxiosClient();\n    const response = await client.post<RedactedAppRegistration>('appmanagement/app', request);\n    return response.data;\n  }\n\n  async GetAppRegistrations(): Promise<RedactedAppRegistration[]> {\n    const client = this.createAxiosClient();\n    const response = await client.get<RedactedAppRegistration[]>('appmanagement/list');\n    return response.data;\n  }\n\n  async RevokeApp(request: GetAppRequest): Promise<void> {\n    const client = this.createAxiosClient();\n    await client.post('appmanagement/revoke', request);\n  }\n\n  async AllowApp(request: GetAppRequest): Promise<void> {\n    const client = this.createAxiosClient();\n    const response = await client.post('appmanagement/allow', request);\n    console.log(response);\n  }\n\n  public static getInstance(sharedSecret): AppManagementProvider {\n    if (!AppManagementProvider.instance) {\n      AppManagementProvider.instance = new AppManagementProvider(sharedSecret);\n    }\n\n    return AppManagementProvider.instance;\n  }\n}\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar PropTypes = __importStar(require(\"prop-types\"));\nvar React = __importStar(require(\"react\"));\nfunction getStyleValue(name, theme, styles) {\n    var extra = styles[name + 'Style'] || '';\n    var style = theme ? theme[name] || '' : '';\n    return extra ? extra + \";\" + style : style;\n}\nfunction getStyle(name, theme, styles) {\n    var value = getStyleValue(name, theme, styles);\n    return value ? \" style=\\\"\" + value + \"\\\"\" : '';\n}\nvar xssmap = {\n    '\"': '&quot;',\n    '\\'': '&apos;',\n    '&': '&amp;',\n    '>': '&gt;',\n    '<': '&lt',\n};\nfunction xss(s) {\n    if (!s) {\n        return s;\n    }\n    return s.replace(/<|>|&|\"|'/g, function (m) {\n        return xssmap[m];\n    });\n}\nvar JSONPretty = /** @class */ (function (_super) {\n    __extends(JSONPretty, _super);\n    function JSONPretty() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    JSONPretty.prototype.render = function () {\n        var _a = this.props, json = _a.json, data = _a.data, replacer = _a.replacer, space = _a.space, themeClassName = _a.themeClassName, theme = _a.theme, onJSONPrettyError = _a.onJSONPrettyError, onError = _a.onError, silent = _a.silent, mainStyle = _a.mainStyle, keyStyle = _a.keyStyle, valueStyle = _a.valueStyle, stringStyle = _a.stringStyle, booleanStyle = _a.booleanStyle, errorStyle = _a.errorStyle, rest = __rest(_a, [\"json\", \"data\", \"replacer\", \"space\", \"themeClassName\", \"theme\", \"onJSONPrettyError\", \"onError\", \"silent\", \"mainStyle\", \"keyStyle\", \"valueStyle\", \"stringStyle\", \"booleanStyle\", \"errorStyle\"]);\n        var styles = {\n            mainStyle: mainStyle,\n            keyStyle: keyStyle,\n            valueStyle: valueStyle,\n            stringStyle: stringStyle,\n            booleanStyle: booleanStyle,\n            errorStyle: errorStyle\n        };\n        var obj = data || json;\n        // See https://facebook.github.io/react/warnings/unknown-prop.html\n        if (typeof obj === 'string') {\n            try {\n                obj = JSON.parse(obj);\n            }\n            catch (e) {\n                if (!silent) {\n                    console.warn(\"[react-json-pretty]: \" + e.message);\n                }\n                if (onJSONPrettyError) {\n                    onJSONPrettyError(e);\n                }\n                if (!onJSONPrettyError && onError) {\n                    onError(e);\n                    console.warn('JSONPretty#onError is deprecated, please use JSONPretty#onJSONPrettyError instead');\n                }\n                return (React.createElement(\"div\", __assign({}, rest, { dangerouslySetInnerHTML: { __html: \"<pre class=\\\"__json-pretty-error__\\\"\" + getStyle('error', theme, styles) + \">\" + xss(obj) + \"</pre>\"\n                    } })));\n            }\n        }\n        return (React.createElement(\"div\", __assign({}, rest, { dangerouslySetInnerHTML: { __html: \"<pre class=\\\"\" + themeClassName + \"\\\"\" + getStyle('main', theme, styles) + \">\" + this._pretty(theme, obj, replacer, +space, styles) + \"</pre>\"\n            } })));\n    };\n    // JSON =》 HTML转换器\n    JSONPretty.prototype._pretty = function (theme, obj, replacer, space, styles) {\n        // 逐行匹配，列举：“key”: \"value\" | \"key\": value | \"key\": [ | \"key\": { | \"key\": [],| \"Key\": {},\n        var regLine = /^( *)(\"[^\"]+\": )?(\"[^\"]*\"|[\\w.+-]*)?([,[{]|\\[\\s*\\],?|\\{\\s*\\},?)?$/mg;\n        var text = JSON.stringify(obj, typeof replacer === 'function' ? replacer : null, isNaN(space) ? 2 : space);\n        /* istanbul ignore next */\n        if (!text) {\n            return text;\n        }\n        return text.replace(/&/g, '&amp;').replace(/\\\\\"([^,])/g, '\\\\&quot;$1')\n            .replace(/</g, '&lt;').replace(/>/g, '&gt;')\n            .replace(regLine, this._replace.bind(null, theme, styles));\n    };\n    // 格式化函数\n    JSONPretty.prototype._replace = function (theme, styles, match, ind, key, val, tra) {\n        var spanEnd = '</span>';\n        var keySpan = \"<span class=\\\"__json-key__\\\"\" + getStyle('key', theme, styles) + \">\";\n        var valSpan = \"<span class=\\\"__json-value__\\\"\" + getStyle('value', theme, styles) + \">\";\n        var strSpan = \"<span class=\\\"__json-string__\\\"\" + getStyle('string', theme, styles) + \">\";\n        var booSpan = \"<span class=\\\"__json-boolean__\\\"\" + getStyle('boolean', theme, styles) + \">\";\n        var sps = ind || '';\n        if (key) {\n            sps = sps + '\"' + keySpan + key.replace(/^\"|\":\\s$/g, '') + spanEnd + '\": ';\n        }\n        if (val) {\n            if (val === 'true' || val === 'false') {\n                sps = sps + booSpan + val + spanEnd;\n            }\n            else {\n                sps = sps + (val[0] === '\"' ? strSpan : valSpan) + val + spanEnd;\n            }\n        }\n        return sps + (tra || '');\n    };\n    JSONPretty.propTypes = {\n        data: PropTypes.any,\n        json: PropTypes.any,\n        replacer: PropTypes.func,\n        silent: PropTypes.bool,\n        space: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n        theme: PropTypes.object,\n        themeClassName: PropTypes.string,\n        onJSONPrettyError: PropTypes.func\n    };\n    JSONPretty.defaultProps = {\n        data: '',\n        json: '',\n        silent: true,\n        space: 2,\n        themeClassName: '__json-pretty__',\n    };\n    return JSONPretty;\n}(React.Component));\nmodule.exports = JSONPretty;\n","\"use strict\";\nmodule.exports = {\n    main: 'line-height:1.3;color:#66d9ef;background:#272822;overflow:auto;',\n    error: 'line-height:1.3;color:#66d9ef;background:#272822;overflow:auto;',\n    key: 'color:#f92672;',\n    string: 'color:#fd971f;',\n    value: 'color:#a6e22e;',\n    boolean: 'color:#ac81fe;',\n};\n"],"names":["DrivePermission","PermissionFlags","getSharedSecret","useAuth","useSearchParams","searchParams","useState","isLoaded","setIsLoaded","finalUrl","setFinalUrl","appRegistrationRequest","setAppRegistrationRequest","clientRegistrationRequest","setClientRegistrationRequest","appRegistration","setAppRegistration","returnScheme","setReturnScheme","tempProvider","AppManagementProvider","driveProvider","DriveProvider","api","ApiType","sharedSecret","chatDriveGrantRequest","permissionedDrive","drive","alias","DataUtil","type","permission","Read","Write","chatPermissionSet","keys","ReadConnectionRequests","ReadConnections","useEffect","init","appRegRequest","appId","name","permissionSet","drives","clientRegRequest","clientPublicKey64","get","clientFriendlyName","GetAppRegistration","appReg","registerApp","EnsureDrive","RegisterApp","registerClient","RegisterChatAppClient_temp","clientRegistrationResponse","encodedData","encodeURI","data","bytes","console","log","url","encryptionVersion","className","href","onClick","id","theme","JSONPrettyMon","request","client","this","createAxiosClient","post","response","instance","OwnerProviderBase","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__rest","e","indexOf","getOwnPropertySymbols","__importStar","mod","__esModule","result","k","PropTypes","require","React","getStyle","styles","value","extra","style","getStyleValue","xssmap","JSONPretty","_super","render","_a","props","json","replacer","space","themeClassName","onJSONPrettyError","onError","silent","mainStyle","keyStyle","valueStyle","stringStyle","booleanStyle","errorStyle","rest","obj","JSON","parse","warn","message","createElement","dangerouslySetInnerHTML","__html","replace","m","_pretty","text","stringify","isNaN","_replace","bind","match","ind","key","val","tra","spanEnd","keySpan","valSpan","strSpan","booSpan","sps","propTypes","any","func","bool","oneOfType","number","string","object","defaultProps","Component","module","exports","main","error","boolean"],"sourceRoot":""}