"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[738,476],{9636:function(e,n,t){var r=t(4165),i=t(5861),o=t(1413),a=t(9439),s=t(2791),c=t(4164),u=t(4990),l=t(3412),f=t(3431),d=t(9072),p=t(6916),m=t(2465),v=t(8395),h=t(184);n.Z=function(e){var n=e.title,t=e.confirmText,x=e.isOpen,Z=e.defaultValue,y=e.onConfirm,j=e.onCancel,g=(0,l.Z)("modal-container"),w=(0,f.Z)().saveProfile,S=w.mutateAsync,I=w.status,b=(0,s.useState)((0,o.Z)({},Z)),N=(0,a.Z)(b,2),C=N[0],k=N[1];if(!x)return null;var P=(0,h.jsx)(v.Z,{title:n,onClose:j,children:(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("form",{onSubmit:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,S(C);case 3:return y(),e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,h.jsxs)("div",{className:"mb-5",children:[(0,h.jsx)("label",{htmlFor:"name",children:(0,u.t)("Name")}),(0,h.jsx)(p.Z,{id:"name",name:"profileName",defaultValue:C.name,onChange:function(e){k((0,o.Z)((0,o.Z)({},C),{},{name:e.target.value}))},required:!0})]}),(0,h.jsxs)("div",{className:"mb-5",children:[(0,h.jsx)("label",{htmlFor:"name",children:(0,u.t)("Description")}),(0,h.jsx)(m.Z,{id:"description",name:"profileDescription",defaultValue:C.description,onChange:function(e){k((0,o.Z)((0,o.Z)({},C),{},{description:e.target.value}))},required:!0})]}),(0,h.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,h.jsx)(d.Z,{className:"m-2",state:I,icon:"send",children:t||(0,u.t)("Add Profile")}),(0,h.jsx)(d.Z,{className:"m-2",type:"secondary",onClick:j,children:(0,u.t)("Cancel")})]})]})})});return(0,c.createPortal)(P,g)}},8575:function(e,n,t){var r=t(6871),i=t(3504),o=t(3225),a=t(1191),s=t(184);n.Z=function(e){var n=e.className,t=e.items,c=e.isLoading,u=(0,r.s0)(),l=(null===t||void 0===t?void 0:t.length)>=6;return!0===c?(0,s.jsx)(a.Z,{className:"h-10"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"hidden flex-col flex-wrap ".concat(l?"":"sm:flex"," sm:flex-row ").concat(null!==n&&void 0!==n?n:""),children:t.map((function(e){return(0,s.jsx)(i.OL,{className:function(n){var t,r=n.isActive;return"flex-grow cursor-pointer border-b-2 py-2 px-1 text-lg ".concat(r?"border-indigo-500 text-indigo-500 dark:text-indigo-400":"border-gray-300 transition-colors duration-300 hover:border-indigo-400 dark:border-gray-800 hover:dark:border-indigo-600"," ").concat(null!==(t=e.className)&&void 0!==t?t:"")},to:e.path,end:!0,children:e.title},e.key)}))}),(0,s.jsx)(o.Z,{className:"".concat(l?"":"sm:hidden"," py-4"),onChange:function(e){return u(e.target.value)},value:window.location.pathname,children:t.map((function(e){return(0,s.jsx)("option",{value:e.path,children:e.text||e.title},e.key)}))})]})}},4876:function(e,n,t){t.r(n),t.d(n,{default:function(){return L}});var r=t(4165),i=t(5861),o=t(3433),a=t(9439),s=t(6752),c=t(2791),u=t(6871),l=t(7221),f=t(3431),d=t(1413),p=t(4990),m=t(9077),v=t(9072),h=t(3225),x=t(8491),Z=t(4226),y=t(184),j=function(e){var n,t=e.profileId,r=e.sectionId,i=e.newPriority,o=(0,c.useState)(!1),u=(0,a.Z)(o,2),l=u[0],f=u[1],j=(0,c.useState)(),g=(0,a.Z)(j,2),w=g[0],S=g[1],I=(0,m.Z)({}).save,b=I.mutate,N=I.isLoading,C=I.isError,k=I.isSuccess,P=function(e){var n=Object.values(s.H1).find((function(n){return n.type.toString()===e}));S({id:"",type:e,sectionId:r,priority:i,data:{},typeDefinition:n,profileId:t,acl:{requiredSecurityGroup:s.hh.Owner}})},D=function(){f(!1),S(void 0)};return(0,y.jsx)(y.Fragment,{children:l?(0,y.jsxs)(x.Z,{title:"New".concat(w?":":""," ").concat(null!==(n=null===w||void 0===w?void 0:w.typeDefinition.name)&&void 0!==n?n:""),isOpaqueBg:!0,children:[void 0===w?(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)("label",{htmlFor:"type",children:(0,p.t)("Attribute Type")}),(0,y.jsxs)(h.Z,{id:"type",onChange:function(e){P(e.target.value)},children:[(0,y.jsx)("option",{children:(0,p.t)("Make a selection")}),Object.values(s.H1).map((function(e){return(0,y.jsx)("option",{value:e.type.toString(),children:e.name},e.type.toString())}))]})]}):(0,y.jsx)(Z.Z,{attribute:w,onChange:function(e){if(w){var n=(0,d.Z)({},w);n.data[e.target.name]=e.target.value,S(n)}}}),(0,y.jsxs)("div",{className:"flex flex-row",children:[(0,y.jsx)(v.Z,{type:"secondary",className:"ml-auto",onClick:D,children:(0,p.t)("Cancel")}),(0,y.jsx)(v.Z,{type:"primary",className:"ml-2",onClick:function(){b(w,{onSuccess:function(){D()}})},state:N?"loading":k?"success":C?"error":void 0,children:(0,p.t)("Save")})]})]}):(0,y.jsx)("div",{className:"flex flex-row",children:(0,y.jsx)(v.Z,{type:"primary",className:"mx-auto min-w-[9rem]",onClick:function(e){e&&P(e),f(!0)},options:Object.values(s.H1).map((function(e){return{value:e.type.toString(),name:e.name}})),children:(0,p.t)("Add Attribute")})})})},g=t(6916),w=t(5207),S=t(3004),I=t(3469),b=t(9636),N=t(4655),C=t(7408),k=t(6117),P=function(e){var n=e.profileId,t=(0,C.useQueryClient)(),o=(0,k.Z)().getSharedSecret,a=(0,l.Z)({}).removeAttributes.mutateAsync,c=new s.KU({api:s.Ii.Owner,sharedSecret:o()}),u=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.profileId){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,c.profileDefinitionProvider.getProfileSections(t);case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),f=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.profileId,i=n.profileSection,e.next=3,c.profileDefinitionProvider.saveProfileSection(t,i);case 3:return e.abrupt("return",{profileId:t,profileSection:i});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),d=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.profileId,i=n.profileSection,e.next=3,a({profileId:t,sectionId:i.sectionId});case 3:return e.next=5,c.profileDefinitionProvider.removeProfileSection(t,i.sectionId);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetchAll:(0,C.useQuery)(["profileSections",n],(function(){return u({profileId:n})}),{refetchOnWindowFocus:!1}),save:(0,C.useMutation)(f,{onMutate:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var i,o,a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.profileId,o=n.profileSection,e.next=3,t.cancelQueries(["profileSections",i]);case 3:return a=t.getQueryData(["profileSections",i]),s=null===a||void 0===a?void 0:a.map((function(e){return e.sectionId===o.sectionId?o:e})),t.setQueryData(["profileSections",i],s),e.abrupt("return",{previousSections:a,newSection:o});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),onError:function(e,n,r){console.error(e),t.setQueryData(["profileSections",n.profileId],r.previousSections)},onSettled:function(e){t.invalidateQueries(["profileSections",e.profileId])}}),remove:(0,C.useMutation)(d,{onMutate:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var i,o,a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.profileId,o=n.profileSection,e.next=3,t.cancelQueries(["profileSections",i]);case 3:return a=t.getQueryData(["profileSections",i]),s=null===a||void 0===a?void 0:a.filter((function(e){return e.sectionId!==o.sectionId})),t.setQueryData(["profileSections",i],s),e.abrupt("return",{previousSections:a,toRemoveSection:o});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),onError:function(e,n,r){console.error(e),t.setQueryData(["profileSections",n.profileId],r.previousSections)},onSettled:function(e,n,r){t.invalidateQueries(["profileSections",r.profileId])}})}},D=function(e){var n=e.section,t=e.profileId,r=e.onClose,i=(0,c.useState)((0,d.Z)({},n)),o=(0,a.Z)(i,2),s=o[0],u=o[1],l=P({}),f=l.save,m=f.mutateAsync,h=f.status,Z=l.remove,j=Z.mutateAsync,w=Z.status;return(0,y.jsx)(x.Z,{title:"".concat((0,p.t)("Edit"),": ").concat(n.name),isOpaqueBg:!0,children:(0,y.jsxs)("form",{onSubmit:function(e){e.preventDefault(),m({profileId:t,profileSection:s},{onSuccess:function(){r()}})},children:[(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)("label",{htmlFor:"name",children:(0,p.t)("Name")}),(0,y.jsx)(g.Z,{id:"name",name:"name",defaultValue:n.name,onChange:function(e){var n=(0,d.Z)({},s);n[e.target.name]=e.target.value,u(n)}})]}),(0,y.jsxs)("div",{className:"-m-2 flex flex-row-reverse",children:[(0,y.jsx)(v.Z,{type:"primary",className:"m-2",state:h,children:(0,p.t)("Save")}),(0,y.jsx)(v.Z,{type:"secondary",className:"m-2",onClick:function(e){e.preventDefault(),r()},children:(0,p.t)("Cancel")}),(0,y.jsx)(v.Z,{type:"remove",icon:"trash",className:"m-2 mr-auto",state:w,onClick:function(){return j({profileId:t,profileSection:n})},confirmOptions:{title:(0,p.t)("Remove Section"),body:(0,p.t)("Are you sure you want to remove this section, this action cannot be undone. All attributes within this section will also be removed."),buttonText:(0,p.t)("Remove")},children:(0,p.t)("Remove")})]})]})})},Q=t(8575),A=t(1191),O=t(8739),F=function(e){var n=e.profileId,t=e.onCreate,u=P({profileId:n}),l=u.fetchAll.data,f=u.save,d=f.mutateAsync,m=f.status,h=(0,c.useState)(""),Z=(0,a.Z)(h,2),j=Z[0],w=Z[1],S=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(i){var a,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),a=s.j4.getNewId(),c={sectionId:a,attributes:[],priority:null!==l&&void 0!==l&&l.length?Math.max.apply(Math,(0,o.Z)(l.map((function(e){return e.priority}))))+1e3:1e3,isSystemSection:!1,name:j},e.next=5,d({profileId:n,profileSection:c});case 5:t(a);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,y.jsx)(x.Z,{title:"New: section",isOpaqueBg:!0,children:(0,y.jsxs)("form",{onSubmit:S,children:[(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)("label",{htmlFor:"name",children:(0,p.t)("Name")}),(0,y.jsx)(g.Z,{id:"name",name:"sectionName",onChange:function(e){w(e.target.value)},required:!0})]}),(0,y.jsx)("div",{className:"flex flex-row",children:(0,y.jsx)(v.Z,{className:"ml-auto",state:m,children:(0,p.t)("Add section")})})]})})},M=function(e){var n=e.section,t=e.profileId,r=e.isParentLoading,i=(0,l.Z)({profileId:t,sectionId:null===n||void 0===n?void 0:n.sectionId}).fetch,s=i.data,u=i.isLoading,f=(0,c.useState)(!1),d=(0,a.Z)(f,2),m=d[0],h=d[1];if(!s||u||r)return(0,y.jsxs)("div",{className:"-m-5 pt-5",children:[(0,y.jsx)(A.Z,{className:"m-5 h-20"}),(0,y.jsx)(A.Z,{className:"m-5 h-20"}),(0,y.jsx)(A.Z,{className:"m-5 h-20"}),(0,y.jsx)(A.Z,{className:"m-5 h-20"})]});var x=s.reduce((function(e,n){return-1!==e.indexOf(n.type)?e:[].concat((0,o.Z)(e),[n.type])}),[]).map((function(e){var n=s.filter((function(n){return n.type===e})),t=Math.min.apply(Math,(0,o.Z)(n.map((function(e){return e.priority}))));return{name:n[0].typeDefinition.name,attributes:n,priority:t}}));x.sort((function(e,n){return e.priority-n.priority}));var Z=s.reduce((function(e,n){return e>n.priority?e:n.priority}),0);return(0,y.jsxs)("div",{className:"pt-5",children:[n?m?(0,y.jsx)(D,{section:n,profileId:t,onClose:function(){return h(!1)}},n.sectionId):(0,y.jsxs)("section",{className:"items-center bg-slate-50 p-3 dark:bg-slate-800 sm:flex sm:flex-row",children:[(0,y.jsx)("p",{className:"sm:mr-2",children:n.name}),(0,y.jsx)(v.Z,{type:"secondary",className:"ml-auto",onClick:function(){return h(!0)},children:(0,p.t)("Edit Section")})]}):null,s.length?x.map((function(e){return(0,y.jsx)(I.Z,{groupTitle:e.name,attributes:e.attributes,groupedAttributes:x},e.name)})):(0,y.jsx)("div",{className:"py-5",children:(0,p.t)("section-empty-attributes")}),(0,y.jsx)(j,{profileId:t,sectionId:n.sectionId,newPriority:Z+1e3})]})},L=function(){var e=(0,f.Z)().fetchProfiles,n=e.data,t=e.isLoading,r=(0,u.UO)(),i=r.profileKey,s=r.sectionKey,l=(0,u.s0)(),d=(0,c.useState)(!1),m=(0,a.Z)(d,2),h=m[0],x=m[1],Z=null===n||void 0===n?void 0:n.find((function(e){return e.slug===i})),j=P({profileId:null===Z||void 0===Z?void 0:Z.profileId}).fetchAll,g=j.data,I=j.isLoading,C=decodeURIComponent(s)||(null!==g&&void 0!==g&&g.length?g[0].sectionId:"");if(t)return(0,y.jsx)(O.Z,{});if(!n)return(0,y.jsx)(y.Fragment,{children:(0,p.t)("no-data-found")});if(!Z)return(0,y.jsx)(y.Fragment,{children:"Incorrect profile path"});var k="new"===C||!(null!==g&&void 0!==g&&g.length)&&!I,D=k?void 0:(null===g||void 0===g?void 0:g.find((function(e){return e.sectionId===C})))||(null===g||void 0===g?void 0:g[0]),A=null!==g&&void 0!==g&&g.length?g.map((function(e,n){return{title:e.name,key:e.sectionId,path:0===n?"/owner/profile/".concat(i):"/owner/profile/".concat(i,"/").concat(encodeURIComponent(e.sectionId))}})):[];return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(S.Z,{icon:N.Z,title:Z.name,actions:(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(v.Z,{onClick:function(){return x(!0)},className:"m-2",children:(0,p.t)("Edit Profile")})}),breadCrumbs:[{href:"/owner/profile",title:"My Profiles"},{title:i}]}),(0,y.jsx)(Q.Z,{className:"mt-5",items:[].concat((0,o.Z)(A),[{title:(0,y.jsx)(w.Z,{className:"h-5 w-5"}),text:"-- ".concat((0,p.t)("Create new section")," --"),key:"new",path:"/owner/profile/".concat(i,"/new"),className:"flex-grow-0"}]),isLoading:I}),k?(0,y.jsx)(F,{profileId:Z.profileId,onCreate:function(e){return l("/owner/profile/".concat(i,"/").concat(e))}}):(0,y.jsx)(M,{section:D,profileId:null===Z||void 0===Z?void 0:Z.profileId,isParentLoading:I},null===D||void 0===D?void 0:D.sectionId),(0,y.jsx)(b.Z,{isOpen:h,title:(0,p.t)("Edit Profile: ")+Z.name,confirmText:(0,p.t)("Save"),defaultValue:Z,onCancel:function(){x(!1)},onConfirm:function(){x(!1)}})]})}},3990:function(e,n,t){t.d(n,{P:function(){return i},V:function(){return r}});var r=function(e){return e.split(" ").join("-").toLowerCase()},i=function(e){return Object.keys(e).map((function(n){return n+"="+e[n]})).join("&")}},3431:function(e,n,t){var r=t(4165),i=t(1413),o=t(5861),a=t(7408),s=t(6752),c=t(3990),u=t(6117);n.Z=function(){var e=(0,a.useQueryClient)(),n=(0,u.Z)().getSharedSecret,t=new s.KU({api:s.Ii.Owner,sharedSecret:n()}),l=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.profileDefinitionProvider.getProfileDefinitions();case 2:return e.next=4,e.sent.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{slug:(0,c.V)(e.name)})}));case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.profileDefinitionProvider.saveProfileDefinition(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetchProfiles:(0,a.useQuery)(["profiles"],(function(){return l()}),{refetchOnWindowFocus:!1}),saveProfile:(0,a.useMutation)(f,{onMutate:function(){var n=(0,o.Z)((0,r.Z)().mark((function n(t){var o,a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.cancelQueries(["profiles"]);case 2:return o=e.getQueryData(["profiles"]),a=null===o||void 0===o?void 0:o.map((function(e){return e.profileId===t.profileId?(0,i.Z)((0,i.Z)({},t),{},{slug:(0,c.V)(t.name)}):e})),e.setQueryData(["profiles"],a),n.abrupt("return",{previousProfiles:o,newProfile:t});case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),onError:function(n,t,r){console.error(n),e.setQueryData(["profiles"],r.previousProfiles)},onSettled:function(){e.invalidateQueries(["profiles"])}})}}}}]);
//# sourceMappingURL=738.160492aa.chunk.js.map