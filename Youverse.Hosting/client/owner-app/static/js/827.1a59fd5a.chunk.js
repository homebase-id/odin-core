"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[827],{8683:function(e,t,r){var n=r(4165),a=r(5861),s=r(9439),i=r(9631),c=r(2791),o=r(4164),l=r(4990),u=r(8347),d=r(3412),f=r(9747),p=r(2042),m=r(2851),x=r(8930),v=r(184);t.Z=function(e){var t=e.title,r=e.confirmText,h=e.isOpen,y=e.targetDrive,g=e.onCancel,b=(0,d.Z)("modal-container"),w=(0,u.Z)().importUnencrypted,Z=w.mutateAsync,j=w.status,k=w.error,I=(0,c.useState)(),N=(0,s.Z)(I,2),D=N[0],S=N[1],M=(0,c.useState)(),C=(0,s.Z)(M,2),T=C[0],P=C[1],A=(0,c.useState)(),E=(0,s.Z)(A,2),O=E[0],U=E[1];if(!h)return null;var L=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=2;break}return e.abrupt("return");case 2:return e.t0=U,e.next=5,Z({drive:y,formatDrive:t,data:T});case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=(0,v.jsx)(x.Z,{title:t,onClose:g,size:"2xlarge",children:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(p.Z,{error:k}),D&&(0,v.jsx)(f.Z,{type:"critical",className:"mb-8",children:D}),(0,v.jsx)("input",{onChange:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,s,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.target.files[0])){e.next=14;break}return e.next=4,r.arrayBuffer();case 4:if(a=e.sent,s=i.j4.byteArrayToString(new Uint8Array(a)),c=JSON.parse(s),(0,u.V)(c)){e.next=12;break}return S((0,l.t)("The file provided is not in the right JSON format")),e.abrupt("return");case 12:S(void 0);case 13:P(c);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),type:"file",accept:"application/json",className:"w-full rounded border border-gray-300 bg-white py-1 px-3 text-base leading-8 text-gray-700 outline-none transition-colors duration-200 ease-in-out focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"}),T&&(0,v.jsxs)("div",{className:"my-8",children:[y?(T.metadata.drive.targetDriveInfo.alias!==y.alias||T.metadata.drive.targetDriveInfo.type!==y.type)&&(0,v.jsxs)("p",{className:"pb-2 text-orange-600",children:[(0,l.t)("Warning"),": ",(0,l.t)("the export originates from a different drive")]}):(0,v.jsxs)("p",{className:"pb-2",children:[(0,l.t)("A new drive will be created:")," ",T.metadata.drive.name]}),(0,v.jsxs)("p",{className:"mb-6 text-xl",children:[(0,l.t)("Found the following")," ",T.files.length," ",(0,l.t)("files"),"."," ",(0,v.jsxs)("small",{className:"block text-sm",children:[(0,l.t)("Exported on"),":"," ",new Date(T.metadata.date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})]})]}),(0,v.jsx)("ul",{className:"-my-1 max-h-[25vh] overflow-auto",children:T.files.map((function(e){var t;return(0,v.jsxs)("li",{className:"my-1 flex flex-row rounded-lg border border-slate-200 px-2 py-1 dark:border-slate-700 ".concat(O&&(!0===(null===O||void 0===O||null===(t=O.find((function(t){return t.fileId===e.fileId})))||void 0===t?void 0:t.status)?"bg-green-200 dark:bg-green-900":"bg-red-200 dark:bg-red-900")),children:[e.fileId," ",(0,v.jsx)("span",{className:"ml-auto",children:e.fileMetadata.contentType})]},e.fileId)}))}),y?(0,v.jsx)("small",{className:"mt-6 block text-sm",children:(0,l.t)("Data on the drive will be overwritten when importing")}):null]}),(0,v.jsxs)("div",{className:"-m-2 flex flex-row-reverse pt-10 ",children:[(0,v.jsx)(m.Z,{className:"m-2",onClick:function(){return L()},state:j,children:null!==r&&void 0!==r?r:(0,l.t)("Import")}),(0,v.jsx)(m.Z,{className:"m-2",onClick:function(){return L(!0)},state:j,type:"secondary",children:(0,l.t)("Clean drive & import")}),(0,v.jsx)(m.Z,{className:"m-2",type:"secondary",onClick:g,children:(0,l.t)("Close")})]})]})});return(0,o.createPortal)(F,b)}},3756:function(e,t,r){var n=r(9439),a=r(2791),s=r(4990),i=r(9747),c=r(184);t.Z=function(e){var t=e.className,r=e.state,o=e.error,l=(0,a.useState)(null),u=(0,n.Z)(l,2),d=u[0],f=u[1],p=(0,a.useState)(new Date),m=(0,n.Z)(p,2),x=m[0],v=m[1];if((0,a.useEffect)((function(){"success"===r&&f(new Date)}),[r]),(0,a.useEffect)((function(){var e=setTimeout((function(){v(new Date)}),3e4);return function(){clearTimeout(e)}}),[x]),"loading"===r)return(0,c.jsx)("p",{className:"".concat(t," text-sm"),children:"Saving..."});if("error"===r)return(0,c.jsx)(i.Z,{type:"critical",className:t,children:o instanceof Error?o.message:(0,s.t)("Something went wrong")});if(!d)return null;var h=x.getTime()-d.getTime(),y=d?h<=6e4?"a few seconds ago":h<=6e5?"a few minutes ago":d.toLocaleString():"";return y?(0,c.jsxs)("p",{className:"".concat(t," text-sm"),children:["Last saved ",y]}):null}},9080:function(e,t,r){var n=r(6907),a=r(3504),s=r(3756),i=r(184);t.Z=function(e){var t=e.title,r=e.actions,c=e.saveStatus,o=e.breadCrumbs,l=e.icon;return(0,i.jsx)("section",{className:"-mx-5 -mt-4 mb-10 border-b-2 border-gray-100 bg-slate-50 py-4 pr-5 pl-10 dark:border-gray-700 dark:bg-slate-800 sm:-mx-10 sm:-mt-8 sm:py-8 sm:px-10",children:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row",children:[(0,i.jsxs)("div",{className:"flex-col",children:[o&&(0,i.jsx)("ul",{className:"mb-2 hidden flex-row sm:flex",children:o.map((function(e,t){return(0,i.jsx)("li",{className:"mr-2",children:e.href?(0,i.jsxs)(a.rU,{to:e.href,className:"",children:[e.title,(0,i.jsx)("span",{className:"ml-2",children:">"})]}):(0,i.jsx)("span",{className:"text-slate-500",children:e.title})},t)}))}),t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("h1",{className:"mb-5 flex flex-row text-4xl dark:text-white",children:[l&&l({className:"h-8 w-8 my-auto mr-4"})," ",t]}),(0,i.jsx)(n.ql,{children:(0,i.jsxs)("title",{children:["object"!==typeof t&&"".concat(t)||window.location.pathname.split("/").pop()," ","| Owner console"]})})]})]}),(0,i.jsxs)("div",{className:"ml-auto",children:[(0,i.jsx)("div",{className:"-m-2 flex flex-col flex-wrap justify-end sm:flex-row sm:items-center",children:r}),c&&(0,i.jsx)(s.Z,{className:"mt-1",state:c})]})]})})}},6770:function(e,t,r){var n=r(4165),a=r(5861),s=r(7408),i=r(9631),c=r(8609);t.Z=function(){var e=(0,c.ZP)().getSharedSecret,t=new i.AO({api:i.Ii.Owner,sharedSecret:e()}),r=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.driveProvider.GetDrives({pageNumber:1,pageSize:100});case 2:return e.next=4,e.sent.results;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetch:(0,s.useQuery)(["drives"],(function(){return r()}),{refetchOnWindowFocus:!1})}}},8347:function(e,t,r){r.d(t,{V:function(){return d}});var n=r(1413),a=r(3433),s=r(4165),i=r(5861),c=r(7408),o=r(9631),l=r(8609),u=function(e){return new Promise((function(t){return setTimeout(t,e)}))},d=function(e){return"object"===typeof e&&"metadata"in e&&"files"in e&&(!(!("files"in e)||!Array.isArray(e.files)||null===e.files||0===e.files.length)&&!e.files.some((function(e){return!("payload"in e)||!("fileId"in e)||!("fileMetadata"in e)||!("contentType"in e.fileMetadata)||!("string"===typeof e.payload||"object"===typeof e.payload)})))};t.Z=function(){var e=(0,l.ZP)().getSharedSecret,t=new o.AO({api:o.Ii.Owner,sharedSecret:e()}),r=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(r){var n,c,o,l,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.driveProvider.QueryBatch({targetDrive:r},{maxRecords:10,includeMetadataHeader:true,cursorState:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=[],o=void 0,l=0;case 4:if(!(l<10)){e.next=15;break}return e.next=7,n(o);case 7:if(u=e.sent,c.push.apply(c,(0,a.Z)(u.searchResults)),o=u.cursorState,!(u.searchResults.length<10)){e.next=12;break}return e.abrupt("break",15);case 12:l++,e.next=4;break;case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(a){var c,l,d,f,p,m,x,v,h,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.targetDriveInfo,e.next=3,r(c);case 3:if(l=e.sent,d=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/json"!==r.fileMetadata.contentType){e.next=6;break}return e.next=3,t.driveProvider.GetPayload(c,r.fileId,r.fileMetadata,r.sharedSecretEncryptedKeyHeader,true);case 3:return e.abrupt("return",e.sent);case 6:if(!r.fileMetadata.payloadIsEncrypted){e.next=12;break}return e.next=9,t.driveProvider.DecryptKeyHeader(r.sharedSecretEncryptedKeyHeader);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=void 0;case 13:return n=e.t0,e.next=16,t.driveProvider.GetPayloadBytes(c,r.fileId,n);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.fileId,e.t1={contentType:t.fileMetadata.contentType,senderDotYouId:t.fileMetadata.senderDotYouId,payloadIsEncrypted:t.fileMetadata.payloadIsEncrypted,accessControlList:t.serverMetadata.accessControlList,appData:(0,n.Z)((0,n.Z)({},t.fileMetadata.appData),{},{jsonContent:void 0,previewThumbnail:void 0,additionalThumbnails:void 0,contentIsComplete:void 0})},e.next=4,d(t);case 4:return e.t2=e.sent,e.abrupt("return",{fileId:e.t0,fileMetadata:e.t1,payload:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!localStorage.getItem("export-timeout")){e.next=24;break}m=parseInt(localStorage.getItem("export-timeout")),console.log("exporting with",m),p=[],x=0;case 11:if(!(x<l.length)){e.next=22;break}return e.next=14,u(m);case 14:return e.t0=p,e.next=17,f(l[x]);case 17:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 19:x++,e.next=11;break;case 22:e.next=27;break;case 24:return e.next=26,Promise.all(l.map(function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 26:p=e.sent;case 27:return v={metadata:{drive:(0,n.Z)({},a),date:(new Date).toString()},files:p},h=o.j4.JsonStringify64(v),y=window.URL.createObjectURL(new Blob([h],{type:"application/json;charset=utf-8"})),e.abrupt("return",y);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(n);case 2:return a=e.sent,e.next=5,Promise.all(a.map(function(){var e=(0,i.Z)((0,s.Z)().mark((function e(r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.driveProvider.DeleteFile(n,r.fileId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(r){var a,c,l,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.drive,c=r.formatDrive,l=r.data,d(l)){e.next=3;break}return e.abrupt("return",[{fileId:"root",status:!1}]);case 3:if(u=a){e.next=10;break}return e.next=7,t.driveProvider.EnsureDrive(l.metadata.drive.targetDriveInfo,l.metadata.drive.name,l.metadata.drive.metadata,l.metadata.drive.allowAnonymousReads);case 7:u=l.metadata.drive.targetDriveInfo,e.next=13;break;case 10:if(!c){e.next=13;break}return e.next=13,p(u);case 13:return e.next=15,Promise.all(l.files.map(function(){var e=(0,i.Z)((0,s.Z)().mark((function e(r){var a,i,l,d,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!["image/png","image/jpeg","image/tiff","image/webp","image/svg+xml"].includes(r.fileMetadata.contentType)){e.next=6;break}return e.next=4,t.mediaProvider.uploadImage(u,r.fileMetadata.appData.tags,r.fileMetadata.accessControlList,o.j4.base64ToUint8Array(r.payload.toString()),c?void 0:r.fileId,r.fileMetadata.contentType);case 4:e.next=13;break;case 6:return a={transferIv:t.driveProvider.Random16(),storageOptions:{overwriteFileId:c?void 0:r.fileId,drive:u},transitOptions:null},i="application/json"===r.fileMetadata.contentType&&o.j4.JsonStringify64(r.payload),l=i?o.j4.stringToUint8Array(i):o.j4.base64ToUint8Array(r.payload.toString()),d=l.length<3e3,f={contentType:r.fileMetadata.contentType,senderDotYouId:r.fileMetadata.senderDotYouId,payloadIsEncrypted:r.fileMetadata.payloadIsEncrypted,accessControlList:r.fileMetadata.accessControlList,appData:(0,n.Z)((0,n.Z)({},r.fileMetadata.appData),{},{contentIsComplete:d,jsonContent:d?i:null})},e.next=13,t.driveProvider.Upload(a,f,l,void 0,r.fileMetadata.payloadIsEncrypted);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{fileId:r.fileId,status:!1});case 19:return e.abrupt("return",{fileId:r.fileId,status:!0});case 20:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()));case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{exportUnencrypted:(0,c.useMutation)(f),importUnencrypted:(0,c.useMutation)(m)}}},8827:function(e,t,r){r.r(t);var n=r(4165),a=r(5861),s=r(9439),i=r(2791),c=r(3504),o=r(4990),l=r(6770),u=r(2851),d=r(8683),f=r(7927),p=r(9080),m=r(4411),x=r(184),v=function(e){var t=e.driveDefinition,r=e.className;return(0,x.jsx)("div",{className:"".concat(r),children:(0,x.jsxs)(c.rU,{to:"".concat(t.targetDriveInfo.alias,"_").concat(t.targetDriveInfo.type),className:"block h-full rounded-md border-[1px] border-gray-200 border-opacity-60 bg-white transition-colors hover:shadow-md dark:border-gray-800 dark:bg-gray-800 hover:dark:shadow-slate-600",children:[(0,x.jsx)("h2",{className:"bg-slate-100 p-4 text-xl dark:bg-slate-700 dark:text-slate-200",children:t.name}),(0,x.jsxs)("div",{className:"p-4",children:[(0,x.jsx)("h3",{className:"text-lg",children:"Metadata"}),(0,x.jsx)("p",{children:t.metadata}),(0,x.jsx)("ul",{children:t.allowAnonymousReads?(0,x.jsx)("li",{children:"Allow Anonymous Reads"}):null})]})]})})};t.default=function(){var e=(0,l.Z)().fetch,t=e.data,r=e.isLoading,c=(0,i.useState)(!1),h=(0,s.Z)(c,2),y=h[0],g=h[1];return r&&x.Fragment,(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.Z,{icon:f.Z,title:(0,o.t)("My Drives"),actions:(0,x.jsxs)(u.Z,{onClick:(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(!0));case 1:case"end":return e.stop()}}),e)}))),className:"m-2",type:"secondary",children:[(0,o.t)("Import drive"),"..."]})}),(0,x.jsx)("section",{className:"-my-4",children:r?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.Z,{className:"m-4 h-10"}),(0,x.jsx)(m.Z,{className:"m-4 h-10"}),(0,x.jsx)(m.Z,{className:"m-4 h-10"})]}):(0,x.jsx)(x.Fragment,{children:t?t.map((function(e){return(0,x.jsx)(v,{driveDefinition:e,className:"py-4"},"".concat(e.targetDriveInfo.alias,"-").concat(e.targetDriveInfo.type))})):null})}),(0,x.jsx)(d.Z,{title:"".concat((0,o.t)("Import new Drive")),isOpen:y,onConfirm:function(){return g(!1)},onCancel:function(){return g(!1)}})]})}}}]);
//# sourceMappingURL=827.1a59fd5a.chunk.js.map