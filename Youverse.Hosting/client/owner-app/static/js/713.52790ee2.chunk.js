"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[713],{5300:function(t,e,n){var r=n(184);e.Z=function(t){var e=t.initials,n=t.className;return(0,r.jsx)("div",{className:"flex min-h-full min-w-full bg-slate-200 text-4xl font-light text-white dark:bg-slate-700 dark:text-black sm:text-6xl ".concat(null!==n&&void 0!==n?n:""),children:(0,r.jsx)("span",{className:"m-auto uppercase",children:e})})}},3990:function(t,e,n){n.d(e,{P:function(){return a},V:function(){return r}});var r=function(t){return t.split(" ").join("-").toLowerCase()},a=function(t){return Object.keys(t).map((function(e){return e+"="+t[e]})).join("&")}},6703:function(t,e,n){n.d(e,{i:function(){return d}});var r=n(4165),a=n(1413),o=n(5861),i=n(7408),u=n(6752),c=n(7186),s=n(5144),p=n(8534),l=n(6117),d=function(t){if(!t.image)return(0,a.Z)((0,a.Z)({},t),{},{image:void 0});var e=u.j4.base64ToUint8Array(t.image.content),n=window.URL.createObjectURL(new Blob([e]));return(0,a.Z)((0,a.Z)({},t),{},{image:(0,a.Z)((0,a.Z)({},t.image),{},{url:n})})};e.Z=function(t){var e=t.dotYouId,n=t.id,f=(0,l.Z)().getSharedSecret,h=p.m.getInstance(f()),v=c.I.getInstance(f()),Z=s.e.getInstance(f()),g=(0,i.useQueryClient)(),y=function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n,o,i,u,c,s,p,l,f,v;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.dotYouId,o=e.id,n){t.next=8;break}if(o){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,h.getContactByTag(o);case 6:return i=t.sent,t.abrupt("return",i&&d(i));case 8:return t.next=10,h.getContactByTag(n);case 10:if(!(u=t.sent)||"public"===u.source){t.next=13;break}return t.abrupt("return",d(u));case 13:return t.next=15,m(n);case 15:if(!(c=t.sent)){t.next=21;break}return t.next=19,h.saveContact((0,a.Z)((0,a.Z)({},c),{},{dotYouId:n}));case 19:return s=t.sent,t.abrupt("return",d(s));case 21:if(console.log("Contact book and connection detail is empty for ".concat(n,", gone hunting for best fallback")),p){t.next=36;break}return t.next=25,x(n);case 25:if(t.t1=l=t.sent,t.t0=null!==t.t1,!t.t0){t.next=29;break}t.t0=void 0!==l;case 29:if(!t.t0){t.next=33;break}t.t2=l,t.next=34;break;case 33:t.t2=void 0;case 34:f=t.t2,p=f?(0,a.Z)((0,a.Z)({},u),f):p;case 36:if(p){t.next=41;break}return t.next=39,b(n);case 39:v=t.sent,p=v?(0,a.Z)((0,a.Z)({},u),v):p;case 41:if(!p){t.next=43;break}return t.abrupt("return",d(p));case 43:return t.abrupt("return",void 0);case 44:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getConnectionInfo(e,!0);case 2:if(null===(n=t.sent)||void 0===n||!n.originalContactData){t.next=5;break}return t.abrupt("return",{name:{givenName:n.originalContactData.givenName,surname:n.originalContactData.surname},image:n.originalContactData.image,source:"contact"});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Z.getPendingRequest(e,!0);case 3:if((n=t.sent).senderDotYouId!==e){t.next=7;break}if(null===n||void 0===n||!n.contactData){t.next=7;break}return t.abrupt("return",{name:{givenName:n.contactData.givenName,surname:n.contactData.surname},image:n.contactData.image,source:"pending"});case 7:t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return");case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n,o,i,c,s,p,l,d,f,h,v,Z,g,y;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=new u.pt({api:u.Ii.YouAuth,root:e}),t.next=3,l.fileReadOnlyProvider.GetFile("public.json");case 3:if(d=t.sent,f=null===d||void 0===d||null===(n=d.get("name"))||void 0===n?void 0:n[0],h=null===d||void 0===d||null===(o=d.get("photo"))||void 0===o?void 0:o[0],v=null!==(i=null===d||void 0===d||null===(c=d.get(null===h||void 0===h||null===(s=h.payload)||void 0===s||null===(p=s.data)||void 0===p?void 0:p.profileImageId))||void 0===c?void 0:c[0])&&void 0!==i?i:void 0){t.next=9;break}return t.abrupt("return",{name:null!==f&&void 0!==f&&null!==(Z=f.payload)&&void 0!==Z&&Z.data.givenName||null!==f&&void 0!==f&&null!==(g=f.payload)&&void 0!==g&&g.data.surname?{givenName:f.payload.data.givenName,surname:f.payload.data.surname}:void 0,image:void 0,source:"public"});case 9:return y=v.additionalThumbnails.reduce((function(t,e){return t.pixelWidth<e.pixelWidth&&e.pixelWidth<=250?e:t}),(0,a.Z)((0,a.Z)({},v.header.fileMetadata.appData.previewThumbnail),{},{pixelWidth:20,pixelHeight:20})),t.abrupt("return",{name:f.payload.data.givenName||f.payload.data.surname?{givenName:f.payload.data.givenName,surname:f.payload.data.surname}:void 0,image:{pixelWidth:y.pixelWidth,pixelHeight:y.pixelHeight,contentType:y.contentType,content:y.content.toString()},source:"public"});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n,o,i,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=e.contact).id&&o.dotYouId){t.next=4;break}return console.warn("Missing data to fetch new contact data reliable"),t.abrupt("return");case 4:return t.next=6,m(o.dotYouId);case 6:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=10;break}t.t0=void 0!==n;case 10:if(!t.t0){t.next=14;break}t.t2=n,t.next=15;break;case 14:t.t2=void 0;case 15:if(u=t.t2,!(i=u?(0,a.Z)((0,a.Z)({},o),u):void 0)){t.next=22;break}return t.next=20,h.saveContact((0,a.Z)((0,a.Z)({},i),{},{dotYouId:o.dotYouId}));case 20:return i=t.sent,t.abrupt("return");case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{fetch:(0,i.useQuery)(["contact",null!==e&&void 0!==e?e:n],(function(){return y({dotYouId:e,id:n})}),{refetchOnWindowFocus:!1,onError:function(t){return console.error(t)},retry:!1}),refresh:(0,i.useMutation)(k,{onMutate:function(){var t=(0,o.Z)((0,r.Z)().mark((function t(a){var o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.cancelQueries(["contact",null!==e&&void 0!==e?e:n]);case 2:return o=g.getQueryData(["contact",null!==e&&void 0!==e?e:n]),g.setQueryData(["contact",null!==e&&void 0!==e?e:n],a),t.abrupt("return",{previousContact:o,newContact:a});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onError:function(t,r,a){console.error(t),g.setQueryData(["contact",null!==e&&void 0!==e?e:n],a.previousContact)},onSettled:function(){g.invalidateQueries(["contact",null!==e&&void 0!==e?e:n])}})}}},9779:function(t,e,n){var r=n(4165),a=n(5861),o=n(7408),i=n(6752),u=n(6117),c={alias:i.Ib.BlogMainContentDriveId.toString(),type:i.Hm.DriveType.toString()};e.Z=function(t,e){var n=(0,u.Z)().getSharedSecret,s=(0,o.useQueryClient)(),p=new i.KU({api:i.Ii.Owner,sharedSecret:n()}),l=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e,n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e&&""!==e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,p.mediaProvider.getDecryptedImageUrl(null!==n&&void 0!==n?n:c,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),d=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a,o,u,s,l,d;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.bytes,a=e.targetDrive,o=void 0===a?c:a,u=e.acl,s=void 0===u?{requiredSecurityGroup:i.hh.Anonymous}:u,l=e.fileId,d=void 0===l?void 0:l,t.next=3,p.mediaProvider.uploadImage(o,void 0,s,n,d);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.targetDrive,a=void 0===n?c:n,o=e.fileId,t.next=3,p.mediaProvider.removeImage(o,a);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{fetch:(0,o.useQuery)(["image",t,e],(function(){return l(t,e)}),{refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:1/0}),save:(0,o.useMutation)(d,{onSuccess:function(t,e){var n;e.fileId?s.removeQueries(["image",e.fileId,null!==(n=e.targetDrive)&&void 0!==n?n:c]):s.removeQueries(["image"])}}),remove:(0,o.useMutation)(f,{onSuccess:function(t,e){var n;e.fileId?s.removeQueries(["image",e.fileId,null!==(n=e.targetDrive)&&void 0!==n?n:c]):s.removeQueries(["image"])}})}}},7186:function(t,e,n){n.d(e,{I:function(){return h}});var r=n(1413),a=n(4165),o=n(5861),i=n(5671),u=n(3144),c=n(1752),s=n(1120),p=n(9340),l=n(1129),d=n(2008),f=n(3990),h=function(t){(0,p.Z)(n,t);var e=(0,l.Z)(n);function n(t){var r;if((0,i.Z)(this,n),!t)throw"Shared Secret is required";return(r=e.call(this,t)).root="/circles/connections",r}return(0,u.Z)(n,[{key:"blockDotYouId",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.root+"/block",i={dotYouId:e},t.abrupt("return",r.post(o,i).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"disconnectFromContact",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.root+"/disconnect",i={dotYouId:e},t.abrupt("return",r.post(o,i).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getConnections",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.root+"/connected?"+(0,f.P)(e),t.abrupt("return",r.post(o,e).then((function(t){return t.data})));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getBlockedConnections",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.root+"/blocked?"+(0,f.P)(e),t.abrupt("return",r.get(o).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getConnectionInfo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.root+"/status?omitContactData=".concat(!e),i={dotYouId:t};return a.post(o,i).then((function(t){var e,n;return(0,r.Z)((0,r.Z)({},t.data),{},{status:null===(e=t.data)||void 0===e||null===(n=e.status)||void 0===n?void 0:n.toLowerCase()})})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this))}}],[{key:"getInstance",value:function(t){return n.instance||(n.instance=new n(t)),n.instance}}]),n}(d.$);h.instance=void 0},5144:function(t,e,n){n.d(e,{e:function(){return v}});var r=n(1413),a=n(4165),o=n(5861),i=n(5671),u=n(3144),c=n(1752),s=n(1120),p=n(9340),l=n(1129),d=n(6752),f=n(2008),h=n(3990),v=function(t){(0,p.Z)(n,t);var e=(0,l.Z)(n);function n(t){var r;if((0,i.Z)(this,n),!t)throw"Shared Secret is required";return(r=e.call(this,t)).Root="/circles/requests",r.SentPathRoot=r.Root+"/sent",r.PendingPathRoot=r.Root+"/pending",r}return(0,u.Z)(n,[{key:"getPendingRequests",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.PendingPathRoot+"/list?"+(0,h.P)(e),t.abrupt("return",r.get(o).then((function(t){return t.data})).catch((function(){(0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",i)})));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getPendingRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var o,i,u,p=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p.length>1&&void 0!==p[1]&&p[1],o=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),console.log("TODO: add support for omitContactData param: Server Side"),i=this.PendingPathRoot+"/single",u={dotYouId:e},t.abrupt("return",o.post(i,u).then((function(t){return(0,r.Z)((0,r.Z)({},t.data),{},{status:"pending"})})).catch((function(){})));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSentRequests",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.SentPathRoot+"/list?"+(0,h.P)(e),t.abrupt("return",r.get(o).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSentRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var o,i,u,p=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),i=this.SentPathRoot+"/single",u={dotYouId:e},t.abrupt("return",o.post(i,u).then((function(t){return(0,r.Z)((0,r.Z)({},t.data),{},{status:"sent"})})).catch((function(t){if(404===t.response.status)return null;(0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",p).call(p,t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"acceptConnectionRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e,o,i,u){var p,l,f,h,v;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),l=this.PendingPathRoot+"/accept/",f={sender:e,circleIds:u,permissions:null,contactData:(0,r.Z)({},o)},!i){t.next=9;break}return h=new d.AO({api:d.Ii.Owner,sharedSecret:this.getSharedSecret()}),t.next=7,h.mediaProvider.getDecryptedImageData((0,d.H3)(d.P.StandardProfileId.toString()),i);case 7:(v=t.sent)&&(f.contactData.image=(0,r.Z)((0,r.Z)({},v),{},{content:d.j4.uint8ArrayToBase64(new Uint8Array(v.content))}));case 9:return t.abrupt("return",p.post(l,f).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 10:case"end":return t.stop()}}),t,this)})));return function(e,n,r,a){return t.apply(this,arguments)}}()},{key:"deletePendingRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.PendingPathRoot+"/delete",i={dotYouId:e},t.abrupt("return",r.post(o,i).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteSentRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),o=this.SentPathRoot+"/delete",i={dotYouId:e},t.abrupt("return",r.post(o,i).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"sendRequest",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e,o,i,u,p){var l,f,h,v,Z;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=this.Root+"/sendrequest",f={recipient:e,message:o,contactData:(0,r.Z)({},i),circleIds:p},!u){t.next=8;break}return h=new d.AO({api:d.Ii.Owner,sharedSecret:this.getSharedSecret()}),t.next=6,h.mediaProvider.getDecryptedImageData((0,d.H3)(d.P.StandardProfileId.toString()),u);case 6:(v=t.sent)&&(f.contactData.image=(0,r.Z)((0,r.Z)({},v),{},{content:d.j4.uint8ArrayToBase64(new Uint8Array(v.content))}));case 8:return Z=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),t.abrupt("return",Z.post(l,f).then((function(t){return t.data})).catch((0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",this)));case 10:case"end":return t.stop()}}),t,this)})));return function(e,n,r,a,o){return t.apply(this,arguments)}}()},{key:"blockDotYouId",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),"/circles/connections/block",o={dotYouId:e},t.abrupt("return",r.post("/circles/connections/block",o).then((function(t){return t.data})).catch((function(t){return(0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",i).call(i,t),!1})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"unblockDotYouId",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(e){var r,o,i=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,c.Z)((0,s.Z)(n.prototype),"createAxiosClient",this).call(this),"/circles/connections/unblock",o={dotYouId:e},t.abrupt("return",r.post("/circles/connections/unblock",o).then((function(t){return t.data})).catch((function(t){return(0,c.Z)((0,s.Z)(n.prototype),"handleErrorResponse",i).call(i,t),!1})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"getInstance",value:function(t){return n.instance||(n.instance=new n(t)),n.instance}}]),n}(f.$);v.instance=void 0}}]);
//# sourceMappingURL=713.52790ee2.chunk.js.map