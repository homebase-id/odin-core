"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[556,476],{1375:function(e,n,s){s.r(n),s.d(n,{default:function(){return j}});var r=s(4165),i=s(5861),t=s(9439),a=s(6376),c=s(9072),l=s(8491),o=s(8321),d=s(1869),m=s(3504),u=s(4990),p=s(1512),x=s(2562),v=s(894),h=s(1326),g=s(184),f=function(e){var n,s,r=e.driveGrant,i=e.permissionTree,t=e.className,a=(0,p.Z)({targetDrive:r.permissionedDrive.drive}).fetch.data,c=function(e){var n,s,r=e.children;return a?(0,g.jsx)(m.rU,{to:"/owner/drives/".concat(null===a||void 0===a||null===(n=a.targetDriveInfo)||void 0===n?void 0:n.alias,"_").concat(null===a||void 0===a||null===(s=a.targetDriveInfo)||void 0===s?void 0:s.type),className:"contents",children:r}):(0,g.jsx)(g.Fragment,{children:r})};return(0,g.jsx)("div",{className:"flex flex-row ".concat(t),title:i,children:(0,g.jsxs)(c,{children:[(0,g.jsx)(v.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,g.jsxs)("div",{className:"flex flex-col",children:[(0,g.jsxs)("p",{className:"leading-none ".concat(i?"":"my-auto"),children:[null!==(n=null===a||void 0===a?void 0:a.name)&&void 0!==n?n:"".concat((0,u.t)("New")," ").concat(null===(s=r.driveMeta)||void 0===s?void 0:s.name),":"," ",(0,h.hz)(r.permissionedDrive.permission,x.Ac).name]}),i&&(0,g.jsx)("small",{className:"ml-1",children:i})]})]})},"".concat(r.permissionedDrive.drive.alias,"-").concat(r.permissionedDrive.drive.type))},y=s(2791),j=function(){var e,n,s,u,p=(0,m.lr)(),x=(0,t.Z)(p,1)[0],v=x.get("appId"),h=x.get("n"),j=x.get("p"),N=x.get("pk"),w=x.get("fn"),k=x.get("return"),Z=x.get("d");try{var b=Z&&JSON.parse(Z);u=(Array.isArray(b)?b:[b]).map((function(e){return{permissionedDrive:{drive:{alias:e.a,type:e.t},permission:parseInt(e.p)},driveMeta:{name:e.n,description:e.d}}}))}catch(J){return(0,g.jsx)("div",{children:"Bad request"})}if(!v||!h||!N||!w||!k)return(0,g.jsx)("div",{children:"Bad request"});var D=(0,a.Z)({appId:v}),I=D.fetch,A=I.data,B=I.isLoading,C=D.registerNewApp,F=C.mutateAsync,q=C.status,G=D.registerNewAppClient,S=G.mutateAsync,O=G.status,R=(0,y.useState)(),T=(0,t.Z)(R,2),U=T[0],_=T[1],L={keys:null!==(e=null===j||void 0===j?void 0:j.split(",").map((function(e){return parseInt(e)})))&&void 0!==e?e:[]},M=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F({appId:v,name:h,permissionSet:L,driveGrants:u});case 2:return e.next=4,z();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S({appId:v,clientPublicKey64:N,clientFriendlyName:w});case 2:n=e.sent,s=encodeURI(n.data),i="".concat(k,"d=").concat(s,"&v=").concat(n.encryptionVersion),console.log(i),_(i);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return B?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsx)("section",{className:"my-20",children:(0,g.jsx)("div",{className:"container mx-auto",children:(0,g.jsx)("div",{className:"max-w-[35rem]",children:A?(0,g.jsxs)(g.Fragment,{children:[U?(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Scucessfully registered client: ",w," on app: ",h]})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Register client: ",w]}),(0,g.jsxs)("p",{children:["The app ",h," is registered on your identity."]}),(0,g.jsx)("p",{className:"mt-2",children:"It has the following access on your identity and the following drives:"})]}),null!==(n=A.grant.permissionSet)&&void 0!==n&&n.keys?(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:A.grant.permissionSet.keys.map((function(e){return(0,g.jsx)(o.Z,{permission:e,className:"my-4"},"".concat(e))}))})}):null,null!==(s=A.grant)&&void 0!==s&&s.driveGrants?(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:A.grant.driveGrants.map((function(e){return(0,g.jsx)(d.Z,{driveGrant:e,className:"my-4"},"".concat(e.permissionedDrive.drive.alias,"-").concat(e.permissionedDrive.drive.type))}))})}):null,U?(0,g.jsxs)(g.Fragment,{children:["Url:",(0,g.jsx)("div",{className:"overflow-x-scroll whitespace-nowrap",children:U}),(0,g.jsx)("div",{className:"flex flex-row justify-end",children:(0,g.jsxs)(c.Z,{onClick:function(){window.location.href=U},className:"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none",state:O,children:["Back to ",h]})})]}):(0,g.jsx)("div",{className:"flex flex-row justify-end",children:(0,g.jsxs)(c.Z,{onClick:z,className:"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none",state:O,children:["Register ",w]})})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Registering app: ",h," ",(0,g.jsxs)("small",{className:"block",children:["client: ",w]})]}),(0,g.jsxs)("p",{children:["The app ",h," is not registered on your identity."]}),(0,g.jsxs)("p",{className:"mt-2",children:['By registering this app, "',h,'" will have the following access on your identity and the following drives:']}),(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:L.keys.map((function(e){return(0,g.jsx)(o.Z,{permission:e,className:"my-4"},"".concat(e))}))})}),(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:u.map((function(e){return(0,g.jsx)(f,{driveGrant:e,className:"my-4"},"".concat(e.permissionedDrive.drive.alias,"-").concat(e.permissionedDrive.drive.type))}))})}),(0,g.jsxs)("div",{className:"-sm:mx-2 mt-10 sm:flex sm:flex-row-reverse",children:[(0,g.jsxs)(c.Z,{onClick:M,className:"my-3 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none sm:mx-2 sm:my-auto",state:(0,c.s)(q,O),children:["Allow access and Register ",h]}),(0,g.jsx)(c.Z,{className:"my-3 sm:mx-2 sm:my-auto",type:"secondary",children:"Cancel"})]})]})})})})}}}]);
//# sourceMappingURL=556.db730a0d.chunk.js.map