"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[440],{6419:function(e,n,t){var r=t(1413),i=t(184);n.Z=function(e){return(0,i.jsx)("input",(0,r.Z)((0,r.Z)({},e),{},{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-600 ".concat(e.className)}))}},1869:function(e,n,t){t.d(n,{b:function(){return m}});var r=t(3504),i=t(4990),a=t(1512),s=t(2562),o=t(4665),c=t(894),u=t(1191),l=t(7266),d=t(184),m=function(e){var n,t,i,a,s=e.drive,u=e.className;return(0,d.jsx)("div",{className:"flex flex-row ".concat(u),children:(0,d.jsxs)(r.rU,{to:"/owner/drives/".concat(null===s||void 0===s||null===(i=s.targetDriveInfo)||void 0===i?void 0:i.alias,"_").concat(null===s||void 0===s||null===(a=s.targetDriveInfo)||void 0===a?void 0:a.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,d.jsx)(c.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,d.jsx)("div",{className:"mr-2 flex flex-col",children:(0,d.jsx)("p",{className:"my-auto leading-none",children:null===s||void 0===s?void 0:s.name})}),(0,d.jsx)(o.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===(n=s.targetDriveInfo)||void 0===n?void 0:n.alias,"-").concat(null===(t=s.targetDriveInfo)||void 0===t?void 0:t.type))};n.Z=function(e){var n,t,m,v,f,p=e.driveGrant,h=e.permissionTree,x=e.className,g=(0,a.Z)({targetDrive:p.permissionedDrive.drive}).fetch,y=g.data;return g.isLoading?(0,d.jsx)(u.Z,{className:"h-4 max-w-xs ".concat(x)}):(0,d.jsx)("div",{className:"flex flex-row ".concat(x),title:h,children:(0,d.jsxs)(r.rU,{to:"/owner/drives/".concat(null===y||void 0===y||null===(v=y.targetDriveInfo)||void 0===v?void 0:v.alias,"_").concat(null===y||void 0===y||null===(f=y.targetDriveInfo)||void 0===f?void 0:f.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,d.jsx)(c.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,d.jsxs)("div",{className:"mr-2 flex flex-col",children:[(0,d.jsxs)("p",{className:"leading-none ".concat(h?"":"my-auto"),children:[null===y||void 0===y?void 0:y.name,":"," ",(0,l.hz)(null===p||void 0===p?void 0:p.permissionedDrive.permission,s.Ac).name]}),h&&(0,d.jsxs)("small",{className:"",children:[(0,i.t)("Via")," ",h]})]}),(0,d.jsx)(o.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===p||void 0===p||null===(n=p.permissionedDrive)||void 0===n||null===(t=n.drive)||void 0===t?void 0:t.alias,"-").concat(null===p||void 0===p||null===(m=p.permissionedDrive.drive)||void 0===m?void 0:m.type))}},7117:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var r=t(2982),i=t(885),a=t(2791),s=t(6871),o=t(4990),c=t(4395),u=t(7903),l=t(9072),d=t(4165),m=t(5861),v=t(4164),f=t(7480),p=t(3412),h=t(6419),x=t(6123),g=t(184),y=function(e){var n=e.title,t=e.isOpen,s=e.currentCircleGrants,u=e.dotYouId,y=e.onConfirm,j=e.onCancel,Z=(0,p.Z)("modal-container"),b=(0,c.Z)().fetch.data,w=(0,f.Z)({}),N=w.provideGrant.mutateAsync,D=w.revokeGrant.mutateAsync,C=s.map((function(e){return e.circleId})),k=(0,a.useState)([]),I=(0,i.Z)(k,2),G=I[0],R=I[1],q=(0,a.useState)([]),F=(0,i.Z)(q,2),S=F[0],A=F[1];if(!t)return null;var O=(0,g.jsx)(x.Z,{title:n,onClose:j,children:(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("form",{onSubmit:function(){var e=(0,m.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,Promise.all(S.map(function(){var e=(0,m.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.next=5,Promise.all(G.map(function(){var e=(0,m.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:y();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[b.length?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("h2",{className:"mb-2 text-lg",children:[(0,o.t)("Member of"),":"]}),b.map((function(e,n){var t;return(0,g.jsxs)("div",{className:"mb-2",children:[(0,g.jsx)(h.Z,{value:e.id,id:e.id,onChange:function(n){n.target.checked?(C.some((function(n){return n===e.id}))||A([].concat((0,r.Z)(S),[e.id])),R(G.filter((function(n){return n!==e.id})))):(C.some((function(n){return n===e.id}))&&R([].concat((0,r.Z)(G),[e.id])),A(S.filter((function(n){return n!==e.id}))))},defaultChecked:-1!==C.indexOf(e.id)}),(0,g.jsx)("label",{htmlFor:e.id,className:"ml-2",children:e.name})]},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,g.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,g.jsx)(l.Z,{className:"m-2",icon:"send",children:(0,o.t)("Save")}),(0,g.jsx)(l.Z,{className:"m-2",type:"secondary",onClick:j,children:(0,o.t)("Cancel")})]})]})})});return(0,v.createPortal)(O,Z)},j=t(8532),Z=t(959),b=t(3004),w=t(8739),N=t(1191),D=t(8808),C=t(1869),k=t(8491),I=function(e){var n=e.accessGrant,t=(0,c.Z)().fetch,i=t.data,a=t.isLoading,s=null===i||void 0===i?void 0:i.filter((function(e){return n.circleGrants.some((function(n){return n.circleId===e.id}))})),u=null===s||void 0===s?void 0:s.flatMap((function(e){var n;return null!==(n=e.driveGrants)&&void 0!==n?n:[]})),l=null===u||void 0===u?void 0:u.reduce((function(e,n){var t=e.findIndex((function(e){return e.permissionedDrive.drive.alias===n.permissionedDrive.drive.alias&&e.permissionedDrive.drive.type===n.permissionedDrive.drive.type}));return-1!==t?(e[t].permissionedDrive.permission=Math.max(e[t].permissionedDrive.permission,n.permissionedDrive.permission),e):[].concat((0,r.Z)(e),[n])}),[]),d=null===l||void 0===l?void 0:l.map((function(e){var n=s.filter((function(n){var t;return null===(t=n.driveGrants)||void 0===t?void 0:t.some((function(n){return n.permissionedDrive.drive.alias===e.permissionedDrive.drive.alias&&n.permissionedDrive.drive.type===e.permissionedDrive.drive.type}))})).map((function(e){return e.name}));return{driveGrant:e,permissionTree:n.join(", ")}}));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(k.Z,{title:(0,o.t)("Member of the following circles"),isOpaqueBg:!0,children:a?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(N.Z,{className:"mb-4 h-4 max-w-xs"}),(0,g.jsx)(N.Z,{className:"mb-4 h-4 max-w-xs"}),(0,g.jsx)(N.Z,{className:"mb-4 h-4 max-w-xs"})]}):(0,g.jsx)(g.Fragment,{children:n.isRevoked?null:(0,g.jsx)("div",{className:"-my-4",children:null===s||void 0===s?void 0:s.map((function(e){return(0,g.jsx)(D.Z,{circleDef:e,className:"my-4"},e.id)}))})})}),null!==d&&void 0!==d&&d.length?(0,g.jsx)(k.Z,{title:(0,o.t)("Access on the following drives"),isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-6",children:d.map((function(e){return(0,g.jsx)(C.Z,{driveGrant:e.driveGrant,permissionTree:e.permissionTree,className:"my-6"},"".concat(e.driveGrant.permissionedDrive.drive.alias,"-").concat(e.driveGrant.permissionedDrive.drive.type))}))})}):null]})},G=function(){var e=(0,s.UO)().connectionKey,n=(0,s.s0)(),t=(0,u.Z)({dotYouId:e}),r=t.fetch,c=r.data,d=r.isLoading,m=t.disconnect,v=m.mutate,f=m.status,p=t.acceptRequest,h=(p.mutate,p.status),x=t.ignoreRequest,N=x.mutate,D=x.status,C=t.revokeConnectionRequest,k=C.mutate,G=C.status,R=(0,a.useState)(!1),q=(0,i.Z)(R,2),F=q[0],S=q[1],A=(0,a.useState)(!1),O=(0,i.Z)(A,2),Y=O[0],M=O[1];if(d)return(0,g.jsx)(w.Z,{});if(!c)return(0,g.jsx)(g.Fragment,{children:"No matching connection found"});var T="connected"===c.status?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(l.Z,{type:"primary",className:"m-2",onClick:function(){M(!0)},state:f,children:(0,o.t)("Edit Access")}),(0,g.jsx)(l.Z,{type:"remove",className:"m-2",onClick:function(){return v({})},icon:"trash",state:f,confirmOptions:{title:"".concat((0,o.t)("Remove")," ").concat(e),buttonText:(0,o.t)("Remove"),body:"".concat((0,o.t)("Are you sure you want to remove")," ").concat(e," ").concat((0,o.t)("from your connections. They will lose all existing access."))},children:(0,o.t)("Remove")})]}):"pending"===c.status?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(l.Z,{type:"primary",className:"m-2",onClick:function(){S(!0)},state:h,children:[(0,o.t)("Accept Request"),"..."]}),(0,g.jsx)(l.Z,{type:"secondary",className:"m-2",onClick:function(){N({senderDotYouId:c.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:D,children:(0,o.t)("Ignore")}),(0,g.jsx)(j.Z,{isOpen:F,senderDotYouId:c.senderDotYouId,title:(0,o.t)("Accept connection request"),confirmText:(0,o.t)("Accept and give access"),onConfirm:function(){S(!1)},onCancel:function(){S(!1)}})]}):"sent"===c.status?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(l.Z,{type:"secondary",className:"m-2",onClick:function(){k({targetDotYouId:c.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:G,children:(0,o.t)("Revoke")})}):(0,g.jsx)(g.Fragment,{}),P=c;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(b.Z,{icon:Z.Z,title:"".concat(e," (").concat(c.status,")"),actions:T,breadCrumbs:[{href:"/owner/connections",title:"Connections"},{title:e}]}),"connected"===c.status?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(I,{accessGrant:P.accessGrant}),(0,g.jsx)(y,{title:"".concat((0,o.t)("Edit Circle Membership for")," ").concat(e),isOpen:Y,dotYouId:e,currentCircleGrants:P.accessGrant.circleGrants,onCancel:function(){M(!1)},onConfirm:function(){M(!1)}}),(0,g.jsx)("section",{children:(0,g.jsxs)("p",{className:"text-sm",children:[(0,o.t)("Connected since"),": ",new Date(P.created).toLocaleDateString()]})})]}):"pending"===c.status||"sent"===c.status?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)("p",{className:"mb-3 text-sm",children:c.message})}):null]})}},7266:function(e,n,t){t.d(n,{RG:function(){return s},fP:function(){return a},hz:function(){return o},m3:function(){return c},rS:function(){return r},vr:function(){return i}});var r=function(e){return e[Math.floor(Math.random()*e.length)]},i=function(){return r(["Ut bibendum, neque ac lacinia aliquam, justo ipsum aliquam urna, id vestibulum augue mauris sit amet lacus.","Proin ante sapien, interdum sit amet eros sit amet, eleifend pharetra metus.","Sed elit mi, euismod eget neque at, suscipit aliquam nisi.","Nunc diam arcu, tincidunt quis dignissim ac, volutpat non odio."])},a=function(){var e=["adorable","beautiful","clean","drab","elegant","fancy","glamorous","handsome","long","magnificent","old-fashioned","plain","quaint","sparkling","ugliest","unsightly","angry","bewildered","clumsy","defeated","embarrassed","fierce","grumpy","helpless","itchy","jealous","lazy","mysterious","nervous","obnoxious","panicky","repulsive","scary","thoughtless","uptight","worried"];return"".concat(r(e)," ").concat(r(e)," ").concat(r(["women","men","children","teeth","feet","people","leaves","mice","geese","halves","knives","wives","lives","elves","loaves","potatoes","tomatoes","cacti","foci","fungi","nuclei","syllabuses","analyses","diagnoses","oases","theses","crises","phenomena","criteria","data"]))},s=function(e){for(var n=window.atob(e),t=n.length,r=new Uint8Array(t),i=0;i<t;i++)r[i]=n.charCodeAt(i);return r.buffer},o=function(e,n){return n.reduce((function(n,t){return t.value>n.value&&t.value<=e?t:n}),n[0])},c=function(e,n,t){var r=e[n];return e.splice(n,1),e.splice(t,0,r),e}},1512:function(e,n,t){var r=t(4165),i=t(5861),a=t(7408),s=t(1803),o=t(6117);n.Z=function(e){var n=e.targetDrive,t=(0,o.Z)().getSharedSecret,c=new s.AO({api:s.Ii.Owner,sharedSecret:t()}),u=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.driveProvider.GetDrives({pageNumber:1,pageSize:100});case 2:return e.next=4,e.sent.results;case 4:return t=e.sent,e.abrupt("return",t.find((function(e){return e.targetDriveInfo.alias===n.alias&&e.targetDriveInfo.type===n.type})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,a.useQuery)(["drive","".concat(n.alias,"_").concat(n.type)],(function(){return u(n)}),{refetchOnWindowFocus:!1})}}},2562:function(e,n,t){t.d(n,{Ac:function(){return i},WW:function(){return a},c$:function(){return s}});var r=t(4990),i=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Reader"),value:1},{name:(0,r.t)("Editor"),value:3}],a=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Read Connections"),value:10},{name:(0,r.t)("Read Circle Members"),value:50}],s=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Read Connections"),value:10},{name:(0,r.t)("Manage Connection Requests"),value:30},{name:(0,r.t)("Read Circle Members"),value:50}]}}]);
//# sourceMappingURL=440.b16405d9.chunk.js.map