"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[753],{8575:function(e,n,t){var r=t(6871),a=t(3504),s=t(3225),i=t(4411),o=t(184);n.Z=function(e){var n=e.className,t=e.items,c=e.isLoading,l=(0,r.s0)(),u=(0,r.TH)(),d=(null===t||void 0===t?void 0:t.length)>=6;if(!0===c)return(0,o.jsx)(i.Z,{className:"h-10"});var h=!t.some((function(e){return e.path===u.pathname}));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"hidden flex-col flex-wrap ".concat(d?"":"sm:flex"," sm:flex-row ").concat(null!==n&&void 0!==n?n:""),children:t.map((function(e,n){return(0,o.jsx)(a.OL,{className:function(t){var r,a,s=t.isActive;return"".concat(e.className&&-1!==(null===(r=e.className)||void 0===r?void 0:r.indexOf("flex-grow"))?"":"flex-grow"," cursor-pointer border-b-2 py-2 px-1 text-lg ").concat(s||h&&0===n?"border-indigo-500 text-indigo-500 dark:text-indigo-400":"border-gray-300 transition-colors duration-300 hover:border-indigo-400 dark:border-gray-800 hover:dark:border-indigo-600"," ").concat(null!==(a=e.className)&&void 0!==a?a:"")},to:e.path,end:!0,children:e.title},e.key)}))}),(0,o.jsx)(s.Z,{className:"".concat(d?"":"sm:hidden"," py-4"),onChange:function(e){return l(e.target.value)},value:window.location.pathname,children:t.map((function(e){return(0,o.jsx)("option",{value:e.path,children:e.text||e.title},e.key)}))})]})}},8833:function(e,n,t){var r=t(4165),a=t(5861),s=t(7408),i=t(9631),o=t(8609),c=t(1695);n.Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.channelId,t=e.channelSlug,l=(0,o.ZP)(),u=l.getSharedSecret,d=new i.KU({api:i.Ii.Owner,sharedSecret:u()}),h=(0,s.useQueryClient)(),m=(0,c.Z)().publish.mutate,v=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,d.blogDefinitionProvider.getChannelDefinition(n);case 3:case 7:return e.abrupt("return",e.sent);case 4:if(!t){e.next=8;break}return e.next=7,d.blogDefinitionProvider.getChannelDefinitionBySlug(t);case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),f=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.blogDefinitionProvider.saveChannelDefinition(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.blogDefinitionProvider.removeChannelDefinition(n.channelId);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,s.useQuery)(["channel",null!==n&&void 0!==n?n:t],(function(){return v(n,t)}),{refetchOnWindowFocus:!1}),save:(0,s.useMutation)(f,{onSuccess:function(e,n){n.channelId?h.removeQueries(["channel",n.channelId]):h.removeQueries(["channel"]),h.removeQueries(["channels"]),m()}}),remove:(0,s.useMutation)(p,{onMutate:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.cancelQueries(["channels"]);case 2:return t=h.getQueryData(["channels"]),a=null===t||void 0===t?void 0:t.filter((function(e){return e.channelId!==n.channelId})),h.setQueryData(["channels"],a),e.abrupt("return",{previousChannels:t,toRemoveChannel:n});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),onError:function(e,n,t){console.error(e),h.setQueryData(["channels"],t.previousChannels)},onSettled:function(){h.invalidateQueries(["channels"])}})}}},2255:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(4165),a=t(3433),s=t(5861),i=t(5671),o=t(3144),c=t(9340),l=t(1129),u=t(9631),d=function(e){(0,c.Z)(t,e);var n=(0,l.Z)(t);function t(e){return(0,i.Z)(this,t),n.call(this,{api:e.api,sharedSecret:e.sharedSecret,driveProvider:e.driveProvider,blogDefinitionProvider:e.blogDefinitionProvider})}return(0,o.Z)(t,[{key:"savePost",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n,t){var s,i,o,c,l,d,h,m,v,f,p,x,g;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.content.id){e.next=4;break}n.content.id=n.content.slug?u.j4.toGuidId(n.content.slug):u.j4.getNewId(),e.next=26;break;case 4:if(n.fileId){e.next=26;break}return e.next=7,this.getPost(t,n.content.id);case 7:if(e.t2=l=e.sent,e.t1=null===e.t2,e.t1){e.next=11;break}e.t1=void 0===l;case 11:if(!e.t1){e.next=15;break}e.t3=void 0,e.next=16;break;case 15:e.t3=l.fileId;case 16:if(e.t4=c=e.t3,e.t0=null!==e.t4,!e.t0){e.next=20;break}e.t0=void 0!==c;case 20:if(!e.t0){e.next=24;break}e.t5=c,e.next=25;break;case 24:e.t5=void 0;case 25:n.fileId=e.t5;case 26:return d=!((null===(s=n.acl)||void 0===s?void 0:s.requiredSecurityGroup)===u.hh.Anonymous||(null===(i=n.acl)||void 0===i?void 0:i.requiredSecurityGroup)===u.hh.Authenticated),h={transferIv:this._driveProvider.Random16(),storageOptions:{overwriteFileId:null!==(o=null===n||void 0===n?void 0:n.fileId)&&void 0!==o?o:"",drive:this._blogDefinitionProvider.getTargetDrive(t)},transitOptions:null},m=u.j4.JsonStringify64(n.content),v=u.j4.stringToUint8Array(m),f=n.content.slug?u.j4.toGuidId(n.content.slug):n.content.id,p=v.length<3e3,x={contentType:"application/json",appData:{tags:[(0,u.iY)("type"in n.content?n.content.type:"Article").toString(),n.content.id].concat((0,a.Z)(f&&f!==n.content.id?[f]:[])),uniqueId:f,contentIsComplete:p,fileType:u.Hm.PostFileType,jsonContent:p?m:null},payloadIsEncrypted:d,accessControlList:n.acl},e.next=35,this._driveProvider.Upload(h,x,v,void 0,d);case 35:return g=e.sent,e.abrupt("return",g.file.fileId);case 37:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"removePost",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n,t){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this._blogDefinitionProvider.getTargetDrive(t),this._driveProvider.DeleteFile(a,n);case 2:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(e){if(!e)throw new Error("Shared Secret not set for OwnerProvider");if(!t.instance){var n=new u.l$({api:u.Ii.Owner,sharedSecret:e}),r=new u.ax({api:u.Ii.Owner,sharedSecret:e,driveProvider:n});t.instance=new t({api:u.Ii.Owner,sharedSecret:e,driveProvider:n,blogDefinitionProvider:r})}return t.instance}}]),t}(u.j_);d.instance=void 0},7560:function(e,n,t){t.r(n),t.d(n,{default:function(){return U}});var r=t(3433),a=t(3504),s=t(6871),i=t(4990),o=t(4165),c=t(5861),l=t(7408),u=t(2255),d=t(8609),h=function(e){var n=e.channelId,t=(0,d.ZP)().getSharedSecret,r=function(){var e=(0,c.Z)((0,o.Z)().mark((function e(){var n,r,a,s,i,c,l=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>0&&void 0!==l[0]?l[0]:{cursorState:void 0},r=n.channelId,a=n.cursorState,r){e.next=3;break}return e.abrupt("return");case 3:return s=u.Z.getInstance(t()),e.next=6,s.getPosts(r,void 0,a,20);case 6:return i=e.sent,c=i.results,e.abrupt("return",{results:c,cursorState:i.cursorState});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,l.useInfiniteQuery)(["blogs",n],(function(e){var t=e.pageParam;return r({channelId:n,cursorState:t})}),{getNextPageParam:function(e){var n,t;return null!==(n=20===(null===e||void 0===e||null===(t=e.results)||void 0===t?void 0:t.length)&&(null===e||void 0===e?void 0:e.cursorState))&&void 0!==n?n:void 0},refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:1/0})},m=t(9631),v=function(){var e=(0,d.ZP)().getSharedSecret,n=new m.KU({api:m.Ii.Owner,sharedSecret:e()}),t=function(){var e=(0,c.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.blogDefinitionProvider.getChannelDefinitions();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{fetch:(0,l.useQuery)(["channels"],(function(){return t()}),{refetchOnWindowFocus:!1})}},f=t(2851),p=t(9439),x=t(2791),g=t(3990),j=t(8833),Z=t(2042),w=t(6916),b=t(3147),N=t(1434),y=t(184),k=function(){var e=(0,x.useState)(""),n=(0,p.Z)(e,2),t=n[0],r=n[1],a=(0,x.useState)(""),o=(0,p.Z)(a,2),c=o[0],l=o[1],u=(0,j.Z)().save,d=u.mutate,h=u.status,v=u.error,k=(0,s.s0)();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(Z.Z,{error:v}),(0,y.jsx)(N.Z,{title:"New: channel",isOpaqueBg:!0,children:(0,y.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n={channelId:"",name:t,slug:(0,g.Vj)(t),description:c,templateId:void 0,acl:{requiredSecurityGroup:m.hh.Owner}};return d(n,{onSuccess:function(){k("/owner/posts/".concat((0,g.Vj)(n.name)))}}),!1},children:[(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)(b.Z,{htmlFor:"channelName",children:(0,i.t)("Name")}),(0,y.jsx)(w.Z,{id:"name",name:"channelName",onChange:function(e){r(e.target.value)},required:!0})]}),(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)(b.Z,{htmlFor:"name",children:(0,i.t)("Description")}),(0,y.jsx)(w.Z,{id:"name",name:"channelDescription",onChange:function(e){l(e.target.value)}})]}),(0,y.jsx)("div",{className:"flex flex-row",children:(0,y.jsx)(f.Z,{className:"ml-auto",state:h,children:(0,i.t)("Add channel")})})]})})]})},I=t(6430),S=t(3561),C=t(395),P=t(4411),D=t(1413),O=t(3225),F=t(2465),L=function(e){var n=e.channel,t=e.onCancel,r=e.onSave,a=e.className,l=(0,x.useState)((0,D.Z)({},n)),u=(0,p.Z)(l,2),d=u[0],h=u[1],v=(0,j.Z)(),k=v.save,I=k.mutateAsync,C=k.status,P=k.error,L=v.remove,A=L.mutateAsync,Q=L.status,T=L.error,M=(0,s.s0)(),B=(0,x.useState)(!1),U=(0,p.Z)(B,2),q=U[0],_=U[1];if(n){var R=function(e){var n=(0,D.Z)({},d);n[e.target.name]=e.target.value,h(n)},E=Object.keys(m.rJ).filter((function(e){return!isNaN(Number(e))})),G=Object.keys(m.rJ).filter((function(e){return isNaN(Number(e))}));return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(Z.Z,{error:P}),(0,y.jsx)(Z.Z,{error:T}),(0,y.jsx)(N.Z,{title:(0,y.jsxs)("span",{className:"flex flex-row",children:[(0,y.jsx)(S.ZP,{acl:d.acl,isEdit:q,onChange:function(e){R({target:{name:"acl",value:e}})},onClose:function(){return _(!1)}},d.channelId)," ",(0,y.jsxs)("span",{onClick:function(){return _(!0)},children:["".concat((0,i.t)("Edit"),": ").concat(n.name),(0,y.jsx)("small",{className:"block text-xs",children:(0,y.jsx)(S.L,{acl:d.acl})})]})]}),isOpaqueBg:!0,className:null!==a&&void 0!==a?a:"",children:(0,y.jsxs)("form",{onSubmit:function(){var e=(0,c.Z)((0,o.Z)().mark((function e(n){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,I(d);case 3:M("/owner/posts/".concat((0,g.Vj)(d.name))),r();case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)(b.Z,{htmlFor:"name",children:(0,i.t)("Name")}),(0,y.jsx)(w.Z,{id:"name",name:"name",defaultValue:n.name,onChange:R})]}),(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)(b.Z,{htmlFor:"description",children:(0,i.t)("Description")}),(0,y.jsx)(F.Z,{id:"description",name:"description",defaultValue:n.description,onChange:R})]}),(0,y.jsxs)("div",{className:"mb-5",children:[(0,y.jsx)(b.Z,{htmlFor:"template",children:(0,i.t)("Template")}),(0,y.jsxs)(O.Z,{id:"template",name:"templateId",defaultValue:n.templateId,onChange:R,children:[(0,y.jsx)("option",{children:(0,i.t)("Make a selection")}),E.map((function(e,n){return(0,y.jsx)("option",{value:e,children:(0,i.t)(G[n])},e)}))]})]}),(0,y.jsxs)("div",{className:"-m-2 flex flex-row-reverse",children:[(0,y.jsx)(f.Z,{type:"secondary",className:"m-2",onClick:function(e){e.preventDefault(),t()},children:(0,i.t)("Cancel")}),(0,y.jsx)(f.Z,{type:"primary",className:"m-2",state:C,children:(0,i.t)("Save")}),n.channelId!==m.Hm.PublicChannel.channelId&&(0,y.jsx)(f.Z,{type:"remove",icon:"trash",className:"m-2 mr-auto",state:Q,onClick:function(){A(n),M("/owner/posts")},confirmOptions:{title:(0,i.t)("Remove channel"),body:(0,i.t)("Are you sure you want to remove this channel, this action cannot be undone. All blogs published on this channel will also be unpublished."),buttonText:(0,i.t)("Remove")},children:(0,i.t)("Remove")})]})]})})]})}},A=function(e){var n=e.channel,t=e.blogs,r=e.isParentLoading,s=e.hasMoreBlogs,o=e.getMoreBlogs,c="/owner/posts/".concat(n?n.slug:"all","/"),l=(0,x.useState)(!1),u=(0,p.Z)(l,2),d=u[0],h=u[1],v=(0,x.useRef)(null);return(0,I.s)(s&&v,(function(){o&&o()}),!0),r?(0,y.jsxs)("div",{className:"-m-5 pt-5",children:[(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"}),(0,y.jsx)(P.Z,{className:"m-5 h-20"})]}):t?(0,y.jsxs)(y.Fragment,{children:[n?d?(0,y.jsx)(L,{channel:n,onCancel:function(){return h(!1)},onSave:function(){return h(!1)},className:"bg-slate-50 dark:bg-slate-800"},n.channelId):(0,y.jsxs)("section",{className:"items-center bg-slate-50 p-3 dark:bg-slate-800 sm:flex sm:flex-row",children:[(0,y.jsx)("p",{className:"mr-2",children:n.description?n.description:n.name}),(0,y.jsx)("p",{className:"flex flex-row items-center border-l border-slate-300 pl-2 sm:mr-2",children:n.acl?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(S.dU,{acl:n.acl,className:"mr-1 h-4 w-4"}),(0,y.jsx)(S.L,{acl:n.acl})]}):""}),(0,y.jsxs)("p",{className:"ml-auto",children:[(0,i.t)("Template"),":"," ",parseInt(n.templateId+"")===m.rJ.LargeCards?(0,i.t)("LargeCards"):parseInt(n.templateId+"")===m.rJ.ClassicBlog?(0,i.t)("ClassicBlog"):(0,i.t)("MasonryLayout")]}),(0,y.jsx)(f.Z,{type:"secondary",className:"sm:ml-2",onClick:function(){return h(!0)},children:(0,i.t)("Edit Channel")})]}):null,(0,y.jsx)("div",{className:"mx-auto max-w-4xl",children:null!==t&&void 0!==t&&t.length?(0,y.jsxs)(y.Fragment,{children:[t.map((function(e){var n;return e?(0,y.jsx)(C.Z,{post:e.content,isDraft:(null===(n=e.acl.requiredSecurityGroup)||void 0===n?void 0:n.toLowerCase())===m.hh.Owner.toLowerCase(),linkRoot:c,className:"my-2"},e.content.id):null})),(0,y.jsx)("div",{ref:v,className:"h-1 w-full"})]}):(0,y.jsx)("div",{className:"mt-4",children:(0,y.jsxs)("div",{className:"flex flex-row",children:[(0,y.jsx)("p",{className:"my-auto",children:(0,i.t)("This seems to be an empty channel, time to add a post?")}),(0,y.jsx)(a.rU,{className:"contents",to:"/owner/posts/".concat(null===n||void 0===n?void 0:n.slug,"/new"),children:(0,y.jsx)(f.Z,{type:"primary",icon:"plus",className:"ml-2",children:(0,i.t)("Add Post")})})]})})})]}):(0,y.jsx)(y.Fragment,{})},Q=t(4602),T=t(4461),M=t(9080),B=t(8575),U=function(){var e,n,t=(0,s.UO)().channelKey,o=v().fetch,c=o.data,l=o.isLoading,u=null!==(e=null===c||void 0===c?void 0:c.find((function(e){return e.slug===t})))&&void 0!==e?e:null===c||void 0===c?void 0:c[0],d=h({channelId:null===u||void 0===u?void 0:u.channelId}),m=d.data,p=d.isLoading,x=d.hasNextPage,g=d.fetchNextPage;return(0,y.jsxs)("section",{children:[(0,y.jsx)(M.Z,{icon:T.Z,title:(0,i.t)("Posts"),breadCrumbs:[{href:"/owner/posts",title:"Posts"},{title:"new"!==t&&(null===u||void 0===u?void 0:u.name)||(0,i.t)("New")}],actions:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.rU,{className:"contents",to:"/owner/posts/new",children:(0,y.jsx)(f.Z,{type:"secondary",icon:"plus",className:"m-2",children:(0,i.t)("Add Channel")})}),"new"!==t&&(0,y.jsx)(a.rU,{className:"contents",to:"/owner/posts/".concat(null===u||void 0===u?void 0:u.slug,"/new"),children:(0,y.jsx)(f.Z,{type:"primary",icon:"plus",className:"m-2",children:(0,i.t)("Add Post")})})]})}),(null===c||void 0===c?void 0:c.length)>1&&(0,y.jsx)("div",{className:"pb-5",children:(0,y.jsx)(B.Z,{items:[].concat((0,r.Z)((null!==c&&void 0!==c?c:[]).map((function(e){return{title:e.name,key:e.channelId,path:"/owner/posts/".concat(e.slug)}}))),[{title:(0,y.jsx)(Q.Z,{className:"h-5 w-5"}),text:"-- ".concat((0,i.t)("Create new channel")," --"),key:"new",className:"flex-grow-0",path:"/owner/posts/new"}]),isLoading:l})}),"new"===t?(0,y.jsx)(k,{}):(0,y.jsx)(A,{channel:u,blogs:null===m||void 0===m||null===(n=m.pages)||void 0===n?void 0:n.flatMap((function(e){return null===e||void 0===e?void 0:e.results})),hasMoreBlogs:x,getMoreBlogs:g,isParentLoading:l||p})]})}}}]);
//# sourceMappingURL=753.3f8022f2.chunk.js.map