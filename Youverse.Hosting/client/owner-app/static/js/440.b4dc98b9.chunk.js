"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[440],{1869:function(e,n,t){var r=t(3504),o=t(1512),c=t(2562),s=t(4665),a=t(894),i=t(7266),u=t(184);n.Z=function(e){var n,t,l,d,f=e.driveGrant,m=e.permissionTree,v=e.className,p=(0,o.Z)({targetDrive:f.drive}).fetch.data;return(0,u.jsx)("div",{className:"flex flex-row ".concat(v),title:m,children:(0,u.jsxs)(r.rU,{to:"/owner/drives/".concat(null===p||void 0===p||null===(l=p.targetDriveInfo)||void 0===l?void 0:l.alias,"_").concat(null===p||void 0===p||null===(d=p.targetDriveInfo)||void 0===d?void 0:d.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,u.jsx)(a.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,u.jsxs)("div",{className:"mr-2 flex flex-col",children:[(0,u.jsxs)("p",{className:"leading-none ".concat(m?"":"my-auto"),children:[null===p||void 0===p?void 0:p.name,":"," ",(0,i.hz)(null===f||void 0===f?void 0:f.permission,c.A).name]}),m&&(0,u.jsx)("small",{className:"",children:m})]}),(0,u.jsx)(s.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===f||void 0===f||null===(n=f.drive)||void 0===n?void 0:n.alias,"-").concat(null===f||void 0===f||null===(t=f.drive)||void 0===t?void 0:t.type))}},7117:function(e,n,t){t.r(n),t.d(n,{default:function(){return b}});var r=t(2982),o=t(885),c=t(2791),s=t(6871),a=t(4990),i=t(4395),u=t(7903),l=t(9072),d=t(4165),f=t(5861),m=t(4164),v=t(3412),p=t(6419),x=t(6123),h=t(184),Z=function(e){var n=e.title,t=e.isOpen,s=e.currentCircleGrants,u=e.dotYouId,Z=e.onConfirm,g=e.onCancel,j=(0,v.Z)("modal-container"),y=(0,i.Z)(),I=y.fetch.data,w=y.provideGrant.mutateAsync,C=y.revokeGrant.mutateAsync,b=s.map((function(e){return e.circleId})),k=(0,c.useState)([]),N=(0,o.Z)(k,2),Y=N[0],D=N[1],R=(0,c.useState)([]),S=(0,o.Z)(R,2),q=S[0],F=S[1];if(!t)return null;var G=(0,h.jsx)(x.Z,{title:n,onClose:g,children:(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("form",{onSubmit:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,Promise.all(q.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.next=5,Promise.all(Y.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:Z();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[I.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("h2",{className:"mb-2 text-lg",children:[(0,a.t)("Member of"),":"]}),I.map((function(e,n){var t;return(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)(p.Z,{value:e.id,id:e.id,onChange:function(n){n.target.checked?(b.some((function(n){return n===e.id}))||F([].concat((0,r.Z)(q),[e.id])),D(Y.filter((function(n){return n!==e.id})))):(b.some((function(n){return n===e.id}))&&D([].concat((0,r.Z)(Y),[e.id])),F(q.filter((function(n){return n!==e.id}))))},defaultChecked:-1!==b.indexOf(e.id)}),(0,h.jsx)("label",{htmlFor:e.id,className:"ml-2",children:e.name})]},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,h.jsxs)("div",{className:"-mx-2 py-3 sm:flex sm:flex-row-reverse",children:[(0,h.jsx)(l.Z,{className:"mx-2",icon:"send",children:(0,a.t)("Save")}),(0,h.jsx)(l.Z,{className:"mx-2",type:"secondary",onClick:g,children:(0,a.t)("Cancel")})]})]})})});return(0,m.createPortal)(G,j)},g=t(959),j=t(3004),y=t(8808),I=t(1869),w=t(8491),C=function(e){var n=e.accessGrant,t=(0,i.Z)().fetch.data,o=null===t||void 0===t?void 0:t.filter((function(e){return n.circleGrants.some((function(n){return n.circleId===e.id}))})),c=null===o||void 0===o?void 0:o.reduce((function(e,n){return[].concat((0,r.Z)(e),(0,r.Z)(n.drivesGrants.map((function(e){return{driveGrant:e,permissionTree:"".concat((0,a.t)("Via:")," ").concat(n.name)}}))))}),[]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(w.Z,{title:(0,a.t)("Member of the following circles"),isOpaqueBg:!0,children:n.isRevoked?null:(0,h.jsx)(h.Fragment,{children:null===o||void 0===o?void 0:o.map((function(e){return(0,h.jsx)(y.Z,{circleDef:e},e.id)}))})}),(0,h.jsx)(w.Z,{title:(0,a.t)("Access on the following drives"),isOpaqueBg:!0,children:null!==c&&void 0!==c&&c.length?(0,h.jsx)(h.Fragment,{children:c.map((function(e){return(0,h.jsx)(I.Z,{driveGrant:e.driveGrant,permissionTree:e.permissionTree,className:"mb-6"},"".concat(e.driveGrant.drive.alias,"-").concat(e.driveGrant.drive.type))}))}):null})]})},b=function(){var e=(0,s.UO)().connectionKey,n=(0,s.s0)(),t=(0,u.Z)({dotYouId:e}),r=t.fetch,i=r.data,d=r.isLoading,f=t.disconnect,m=f.mutate,v=f.status,p=t.acceptRequest,x=p.mutate,y=p.status,I=t.ignoreRequest,w=I.mutate,b=I.status,k=t.revokeConnectionRequest,N=k.mutate,Y=k.status,D=(0,c.useState)(!1),R=(0,o.Z)(D,2),S=R[0],q=R[1];if(d&&h.Fragment,!i)return(0,h.jsx)(h.Fragment,{children:"No matching connection found"});var F="Connected"===i.status?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.Z,{type:"primary",className:"my-auto ml-auto",onClick:function(){q(!0)},state:v,children:(0,a.t)("Edit Access")}),(0,h.jsx)(l.Z,{type:"remove",className:"my-auto ml-2",onClick:function(){return m({})},icon:"trash",state:v,confirmOptions:{title:"".concat((0,a.t)("Remove")," ").concat(e),buttonText:(0,a.t)("Remove"),body:"".concat((0,a.t)("Are you sure you want to remove")," ").concat(e," ").concat((0,a.t)("from your connections. They will lose all existing access."))},children:(0,a.t)("Remove")})]}):"Pending"===i.status?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.Z,{type:"primary",className:"my-auto ml-auto",onClick:function(){x({senderDotYouId:i.senderDotYouId})},state:y,children:(0,a.t)("Accept Request")}),(0,h.jsx)(l.Z,{type:"secondary",className:"my-auto ml-2",onClick:function(){w({senderDotYouId:i.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:b,children:(0,a.t)("Ignore")})]}):"Sent"===i.status?(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(l.Z,{type:"secondary",className:"my-auto ml-2",onClick:function(){N({targetDotYouId:i.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:Y,children:(0,a.t)("Revoke")})}):(0,h.jsx)(h.Fragment,{}),G=i;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(j.Z,{icon:g.Z,title:"".concat(e," (").concat(i.status,")"),actions:F,breadCrumbs:[{href:"/owner/connections",title:"Connections"},{title:e}]}),"Connected"===i.status?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("section",{children:[(0,h.jsxs)("p",{className:"text-sm",children:[(0,a.t)("Connected since"),": ",new Date(G.created).toLocaleDateString()]}),(0,h.jsx)(C,{accessGrant:G.accessGrant})]}),(0,h.jsx)(Z,{title:"".concat((0,a.t)("Edit Circle Membership for")," ").concat(e),isOpen:S,dotYouId:e,currentCircleGrants:G.accessGrant.circleGrants,onCancel:function(){q(!1)},onConfirm:function(){q(!1)}})]}):"Pending"===i.status||"Sent"===i.status?(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("p",{className:"mb-3 text-sm",children:i.message})}):null]})}},7903:function(e,n,t){var r=t(4165),o=t(5861),c=t(7408),s=t(7186),a=t(5144),i=t(6117);n.Z=function(e){var n=e.dotYouId,t=(0,c.useQueryClient)(),u=(0,i.Z)().getSharedSecret,l=s.I.getInstance(u()),d=a.e.getInstance(u()),f=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t,o,c,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.dotYouId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l.getConnectionInfo(t);case 5:if(!(o=e.sent)||"None"===o.status){e.next=8;break}return e.abrupt("return",o);case 8:return e.next=10,d.getPendingRequest(t);case 10:if(!(c=e.sent)){e.next=13;break}return e.abrupt("return",c);case 13:return e.next=15,d.getSentRequest(t);case 15:return s=e.sent,e.abrupt("return",null!==s&&void 0!==s?s:o);case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.connectionDotYouId,e.next=3,l.disconnectFromContact(null!==o&&void 0!==o?o:n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t,o,c,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,o=n.message,c=n.name,s=n.circleIds,e.next=3,d.sendRequest(t,o,c,s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,e.next=3,d.deleteSentRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.acceptConnectionRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),h=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.deletePendingRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,c.useQuery)(["connectionInfo",n],(function(){return f({dotYouId:n})}),{refetchOnWindowFocus:!1}),disconnect:(0,c.useMutation)(m,{onSuccess:function(e,n){t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n])},onError:function(e){console.error(e)}}),sendConnectionRequest:(0,c.useMutation)(v,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),revokeConnectionRequest:(0,c.useMutation)(p,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),acceptRequest:(0,c.useMutation)(x,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}}),ignoreRequest:(0,c.useMutation)(h,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}})}}}}]);
//# sourceMappingURL=440.b4dc98b9.chunk.js.map