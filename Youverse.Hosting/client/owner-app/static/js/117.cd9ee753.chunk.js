"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[117],{5939:function(e,n,t){var r=t(1088),s=t(6439),i=t(184);n.Z=function(e){var n=e.type,t=e.title,a=e.children,c=e.className,o=e.isCompact,l="critical"===n?"bg-red-50 dark:bg-red-900 border-red-100 dark:border-red-800 dark:text-white":"warning"===n?"bg-orange-50 border-orange-100":"bg-slate-100 dark:bg-slate-700 dark:border-slate-900";return(0,i.jsx)("section",{className:"bg-red rounded-lg border p-5 ".concat(l," ").concat(null!==c&&void 0!==c?c:""),children:(0,i.jsxs)("div",{className:"flex flex-row ".concat(o?"flex-wrap":"flex-wrap sm:flex-nowrap"," "),children:["critical"===n?(0,i.jsx)("div",{className:"mb-2 flex h-8 w-8 flex-shrink-0 text-red-400 dark:text-red-300 ".concat(o?"mb-2":"sm:my-auto sm:mx-0 sm:h-10 sm:w-10"),children:(0,i.jsx)(r.Z,{})}):"warning"===n?(0,i.jsx)("div",{className:"mb-2 flex h-8 w-8 flex-shrink-0 text-orange-400 ".concat(o?"mb-2":"sm:my-auto sm:mx-0 sm:h-10 sm:w-10"),children:(0,i.jsx)(r.Z,{})}):(0,i.jsx)("div",{className:"mb-2 flex h-8 w-8 flex-shrink-0 text-blue-400 ".concat(o?"mb-2":"sm:my-auto sm:mx-0 sm:h-10 sm:w-10"),children:(0,i.jsx)(s.Z,{})}),(0,i.jsxs)("div",{className:"ml-5 ".concat(o?"contents":"contents sm:block"),children:[(0,i.jsx)("p",{className:"ml-3 mb-2 text-2xl sm:ml-0",children:t}),a]})]})})}},6439:function(e,n,t){var r=t(184);n.Z=function(e){var n=e.className;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",className:n,children:(0,r.jsx)("path",{d:"M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM169.8 165.3c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24V250.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1H222.6c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM288 352c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"})})}},1869:function(e,n,t){t.d(n,{b:function(){return m}});var r=t(3504),s=t(4990),i=t(1512),a=t(2562),c=t(4665),o=t(894),l=t(1191),u=t(1326),d=t(184),m=function(e){var n,t,s,i,a=e.drive,l=e.className;return(0,d.jsx)("div",{className:"flex flex-row ".concat(l),children:(0,d.jsxs)(r.rU,{to:"/owner/drives/".concat(null===a||void 0===a||null===(s=a.targetDriveInfo)||void 0===s?void 0:s.alias,"_").concat(null===a||void 0===a||null===(i=a.targetDriveInfo)||void 0===i?void 0:i.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,d.jsx)(o.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6 flex-shrink-0"}),(0,d.jsx)("div",{className:"mr-2 flex flex-col",children:(0,d.jsx)("p",{className:"my-auto",children:null===a||void 0===a?void 0:a.name})}),(0,d.jsx)(c.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===(n=a.targetDriveInfo)||void 0===n?void 0:n.alias,"-").concat(null===(t=a.targetDriveInfo)||void 0===t?void 0:t.type))};n.Z=function(e){var n,t,m,v,f,x=e.driveGrant,p=e.permissionTree,h=e.className,j=(0,i.Z)({targetDrive:x.permissionedDrive.drive}).fetch,g=j.data;return j.isLoading?(0,d.jsx)(l.Z,{className:"h-4 max-w-xs ".concat(h)}):(0,d.jsx)("div",{className:"flex flex-row ".concat(h),title:p,children:(0,d.jsxs)(r.rU,{to:"/owner/drives/".concat(null===g||void 0===g||null===(v=g.targetDriveInfo)||void 0===v?void 0:v.alias,"_").concat(null===g||void 0===g||null===(f=g.targetDriveInfo)||void 0===f?void 0:f.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,d.jsx)(o.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,d.jsxs)("div",{className:"mr-2 flex flex-col",children:[(0,d.jsxs)("p",{className:"leading-none ".concat(p?"":"my-auto"),children:[null===g||void 0===g?void 0:g.name,":"," ",(0,u.hz)(null===x||void 0===x?void 0:x.permissionedDrive.permission,a.Ac).name]}),p&&(0,d.jsxs)("small",{className:"",children:[(0,s.t)("Via")," ",p]})]}),(0,d.jsx)(c.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===x||void 0===x||null===(n=x.permissionedDrive)||void 0===n||null===(t=n.drive)||void 0===t?void 0:t.alias,"-").concat(null===x||void 0===x||null===(m=x.permissionedDrive.drive)||void 0===m?void 0:m.type))}},7117:function(e,n,t){t.r(n),t.d(n,{ConnectionPermissionViewer:function(){return F},default:function(){return S}});var r=t(3433),s=t(4165),i=t(5861),a=t(9439),c=t(2791),o=t(6871),l=t(4990),u=t(4395),d=t(7903),m=t(6703),v=t(7148),f=t(5939),x=t(9072),p=t(4164),h=t(7480),j=t(3412),g=t(8808),Z=t(8395),w=t(184),b=function(e){var n=e.title,t=e.isOpen,o=e.currentCircleGrants,d=e.dotYouId,m=e.onConfirm,v=e.onCancel,f=(0,j.Z)("modal-container"),b=(0,u.Z)().fetch.data,y=(0,h.Z)({}),N=y.provideGrant.mutateAsync,k=y.revokeGrant.mutateAsync,D=o.map((function(e){return e.circleId})),C=(0,c.useState)([]),I=(0,a.Z)(C,2),G=I[0],F=I[1],S=(0,c.useState)([]),A=(0,a.Z)(S,2),R=A[0],O=A[1];if(!t)return null;var Y=(0,w.jsx)(Z.Z,{title:n,onClose:v,children:(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("form",{onSubmit:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,Promise.all(R.map(function(){var e=(0,i.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N({circleId:n,dotYouId:d}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.next=5,Promise.all(G.map(function(){var e=(0,i.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",k({circleId:n,dotYouId:d}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:O([]),F([]),m();case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[b.length?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("h2",{className:"mb-2 text-lg",children:[(0,l.t)("Member of"),":"]}),b.map((function(e,n){var t,s=G.some((function(n){return n===e.id})),i=R.some((function(n){return n===e.id}))||-1!==D.indexOf(e.id)&&!s;return(0,w.jsx)(g.Z,{circleDef:e,className:"my-4 w-full rounded-lg border p-4",isChecked:i,onClick:function(){i?(D.some((function(n){return n===e.id}))&&F([].concat((0,r.Z)(G),[e.id])),O(R.filter((function(n){return n!==e.id})))):(D.some((function(n){return n===e.id}))||O([].concat((0,r.Z)(R),[e.id])),F(G.filter((function(n){return n!==e.id}))))}},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,w.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,w.jsx)(x.Z,{className:"m-2",icon:"send",children:(0,l.t)("Save")}),(0,w.jsx)(x.Z,{className:"m-2",type:"secondary",onClick:v,children:(0,l.t)("Cancel")})]})]})})});return(0,p.createPortal)(Y,f)},y=t(8532),N=t(959),k=t(3004),D=t(8739),C=t(1191),I=t(1869),G=t(8491),F=function(e){var n=e.accessGrant,t=e.className,s=(0,u.Z)().fetch,i=s.data,a=s.isLoading,c=null===i||void 0===i?void 0:i.filter((function(e){return n.circleGrants.some((function(n){return n.circleId===e.id}))})),o=null===c||void 0===c?void 0:c.flatMap((function(e){var n;return null!==(n=e.driveGrants)&&void 0!==n?n:[]})),d=null===o||void 0===o?void 0:o.reduce((function(e,n){var t=e.findIndex((function(e){return e.permissionedDrive.drive.alias===n.permissionedDrive.drive.alias&&e.permissionedDrive.drive.type===n.permissionedDrive.drive.type}));return-1!==t?(e[t].permissionedDrive.permission=Math.max(e[t].permissionedDrive.permission,n.permissionedDrive.permission),e):[].concat((0,r.Z)(e),[n])}),[]),m=null===d||void 0===d?void 0:d.map((function(e){var n=c.filter((function(n){var t;return null===(t=n.driveGrants)||void 0===t?void 0:t.some((function(n){return n.permissionedDrive.drive.alias===e.permissionedDrive.drive.alias&&n.permissionedDrive.drive.type===e.permissionedDrive.drive.type}))})).map((function(e){return e.name}));return{driveGrant:e,permissionTree:n.join(", ")}}));return(0,w.jsxs)("div",{className:t,children:[(0,w.jsx)(G.Z,{title:(0,l.t)("Member of the following circles"),isOpaqueBg:!0,children:a?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"}),(0,w.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"}),(0,w.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"})]}):(0,w.jsx)(w.Fragment,{children:n.isRevoked?null:(0,w.jsx)("div",{className:"-my-4",children:null===c||void 0===c?void 0:c.map((function(e){return(0,w.jsx)(g.Z,{circleDef:e,className:"my-4"},e.id)}))})})}),null!==m&&void 0!==m&&m.length?(0,w.jsx)(G.Z,{title:(0,l.t)("Access on the following drives"),isOpaqueBg:!0,children:(0,w.jsx)("div",{className:"-my-6",children:m.map((function(e){return(0,w.jsx)(I.Z,{driveGrant:e.driveGrant,permissionTree:e.permissionTree,className:"my-6"},"".concat(e.driveGrant.permissionedDrive.drive.alias,"-").concat(e.driveGrant.permissionedDrive.drive.type))}))})}):null]})},S=function(){var e=(0,o.UO)().connectionKey,n=(0,o.s0)(),t=(0,d.Z)({dotYouId:e}),r=t.fetch,u=r.data,p=r.isLoading,h=t.disconnect,j=h.mutate,g=h.status,Z=t.ignoreRequest,C=Z.mutateAsync,I=Z.status,G=t.revokeConnectionRequest,S=G.mutate,A=G.status,R=t.block,O=R.mutate,Y=R.status,M=t.unblock,T=M.mutate,q=M.status,B=(0,m.Z)({dotYouId:e}).fetch.data,U=(0,v.Z)(),z=(0,c.useState)(!1),L=(0,a.Z)(z,2),P=L[0],_=L[1],E=(0,c.useState)(!1),V=(0,a.Z)(E,2),W=V[0],H=V[1];if(p)return(0,w.jsx)(D.Z,{});if(!u)return(0,w.jsx)(w.Fragment,{children:"No matching connection found"});var K="connected"===u.status?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.Z,{type:"primary",className:"m-2",onClick:function(){H(!0)},state:g,children:(0,l.t)("Edit Access")}),(0,w.jsx)(x.Z,{type:"remove",className:"m-2",onClick:function(){return j({})},icon:"trash",state:g,confirmOptions:{title:"".concat((0,l.t)("Remove")," ").concat(e),buttonText:(0,l.t)("Remove"),body:"".concat((0,l.t)("Are you sure you want to remove")," ").concat(e," ").concat((0,l.t)("from your connections. They will lose all existing access."))},children:(0,l.t)("Remove")})]}):"pending"===u.status?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(x.Z,{type:"primary",className:"m-2",onClick:function(){_(!0)},children:[(0,l.t)("Accept Request"),"..."]}),(0,w.jsx)(x.Z,{type:"secondary",className:"m-2",onClick:(0,i.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C({senderDotYouId:u.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}});case 2:U();case 3:case"end":return e.stop()}}),e)}))),state:I,children:(0,l.t)("Ignore")}),(0,w.jsx)(y.Z,{isOpen:P,senderDotYouId:u.senderDotYouId,title:(0,l.t)("Accept connection request"),confirmText:(0,l.t)("Accept and give access"),onConfirm:function(){_(!1)},onCancel:function(){_(!1)}})]}):"sent"===u.status?(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(x.Z,{type:"secondary",className:"m-2",onClick:function(){S({targetDotYouId:u.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:A,children:(0,l.t)("Revoke")})}):(0,w.jsx)(w.Fragment,{}),Q=u;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(k.Z,{icon:N.Z,title:(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("span",{className:"flex flex-col",children:[(0,w.jsx)("span",{className:"block",children:"".concat(null!==B&&void 0!==B&&B.name?"".concat(B.name.givenName," ").concat(B.name.surname):e)}),(0,w.jsx)("small",{className:"block text-sm",children:"(".concat(u.status,")")})]})}),actions:(0,w.jsxs)(w.Fragment,{children:["blocked"===u.status?(0,w.jsx)(x.Z,{type:"remove",className:"m-2",onClick:function(){return T(e)},state:q,confirmOptions:{title:"".concat((0,l.t)("Unblock")," ").concat(e),buttonText:(0,l.t)("Unblock"),body:"".concat((0,l.t)("Are you sure you want to unblock")," ").concat(e)},children:(0,l.t)("Unblock")}):(0,w.jsx)(x.Z,{type:"remove",className:"m-2",onClick:function(){return O(e)},state:Y,confirmOptions:{title:"".concat((0,l.t)("Block")," ").concat(e),buttonText:(0,l.t)("Block"),body:"".concat((0,l.t)("Are you sure you want to block")," ").concat(e)},children:(0,l.t)("Block")}),K]}),breadCrumbs:[{href:"/owner/connections",title:"Connections"},{title:e}]}),"connected"===u.status?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(F,{accessGrant:Q.accessGrant}),(0,w.jsx)(b,{title:"".concat((0,l.t)("Edit Circle Membership for")," ").concat(e),isOpen:W,dotYouId:e,currentCircleGrants:Q.accessGrant.circleGrants,onCancel:function(){H(!1)},onConfirm:function(){H(!1)}}),(0,w.jsx)("section",{children:(0,w.jsxs)("p",{className:"text-sm",children:[(0,l.t)("Connected since"),": ",new Date(Q.created).toLocaleDateString()]})})]}):"pending"===u.status||"sent"===u.status?(0,w.jsx)(w.Fragment,{children:(0,w.jsx)("p",{className:"mb-3 text-sm",children:u.message})}):"blocked"===u.status?(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(f.Z,{type:"critical",children:(0,l.t)("This person is currently blocked")})}):null]})}},1512:function(e,n,t){var r=t(4165),s=t(5861),i=t(7408),a=t(6752),c=t(6117);n.Z=function(e){var n=e.targetDrive,t=(0,c.Z)().getSharedSecret,o=new a.AO({api:a.Ii.Owner,sharedSecret:t()}),l=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driveProvider.GetDrives({pageNumber:1,pageSize:100});case 2:return e.next=4,e.sent.results;case 4:return t=e.sent,e.abrupt("return",t.find((function(e){return e.targetDriveInfo.alias===n.alias&&e.targetDriveInfo.type===n.type})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,i.useQuery)(["drive","".concat(n.alias,"_").concat(n.type)],(function(){return l(n)}),{refetchOnWindowFocus:!1})}}},2562:function(e,n,t){t.d(n,{Ac:function(){return s},WW:function(){return i},c$:function(){return a}});var r=t(4990),s=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Reader"),value:1},{name:(0,r.t)("Editor"),value:3}],i=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Read Connections"),value:10},{name:(0,r.t)("Read Circle Members"),value:50}],a=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Read Connections"),value:10},{name:(0,r.t)("Manage Connection Requests"),value:30},{name:(0,r.t)("Read Circle Members"),value:50}]}}]);
//# sourceMappingURL=117.cd9ee753.chunk.js.map