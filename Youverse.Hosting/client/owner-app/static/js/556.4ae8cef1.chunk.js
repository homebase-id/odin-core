"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[556],{1375:function(e,n,s){s.r(n),s.d(n,{default:function(){return j}});var r=s(4165),t=s(5861),a=s(885),i=s(6376),c=s(9072),l=s(8491),o=s(8321),d=s(1869),m=s(3504),u=s(4990),p=s(1512),x=s(2562),h=s(894),v=s(7266),g=s(184),f=function(e){var n,s,r=e.driveGrant,t=e.permissionTree,a=e.className,i=(0,p.Z)({targetDrive:r.drive}).fetch.data,c=function(e){var n,s,r=e.children;return i?(0,g.jsx)(m.rU,{to:"/owner/drives/".concat(null===i||void 0===i||null===(n=i.targetDriveInfo)||void 0===n?void 0:n.alias,"_").concat(null===i||void 0===i||null===(s=i.targetDriveInfo)||void 0===s?void 0:s.type),className:"contents",children:r}):(0,g.jsx)(g.Fragment,{children:r})};return(0,g.jsx)("div",{className:"flex flex-row ".concat(a),title:t,children:(0,g.jsxs)(c,{children:[(0,g.jsx)(h.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,g.jsxs)("div",{className:"flex flex-col",children:[(0,g.jsxs)("p",{className:"leading-none ".concat(t?"":"my-auto"),children:[null!==(n=null===i||void 0===i?void 0:i.name)&&void 0!==n?n:"".concat((0,u.t)("New")," ").concat(null===(s=r.driveMeta)||void 0===s?void 0:s.name),":"," ",(0,v.hz)(r.permission,x.A).name]}),t&&(0,g.jsx)("small",{className:"ml-1",children:t})]})]})},"".concat(r.drive.alias,"-").concat(r.drive.type))},y=s(2791),j=function(){var e,n,s,u,p=(0,m.lr)(),x=(0,a.Z)(p,1)[0],h=x.get("appId"),v=x.get("n"),j=x.get("p"),N=x.get("pk"),w=x.get("fn"),k=x.get("return"),Z=x.get("d");try{var b=Z&&JSON.parse(Z);u=(Array.isArray(b)?b:[b]).map((function(e){return{drive:{alias:e.a,type:e.t},driveMeta:{name:e.n,description:e.d},permission:parseInt(e.p)}}))}catch(J){return(0,g.jsx)("div",{children:"Bad request"})}if(!h||!v||!N||!w||!k)return(0,g.jsx)("div",{children:"Bad request"});var I=(0,i.Z)({appId:h}),A=I.fetch,B=A.data,C=A.isLoading,F=I.registerNewApp,q=F.mutateAsync,G=F.status,S=I.registerNewAppClient,O=S.mutateAsync,R=S.status,D=(0,y.useState)(),T=(0,a.Z)(D,2),U=T[0],_=T[1],L={keys:null!==(e=null===j||void 0===j?void 0:j.split(",").map((function(e){return parseInt(e)})))&&void 0!==e?e:[]},M=function(){var e=(0,t.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q({appId:h,name:v,permissionSet:L,driveGrants:u});case 2:return e.next=4,z();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=(0,t.Z)((0,r.Z)().mark((function e(){var n,s,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({appId:h,clientPublicKey64:N,clientFriendlyName:w});case 2:n=e.sent,s=encodeURI(n.data),t="".concat(k,"d=").concat(s,"&v=").concat(n.encryptionVersion),console.log(t),_(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return C?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsx)("section",{className:"my-20",children:(0,g.jsx)("div",{className:"container mx-auto px-5",children:(0,g.jsx)("div",{className:"max-w-[35rem]",children:B?(0,g.jsxs)(g.Fragment,{children:[U?(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Scucessfully registered client: ",w," on app: ",v]})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Register client: ",w]}),(0,g.jsxs)("p",{children:["The app ",v," is registered on your identity."]}),(0,g.jsx)("p",{className:"mt-2",children:"It has the following access on your identity and the following drives:"})]}),null!==(n=B.grant.permissionSet)&&void 0!==n&&n.keys?(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:B.grant.permissionSet.keys.map((function(e){return(0,g.jsx)(o.Z,{permission:e,className:"my-4"},"".concat(e))}))})}):null,null!==(s=B.grant)&&void 0!==s&&s.driveGrants?(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:B.grant.driveGrants.map((function(e){return(0,g.jsx)(d.Z,{driveGrant:e,className:"my-4"},"".concat(e.drive.alias,"-").concat(e.drive.type))}))})}):null,U?(0,g.jsxs)(g.Fragment,{children:["Url:",(0,g.jsx)("div",{className:"overflow-x-scroll whitespace-nowrap",children:U}),(0,g.jsx)("div",{className:"flex flex-row justify-end",children:(0,g.jsxs)(c.Z,{onClick:function(){window.location.href=U},className:"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none",state:R,children:["Back to ",v]})})]}):(0,g.jsx)("div",{className:"flex flex-row justify-end",children:(0,g.jsxs)(c.Z,{onClick:z,className:"mt-10 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none",state:R,children:["Register ",w]})})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("h1",{className:"mb-5 text-4xl dark:text-white",children:["Registering app: ",v," ",(0,g.jsxs)("small",{className:"block",children:["client: ",w]})]}),(0,g.jsxs)("p",{children:["The app ",v," is not registered on your identity."]}),(0,g.jsxs)("p",{className:"mt-2",children:['By registering this app, "',v,'" will have the following access on your identity and the following drives:']}),(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:L.keys.map((function(e){return(0,g.jsx)(o.Z,{permission:e,className:"my-4"},"".concat(e))}))})}),(0,g.jsx)(l.Z,{isOpaqueBg:!0,children:(0,g.jsx)("div",{className:"-my-4",children:u.map((function(e){return(0,g.jsx)(f,{driveGrant:e,className:"my-4"},"".concat(e.drive.alias,"-").concat(e.drive.type))}))})}),(0,g.jsxs)("div",{className:"-sm:mx-2 mt-10 sm:flex sm:flex-row-reverse",children:[(0,g.jsxs)(c.Z,{onClick:M,className:"my-3 block rounded border-0 bg-green-500 py-2 px-4 text-white hover:bg-green-600 focus:outline-none sm:mx-2 sm:my-auto",state:(0,c.s)(G,R),children:["Allow access and Register ",v]}),(0,g.jsx)(c.Z,{className:"my-3 sm:mx-2 sm:my-auto",type:"secondary",children:"Cancel"})]})]})})})})}}}]);
//# sourceMappingURL=556.4ae8cef1.chunk.js.map