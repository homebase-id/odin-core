"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[440],{8808:function(e,n,t){var r=t(3504),a=t(715),s=t(184);n.Z=function(e){var n=e.circleDef,t=e.permissionLevel;return n?(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(r.rU,{to:"/owner/circles/".concat(n.id),children:(0,s.jsxs)("h2",{className:"mb-2 flex flex-row text-xl",children:[(0,s.jsx)(a.Z,{className:"my-auto mr-2 h-4 w-4"})," ",(0,s.jsx)("span",{className:"my-auto",children:n.name}),t&&(0,s.jsxs)("span",{className:"my-auto",children:[": ",t]})]})})}):(0,s.jsx)(s.Fragment,{})}},1869:function(e,n,t){var r=t(3504),a=t(1512),s=t(2562),i=t(894),c=t(7266),o=t(184);n.Z=function(e){var n,t,u=e.driveGrant,l=e.permissionTree,d=e.className,f=(0,a.Z)({targetDrive:u.drive}).fetch.data;return(0,o.jsx)("div",{className:"flex flex-row ".concat(d),title:l,children:(0,o.jsxs)(r.rU,{to:"/owner/drives/".concat(null===f||void 0===f||null===(n=f.targetDriveInfo)||void 0===n?void 0:n.alias,"_").concat(null===f||void 0===f||null===(t=f.targetDriveInfo)||void 0===t?void 0:t.type),className:"contents",children:[(0,o.jsx)(i.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsxs)("p",{className:"leading-none ".concat(l?"":"my-auto"),children:[null===f||void 0===f?void 0:f.name,":"," ",(0,c.hz)(u.permission,s.A).name]}),l&&(0,o.jsx)("small",{className:"ml-1",children:l})]})]})},"".concat(u.drive.alias,"-").concat(u.drive.type))}},7117:function(e,n,t){t.r(n),t.d(n,{default:function(){return C}});var r=t(2982),a=t(885),s=t(2791),i=t(6871),c=t(4990),o=t(4395),u=t(7903),l=t(9072),d=t(4165),f=t(5861),m=t(4164),v=t(3412),p=t(6419),h=t(6123),x=t(184),g=function(e){var n=e.title,t=e.isOpen,i=e.currentCircleGrants,u=e.dotYouId,g=e.onConfirm,Z=e.onCancel,y=(0,v.Z)("modal-container"),j=(0,o.Z)(),w=j.fetch.data,b=j.provideGrant.mutateAsync,I=j.revokeGrant.mutateAsync,C=i.map((function(e){return e.circleId})),k=(0,s.useState)([]),N=(0,a.Z)(k,2),D=N[0],q=N[1],R=(0,s.useState)([]),S=(0,a.Z)(R,2),Y=S[0],F=S[1];if(!t)return null;var G=(0,x.jsx)(h.Z,{title:n,onClose:Z,children:(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("form",{onSubmit:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,Promise.all(Y.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.next=5,Promise.all(D.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I({circleId:n,dotYouId:u}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:g();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[w.length?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("h2",{className:"mb-2 text-lg",children:[(0,c.t)("Member of"),":"]}),w.map((function(e,n){var t;return(0,x.jsxs)("div",{className:"mb-2",children:[(0,x.jsx)(p.Z,{value:e.id,id:e.id,onChange:function(n){n.target.checked?(C.some((function(n){return n===e.id}))||F([].concat((0,r.Z)(Y),[e.id])),q(D.filter((function(n){return n!==e.id})))):(C.some((function(n){return n===e.id}))&&q([].concat((0,r.Z)(D),[e.id])),F(Y.filter((function(n){return n!==e.id}))))},defaultChecked:-1!==C.indexOf(e.id)}),(0,x.jsx)("label",{htmlFor:e.id,className:"ml-2",children:e.name})]},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,x.jsxs)("div",{className:"-mx-2 py-3 sm:flex sm:flex-row-reverse",children:[(0,x.jsx)(l.Z,{className:"mx-2",icon:"send",children:(0,c.t)("Save")}),(0,x.jsx)(l.Z,{className:"mx-2",type:"secondary",onClick:Z,children:(0,c.t)("Cancel")})]})]})})});return(0,m.createPortal)(G,y)},Z=t(959),y=t(3004),j=t(8808),w=t(1869),b=t(8491),I=function(e){var n=e.accessGrant,t=(0,o.Z)().fetch.data,a=null===t||void 0===t?void 0:t.filter((function(e){return n.circleGrants.some((function(n){return n.circleId===e.id}))})),s=null===a||void 0===a?void 0:a.reduce((function(e,n){return[].concat((0,r.Z)(e),(0,r.Z)(n.drivesGrants.map((function(e){return{driveGrant:e,permissionTree:"".concat((0,c.t)("Via:")," ").concat(n.name)}}))))}),[]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(b.Z,{title:(0,c.t)("Member of the following circles"),isOpaqueBg:!0,children:n.isRevoked?null:(0,x.jsx)(x.Fragment,{children:null===a||void 0===a?void 0:a.map((function(e){return(0,x.jsx)(j.Z,{circleDef:e},e.id)}))})}),(0,x.jsx)(b.Z,{title:(0,c.t)("Access on the following drives"),isOpaqueBg:!0,children:null!==s&&void 0!==s&&s.length?(0,x.jsx)(x.Fragment,{children:s.map((function(e){return(0,x.jsx)(w.Z,{driveGrant:e.driveGrant,permissionTree:e.permissionTree,className:"mb-6"},"".concat(e.driveGrant.drive.alias,"-").concat(e.driveGrant.drive.type))}))}):null})]})},C=function(){var e=(0,i.UO)().connectionKey,n=(0,i.s0)(),t=(0,u.Z)({dotYouId:e}),r=t.fetch,o=r.data,d=r.isLoading,f=t.disconnect,m=f.mutate,v=f.status,p=t.acceptRequest,h=p.mutate,j=p.status,w=t.ignoreRequest,b=w.mutate,C=w.status,k=t.revokeConnectionRequest,N=k.mutate,D=k.status,q=(0,s.useState)(!1),R=(0,a.Z)(q,2),S=R[0],Y=R[1];if(d&&x.Fragment,!o)return(0,x.jsx)(x.Fragment,{children:"No matching connection found"});var F="Connected"===o.status?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.Z,{type:"primary",className:"my-auto ml-auto",onClick:function(){Y(!0)},state:v,children:(0,c.t)("Edit Circles")}),(0,x.jsx)(l.Z,{type:"remove",className:"my-auto ml-2",onClick:function(){m({})},icon:"trash",state:v,children:(0,c.t)("Remove")})]}):"Pending"===o.status?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.Z,{type:"primary",className:"my-auto ml-auto",onClick:function(){h({senderDotYouId:o.senderDotYouId})},state:j,children:(0,c.t)("Accept Request")}),(0,x.jsx)(l.Z,{type:"secondary",className:"my-auto ml-2",onClick:function(){b({senderDotYouId:o.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:C,children:(0,c.t)("Ignore")})]}):"Sent"===o.status?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(l.Z,{type:"secondary",className:"my-auto ml-2",onClick:function(){N({targetDotYouId:o.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:D,children:(0,c.t)("Revoke")})}):(0,x.jsx)(x.Fragment,{}),G=o;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(y.Z,{icon:Z.Z,title:"".concat(e," (").concat(o.status,")"),actions:F,breadCrumbs:[{href:"/owner/connections",title:"Connections"},{title:e}]}),"Connected"===o.status?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("section",{children:[(0,x.jsxs)("p",{className:"text-sm",children:[(0,c.t)("Connected since"),": ",new Date(G.created).toLocaleDateString()]}),(0,x.jsx)(I,{accessGrant:G.accessGrant})]}),(0,x.jsx)(g,{title:"".concat((0,c.t)("Edit Circle Membership for")," ").concat(e),isOpen:S,dotYouId:e,currentCircleGrants:G.accessGrant.circleGrants,onCancel:function(){Y(!1)},onConfirm:function(){Y(!1)}})]}):"Pending"===o.status||"Sent"===o.status?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)("p",{className:"mb-3 text-sm",children:o.message})}):null]})}},7266:function(e,n,t){t.d(n,{RG:function(){return i},fP:function(){return s},hz:function(){return c},rS:function(){return r},vr:function(){return a}});var r=function(e){return e[Math.floor(Math.random()*e.length)]},a=function(){return r(["Ut bibendum, neque ac lacinia aliquam, justo ipsum aliquam urna, id vestibulum augue mauris sit amet lacus.","Proin ante sapien, interdum sit amet eros sit amet, eleifend pharetra metus.","Sed elit mi, euismod eget neque at, suscipit aliquam nisi.","Nunc diam arcu, tincidunt quis dignissim ac, volutpat non odio."])},s=function(){var e=["adorable","beautiful","clean","drab","elegant","fancy","glamorous","handsome","long","magnificent","old-fashioned","plain","quaint","sparkling","ugliest","unsightly","angry","bewildered","clumsy","defeated","embarrassed","fierce","grumpy","helpless","itchy","jealous","lazy","mysterious","nervous","obnoxious","panicky","repulsive","scary","thoughtless","uptight","worried"];return"".concat(r(e)," ").concat(r(e)," ").concat(r(["women","men","children","teeth","feet","people","leaves","mice","geese","halves","knives","wives","lives","elves","loaves","potatoes","tomatoes","cacti","foci","fungi","nuclei","syllabuses","analyses","diagnoses","oases","theses","crises","phenomena","criteria","data"]))},i=function(e){for(var n=window.atob(e),t=n.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=n.charCodeAt(a);return r.buffer},c=function(e,n){return n.reduce((function(n,t){return t.value>n.value&&t.value<=e?t:n}),n[0])}},7903:function(e,n,t){var r=t(4165),a=t(5861),s=t(7408),i=t(7186),c=t(5144),o=t(6117);n.Z=function(e){var n=e.dotYouId,t=(0,s.useQueryClient)(),u=(0,o.Z)().getSharedSecret,l=i.I.getInstance(u()),d=c.e.getInstance(u()),f=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a,s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.dotYouId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l.getConnectionInfo(t);case 5:if(!(a=e.sent)||"None"===a.status){e.next=8;break}return e.abrupt("return",a);case 8:return e.next=10,d.getPendingRequest(t);case 10:if(!(s=e.sent)){e.next=13;break}return e.abrupt("return",s);case 13:return e.next=15,d.getSentRequest(t);case 15:return i=e.sent,e.abrupt("return",null!==i&&void 0!==i?i:a);case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.connectionDotYouId,e.next=3,l.disconnectFromContact(null!==a&&void 0!==a?a:n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),v=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a,s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,a=n.message,s=n.name,i=n.circleIds,e.next=3,d.sendRequest(t,a,s,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.targetDotYouId,e.next=3,d.deleteSentRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),h=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.acceptConnectionRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),x=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.senderDotYouId,e.next=3,d.deletePendingRequest(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,s.useQuery)(["connectionInfo",n],(function(){return f({dotYouId:n})}),{refetchOnMount:!0,refetchOnWindowFocus:!1}),disconnect:(0,s.useMutation)(m,{onSuccess:function(e,n){t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n])},onError:function(e){console.error(e)}}),sendConnectionRequest:(0,s.useMutation)(v,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),revokeConnectionRequest:(0,s.useMutation)(p,{onSuccess:function(e,n){t.invalidateQueries(["sentRequests"]),t.invalidateQueries(["connectionInfo",n.targetDotYouId])},onError:function(e){console.error(e)}}),acceptRequest:(0,s.useMutation)(h,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["activeConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}}),ignoreRequest:(0,s.useMutation)(x,{onSuccess:function(e,n){t.invalidateQueries(["pendingConnections"]),t.invalidateQueries(["connectionInfo",n.senderDotYouId])},onError:function(e){console.error(e)}})}}},1512:function(e,n,t){var r=t(4165),a=t(5861),s=t(7408),i=t(1803),c=t(6117);n.Z=function(e){var n=e.targetDrive,t=(0,c.Z)().getSharedSecret,o=new i.AO({api:i.Ii.Owner,sharedSecret:t()}),u=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driveProvider.GetDrives({pageNumber:1,pageSize:100});case 2:return e.next=4,e.sent.results;case 4:return t=e.sent,e.abrupt("return",t.find((function(e){return e.targetDriveInfo.alias===n.alias&&e.targetDriveInfo.type===n.type})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{fetch:(0,s.useQuery)(["drive","".concat(n.alias,"_").concat(n.type)],(function(){return u(n)}),{refetchOnMount:!1,refetchOnWindowFocus:!1})}}},2562:function(e,n,t){t.d(n,{A:function(){return a},W:function(){return s}});var r=t(4990),a=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Reader"),value:1},{name:(0,r.t)("Editor"),value:3}],s=[{name:(0,r.t)("None"),value:0},{name:(0,r.t)("Read Connections"),value:10},{name:(0,r.t)("Read Connection Requests"),value:30},{name:(0,r.t)("Read Circle Members"),value:50}]}}]);
//# sourceMappingURL=440.2d6a26ad.chunk.js.map