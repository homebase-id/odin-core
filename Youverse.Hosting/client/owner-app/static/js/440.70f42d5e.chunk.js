"use strict";(self.webpackChunkowner_app=self.webpackChunkowner_app||[]).push([[440],{1869:function(e,n,t){var r=t(3504),i=t(4990),s=t(1512),c=t(2562),o=t(4665),a=t(894),l=t(1191),d=t(7266),u=t(184);n.Z=function(e){var n,t,m,v,f,p=e.driveGrant,x=e.permissionTree,h=e.className,j=(0,s.Z)({targetDrive:p.permissionedDrive.drive}).fetch,Z=j.data;return j.isLoading?(0,u.jsx)(l.Z,{className:"h-4 max-w-xs ".concat(h)}):(0,u.jsx)("div",{className:"flex flex-row ".concat(h),title:x,children:(0,u.jsxs)(r.rU,{to:"/owner/drives/".concat(null===Z||void 0===Z||null===(v=Z.targetDriveInfo)||void 0===v?void 0:v.alias,"_").concat(null===Z||void 0===Z||null===(f=Z.targetDriveInfo)||void 0===f?void 0:f.type),className:"flex flex-row hover:text-slate-700 hover:underline dark:hover:text-slate-400",children:[(0,u.jsx)(a.Z,{className:"mt-1 mb-auto mr-3 h-6 w-6"}),(0,u.jsxs)("div",{className:"mr-2 flex flex-col",children:[(0,u.jsxs)("p",{className:"leading-none ".concat(x?"":"my-auto"),children:[null===Z||void 0===Z?void 0:Z.name,":"," ",(0,d.hz)(null===p||void 0===p?void 0:p.permissionedDrive.permission,c.Ac).name]}),x&&(0,u.jsxs)("small",{className:"",children:[(0,i.t)("Via")," ",x]})]}),(0,u.jsx)(o.Z,{className:"my-auto ml-auto h-5 w-5"})]})},"".concat(null===p||void 0===p||null===(n=p.permissionedDrive)||void 0===n||null===(t=n.drive)||void 0===t?void 0:t.alias,"-").concat(null===p||void 0===p||null===(m=p.permissionedDrive.drive)||void 0===m?void 0:m.type))}},7117:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var r=t(2982),i=t(885),s=t(2791),c=t(6871),o=t(4990),a=t(4395),l=t(7903),d=t(9072),u=t(4165),m=t(5861),v=t(4164),f=t(7480),p=t(3412),x=t(6419),h=t(6123),j=t(184),Z=function(e){var n=e.title,t=e.isOpen,c=e.currentCircleGrants,l=e.dotYouId,Z=e.onConfirm,g=e.onCancel,y=(0,p.Z)("modal-container"),D=(0,a.Z)().fetch.data,w=(0,f.Z)({}),C=w.provideGrant.mutateAsync,N=w.revokeGrant.mutateAsync,b=c.map((function(e){return e.circleId})),I=(0,s.useState)([]),k=(0,i.Z)(I,2),G=k[0],F=k[1],Y=(0,s.useState)([]),S=(0,i.Z)(Y,2),A=S[0],R=S[1];if(!t)return null;var q=(0,j.jsx)(h.Z,{title:n,onClose:g,children:(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("form",{onSubmit:function(){var e=(0,m.Z)((0,u.Z)().mark((function e(n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,Promise.all(A.map(function(){var e=(0,m.Z)((0,u.Z)().mark((function e(n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C({circleId:n,dotYouId:l}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.next=5,Promise.all(G.map(function(){var e=(0,m.Z)((0,u.Z)().mark((function e(n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N({circleId:n,dotYouId:l}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:Z();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[D.length?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("h2",{className:"mb-2 text-lg",children:[(0,o.t)("Member of"),":"]}),D.map((function(e,n){var t;return(0,j.jsxs)("div",{className:"mb-2",children:[(0,j.jsx)(x.Z,{value:e.id,id:e.id,onChange:function(n){n.target.checked?(b.some((function(n){return n===e.id}))||R([].concat((0,r.Z)(A),[e.id])),F(G.filter((function(n){return n!==e.id})))):(b.some((function(n){return n===e.id}))&&F([].concat((0,r.Z)(G),[e.id])),R(A.filter((function(n){return n!==e.id}))))},defaultChecked:-1!==b.indexOf(e.id)}),(0,j.jsx)("label",{htmlFor:e.id,className:"ml-2",children:e.name})]},null!==(t=e.id)&&void 0!==t?t:n)}))]}):null,(0,j.jsxs)("div",{className:"-m-2 flex flex-row-reverse py-3",children:[(0,j.jsx)(d.Z,{className:"m-2",icon:"send",children:(0,o.t)("Save")}),(0,j.jsx)(d.Z,{className:"m-2",type:"secondary",onClick:g,children:(0,o.t)("Cancel")})]})]})})});return(0,v.createPortal)(q,y)},g=t(8532),y=t(959),D=t(3004),w=t(8739),C=t(1191),N=t(8808),b=t(1869),I=t(8491),k=function(e){var n=e.accessGrant,t=(0,a.Z)().fetch,i=t.data,s=t.isLoading,c=null===i||void 0===i?void 0:i.filter((function(e){return n.circleGrants.some((function(n){return n.circleId===e.id}))})),l=null===c||void 0===c?void 0:c.flatMap((function(e){var n;return null!==(n=e.driveGrants)&&void 0!==n?n:[]})),d=null===l||void 0===l?void 0:l.reduce((function(e,n){var t=e.findIndex((function(e){return e.permissionedDrive.drive.alias===n.permissionedDrive.drive.alias&&e.permissionedDrive.drive.type===n.permissionedDrive.drive.type}));return-1!==t?(e[t].permissionedDrive.permission=Math.max(e[t].permissionedDrive.permission,n.permissionedDrive.permission),e):[].concat((0,r.Z)(e),[n])}),[]),u=null===d||void 0===d?void 0:d.map((function(e){var n=c.filter((function(n){var t;return null===(t=n.driveGrants)||void 0===t?void 0:t.some((function(n){return n.permissionedDrive.drive.alias===e.permissionedDrive.drive.alias&&n.permissionedDrive.drive.type===e.permissionedDrive.drive.type}))})).map((function(e){return e.name}));return{driveGrant:e,permissionTree:n.join(", ")}}));return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(I.Z,{title:(0,o.t)("Member of the following circles"),isOpaqueBg:!0,children:s?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"}),(0,j.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"}),(0,j.jsx)(C.Z,{className:"mb-4 h-4 max-w-xs"})]}):(0,j.jsx)(j.Fragment,{children:n.isRevoked?null:(0,j.jsx)(j.Fragment,{children:null===c||void 0===c?void 0:c.map((function(e){return(0,j.jsx)(N.Z,{circleDef:e},e.id)}))})})}),null!==u&&void 0!==u&&u.length?(0,j.jsx)(I.Z,{title:(0,o.t)("Access on the following drives"),isOpaqueBg:!0,children:u.map((function(e){return(0,j.jsx)(b.Z,{driveGrant:e.driveGrant,permissionTree:e.permissionTree,className:"mb-6"},"".concat(e.driveGrant.permissionedDrive.drive.alias,"-").concat(e.driveGrant.permissionedDrive.drive.type))}))}):null]})},G=function(){var e=(0,c.UO)().connectionKey,n=(0,c.s0)(),t=(0,l.Z)({dotYouId:e}),r=t.fetch,a=r.data,u=r.isLoading,m=t.disconnect,v=m.mutate,f=m.status,p=t.acceptRequest,x=p.mutate,h=p.status,C=t.ignoreRequest,N=C.mutate,b=C.status,I=t.revokeConnectionRequest,G=I.mutate,F=I.status,Y=(0,s.useState)(!1),S=(0,i.Z)(Y,2),A=S[0],R=S[1],q=(0,s.useState)(!1),O=(0,i.Z)(q,2),T=O[0],M=O[1];if(u)return(0,j.jsx)(w.Z,{});if(!a)return(0,j.jsx)(j.Fragment,{children:"No matching connection found"});var P="Connected"===a.status?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.Z,{type:"primary",className:"m-2",onClick:function(){M(!0)},state:f,children:(0,o.t)("Edit Access")}),(0,j.jsx)(d.Z,{type:"remove",className:"m-2",onClick:function(){return v({})},icon:"trash",state:f,confirmOptions:{title:"".concat((0,o.t)("Remove")," ").concat(e),buttonText:(0,o.t)("Remove"),body:"".concat((0,o.t)("Are you sure you want to remove")," ").concat(e," ").concat((0,o.t)("from your connections. They will lose all existing access."))},children:(0,o.t)("Remove")})]}):"Pending"===a.status?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(d.Z,{type:"primary",className:"m-2",onClick:function(){R(!0)},state:h,children:[(0,o.t)("Accept Request"),"..."]}),(0,j.jsx)(d.Z,{type:"secondary",className:"m-2",onClick:function(){N({senderDotYouId:a.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:b,children:(0,o.t)("Ignore")}),(0,j.jsx)(g.Z,{isOpen:A,title:(0,o.t)("Accept connection request"),confirmText:(0,o.t)("Accept and give access"),onConfirm:function(e){x({senderDotYouId:a.senderDotYouId,circleIds:e}),R(!1)},onCancel:function(){R(!1)},children:"".concat(a.senderDotYouId," ").concat((0,o.t)("has sent you a connection request"))})]}):"Sent"===a.status?(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(d.Z,{type:"secondary",className:"m-2",onClick:function(){G({targetDotYouId:a.senderDotYouId},{onSuccess:function(){return n("/owner/connections")}})},state:F,children:(0,o.t)("Revoke")})}):(0,j.jsx)(j.Fragment,{}),L=a;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(D.Z,{icon:y.Z,title:"".concat(e," (").concat(a.status,")"),actions:P,breadCrumbs:[{href:"/owner/connections",title:"Connections"},{title:e}]}),"Connected"===a.status?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("section",{children:[(0,j.jsxs)("p",{className:"text-sm",children:[(0,o.t)("Connected since"),": ",new Date(L.created).toLocaleDateString()]}),(0,j.jsx)(k,{accessGrant:L.accessGrant})]}),(0,j.jsx)(Z,{title:"".concat((0,o.t)("Edit Circle Membership for")," ").concat(e),isOpen:T,dotYouId:e,currentCircleGrants:L.accessGrant.circleGrants,onCancel:function(){M(!1)},onConfirm:function(){M(!1)}})]}):"Pending"===a.status||"Sent"===a.status?(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("p",{className:"mb-3 text-sm",children:a.message})}):null]})}}}]);
//# sourceMappingURL=440.70f42d5e.chunk.js.map