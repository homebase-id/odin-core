"use strict";(self.webpackChunkprovisioning_app=self.webpackChunkprovisioning_app||[]).push([[200],{200:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});var n=s(4165),i=s(5861),r=s(5671),a=s(3144),o=s(7326),l=s(136),d=s(7277),u=s(2791),h=s(4569),c=s.n(h),g=s(4091),f=s(184),v={domainValue:"",screenStatus:g.y.EnterDomain,reservation:null,registrationId:null,statusText:"",managedDomains:[],firstRunToken:null,dnsConfig:null},x=0,y=function(e){(0,l.Z)(s,e);var t=(0,d.Z)(s);function s(e){var n;return(0,r.Z)(this,s),(n=t.call(this,e)).root="//"+window.location.host+"/api/registration/v1",n.state=v,n.handleDomainValueChange=n.handleDomainValueChange.bind((0,o.Z)(n)),n.handleSuffixChange=n.handleSuffixChange.bind((0,o.Z)(n)),n.handleReserve=n.handleReserve.bind((0,o.Z)(n)),n.startRegistration=n.startRegistration.bind((0,o.Z)(n)),n.handleReset=n.handleReset.bind((0,o.Z)(n)),n.handleAxiosError=n.handleAxiosError.bind((0,o.Z)(n)),n.startPolling=n.startPolling.bind((0,o.Z)(n)),n.stopPolling=n.stopPolling.bind((0,o.Z)(n)),n.finalizeRegistration=n.finalizeRegistration.bind((0,o.Z)(n)),n.handleConfigure=n.handleConfigure.bind((0,o.Z)(n)),n}return(0,a.Z)(s,[{key:"componentDidMount",value:function(){}},{key:"handleReset",value:function(){this.setState(v)}},{key:"handleDomainValueChange",value:function(e){var t=e.target.value.trimEnd();this.setState({domainValue:t})}},{key:"handleSuffixChange",value:function(e){console.log("suffix",e.target.value),this.setState({domainSuffix:e.target.value})}},{key:"getDomain",value:function(){return this.state.domainValue}},{key:"handleConfigure",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root+"/registration/dns?domain="+this.state.domainValue,c().get(t).then((function(e){s.setState({screenStatus:g.y.DnsConfig,dnsConfig:e.data})})).catch(this.handleAxiosError);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleReserve",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var s,i,r,a,o,l=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.getDomain(),i=this.root+"/registration/availability/"+s,e.next=4,c().get(i).catch(this.handleAxiosError);case 4:if(r=e.sent,this.setState({statusText:"Checking Availability..."}),!1!==r.data){e.next=10;break}return this.setState({statusText:"Not available \u10da(\u0ca0\u76ca\u0ca0\u10da)"}),this.forceUpdate(),e.abrupt("return");case 10:a=this.root+"/registration/reservations",o={domainName:s},this.setState({statusText:"submitting reservation...",screenStatus:g.y.Reserving}),c().post(a,o).then((function(e){console.log("reservation",e.data),l.setState({reservation:e.data,statusText:"Reservation Successful",screenStatus:g.y.ReadyToRegister})})).catch(this.handleAxiosError);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startRegistration",value:function(){var e=this;this.setState({statusText:"Starting Registration...",screenStatus:g.y.RegistrationInProgress});var t=this.root+"/registration/register",s={reservationId:this.state.reservation.id};c().post(t,s).then((function(t){e.setState({statusText:"Polling for certificate creation ever two seconds",screenStatus:g.y.PollingForCertificate,firstRunToken:t.data}),e.startPolling()})).catch(this.handleAxiosError)}},{key:"startPolling",value:function(){var e=this;this.timer=setInterval((function(){return e.poll()}),2e3)}},{key:"poll",value:function(){var e=this;x++,this.setState({statusText:"Polling Registration..."+x});var t=this.root+"/registration/status?firstRunToken="+this.state.firstRunToken;c().get(t).then((function(t){var s=t.data;if("readyForPassword"===s)return e.stopPolling(),void e.finalizeRegistration();"awaitingCertificate"!==s&&(e.stopPolling(),e.setState({statusText:"Unknown status returned",screenStatus:g.y.RegistrationFailed}))})).catch(this.handleAxiosError)}},{key:"stopPolling",value:function(){clearInterval(this.timer),this.timer=null}},{key:"finalizeRegistration",value:function(){this.setState({statusText:"Ready to set your password",screenStatus:g.y.ReadyForPassword})}},{key:"handleAxiosError",value:function(e){e.response?(console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers),this.setState({statusText:"Unhandled Error occured.  Response Status: ["+e.response.status+"].  See the console for more.",screenStatus:g.y.UnhandledError})):e.request?(console.log(e.request),this.setState({statusText:"Failed: Request sent but no response received.  (this can happen when server exception occurs before the CORS header can be sent back). See the console.",screenStatus:g.y.UnhandledError})):(this.setState({statusText:"Something happened before sending the request.  Validate how you're setting up the request.",screenStatus:g.y.UnhandledError}),console.log("Error",e.message))}},{key:"render",value:function(){var e=this;return(0,f.jsx)("div",{style:{height:"100%",minHeight:"100%"},className:" flex-column align-items-center justify-content-around text-center align-middle",children:(0,f.jsxs)("div",{className:"pt-5",children:[(0,f.jsx)("h1",{className:"display-6",children:"Test Provisioning (Custom domain)"}),(0,f.jsx)("hr",{}),(0,f.jsx)("h4",{children:this.getDomain()}),this.state.screenStatus===g.y.EnterDomain&&(0,f.jsxs)("form",{children:[(0,f.jsxs)("label",{children:["Domain\xa0"," ",(0,f.jsx)("input",{type:"text",value:this.state.domainValue,size:20,onChange:this.handleDomainValueChange})," "]}),(0,f.jsx)("input",{type:"button",onClick:this.handleConfigure,value:"Configure"})]}),this.state.screenStatus===g.y.Reserving&&(0,f.jsx)("div",{style:{flexDirection:"column"},children:"Reserving domain"}),this.state.screenStatus===g.y.ReadyToRegister&&(0,f.jsx)("div",{style:{flexDirection:"column"},children:(0,f.jsx)("input",{type:"button",onClick:this.startRegistration,value:"Register"})}),this.state.screenStatus===g.y.DnsConfig&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Set your DNS configuration as follows "}),this.state.dnsConfig.cdnServer.domains.map((function(t){return(0,f.jsx)("div",{style:{flexDirection:"row"},children:(0,f.jsxs)("div",{children:[t," \u2192 ",e.state.dnsConfig.cdnServer.targetServer," as ",e.state.dnsConfig.cdnServer.recordType]})},t)})),(0,f.jsx)("hr",{}),this.state.dnsConfig.apiServer.domains.map((function(t){return(0,f.jsx)("div",{style:{flexDirection:"row"},children:(0,f.jsxs)("div",{children:[t," \u2192 ",e.state.dnsConfig.apiServer.targetServer," as ",e.state.dnsConfig.apiServer.recordType]})},t)})),(0,f.jsx)("br",{}),(0,f.jsx)("input",{type:"button",onClick:this.handleReserve,value:"Ok,I've configured DNS"})]}),this.state.screenStatus===g.y.RegistrationInProgress&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Registration in progress"}),(0,f.jsx)("h6",{children:this.state.statusText}),(0,f.jsx)("div",{style:{padding:4},children:"\u1559(\u21c0\u2038\u21bc\u2036)\u1557"})]}),this.state.screenStatus===g.y.PollingForCertificate&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Registration in progress"}),(0,f.jsx)("h6",{children:this.state.statusText}),(0,f.jsx)("div",{style:{padding:4},children:"(-_-)"})]}),this.state.screenStatus===g.y.ReadyForPassword&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Password is next..."}),(0,f.jsx)("h6",{children:this.state.statusText}),(0,f.jsx)("div",{style:{padding:4},children:" \u1566(\xf2_\xf3\u02c7)\u1564"}),(0,f.jsxs)("h2",{children:["Your new identity: ",this.getDomain()]}),(0,f.jsxs)("a",{href:"https://".concat(this.getDomain(),"/owner/firstrun?frt=").concat(this.state.firstRunToken),children:["Click here to continue to ",this.getDomain()," and set your password"]})]}),this.state.screenStatus===g.y.RegistrationFailed&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Registration Failed =("}),(0,f.jsx)("h6",{children:this.state.statusText}),(0,f.jsx)("div",{style:{padding:4},children:" \xaf\\_(\u2299\ufe3f\u2299)_/\xaf"}),(0,f.jsx)("input",{type:"button",onClick:this.handleReset,value:"Try again"})]}),this.state.screenStatus===g.y.UnhandledError&&(0,f.jsxs)("div",{style:{flexDirection:"column"},children:[(0,f.jsx)("h3",{children:"Unhandled Error - See server log"}),(0,f.jsx)("h6",{children:this.state.statusText}),(0,f.jsx)("div",{style:{padding:4},children:" \xaf\\_(\u2299\ufe3f\u2299)_/\xaf"}),(0,f.jsx)("input",{type:"button",onClick:this.handleReset,value:"Try again"})]})]})})}}]),s}(u.Component)},4091:function(e,t,s){var n;s.d(t,{y:function(){return n}}),function(e){e[e.SelectManagedOrCustomDomain=0]="SelectManagedOrCustomDomain",e[e.EnterDomain=1]="EnterDomain",e[e.Reserving=2]="Reserving",e[e.ReadyToRegister=3]="ReadyToRegister",e[e.RegistrationInProgress=4]="RegistrationInProgress",e[e.PollingForCertificate=5]="PollingForCertificate",e[e.ReadyForPassword=6]="ReadyForPassword",e[e.RegistrationFailed=7]="RegistrationFailed",e[e.UnhandledError=8]="UnhandledError",e[e.DnsConfig=9]="DnsConfig"}(n||(n={}))}}]);
//# sourceMappingURL=200.97d71eac.chunk.js.map